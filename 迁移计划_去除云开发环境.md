# è¯­å¯„å¿ƒå£° - äº‘å¼€å‘ç¯å¢ƒè¿ç§»è®¡åˆ’

## ğŸ“‹ è¿ç§»ç›®æ ‡

**ä»**ï¼šå¾®ä¿¡äº‘å¼€å‘ + Notion æ··åˆæ¶æ„
**åˆ°**ï¼šçº¯ Notion æ¶æ„ï¼ˆé›¶äº‘å¼€å‘ä¾èµ–ï¼‰

---

## ğŸ“Š å½“å‰äº‘èµ„æºä½¿ç”¨æƒ…å†µ

### äº‘å‡½æ•°ï¼ˆ5ä¸ªï¼‰
| äº‘å‡½æ•° | ç”¨é€” | è¿ç§»æ–¹æ¡ˆ |
|--------|------|----------|
| `memo-notion-sync` | ç”¨æˆ·ç®¡ç†ã€æ•°æ®åŒæ­¥ | ğŸ”„ æ”¹ç”¨ Notion Users æ•°æ®åº“ |
| `login` | è·å–å¾®ä¿¡ openid | âŒ ç§»é™¤ï¼ˆæ”¹ç”¨é‚®ç®±ç™»å½•ï¼‰ |
| `human30-assessment` | AI è¯„ä¼°å¯¹è¯ | ğŸ”„ å‰ç«¯ç›´æ¥è°ƒç”¨ AI API |
| `speechRecognition` | è¯­éŸ³è¯†åˆ« | ğŸ”„ æ”¹ç”¨å¾®ä¿¡åŒå£°ä¼ è¯‘æ’ä»¶ |
| `init-human30-db` | åˆå§‹åŒ–æ•°æ®åº“ | âŒ ç§»é™¤ï¼ˆä¸å†éœ€è¦ï¼‰ |

### äº‘æ•°æ®åº“é›†åˆï¼ˆ5ä¸ªï¼‰
| é›†åˆ | ç”¨é€” | è¿ç§»æ–¹æ¡ˆ |
|------|------|----------|
| `memo_users` | ç”¨æˆ·ä¿¡æ¯ | ğŸ”„ è¿ç§»åˆ° Notion Users æ•°æ®åº“ |
| `memo_user_configs` | ç”¨æˆ·é…ç½® | ğŸ”„ åˆå¹¶åˆ° Notion Users æ•°æ®åº“ |
| `human30_sessions` | è¯„ä¼°ä¼šè¯ | ğŸ”„ æœ¬åœ°å­˜å‚¨ + Notion Knowledge |
| `human30_reports` | è¯„ä¼°æŠ¥å‘Š | ğŸ”„ å­˜å…¥ Notion Knowledge |
| `human30_assessments` | è¯„ä¼°æ±‡æ€» | ğŸ”„ å­˜å…¥ Notion Knowledge |

### å—å½±å“çš„å‰ç«¯æ–‡ä»¶
| æ–‡ä»¶ | äº‘å‡½æ•°è°ƒç”¨æ•° | ä¿®æ”¹ä¼˜å…ˆçº§ |
|------|-------------|-----------|
| `pages/login/login.js` | 8å¤„ | ğŸ”´ é«˜ |
| `pages/register/register.js` | 3å¤„ | ğŸ”´ é«˜ |
| `pages/settings/settings.js` | 6å¤„ | ğŸ”´ é«˜ |
| `pages/goals-todos/goals-todos.js` | 4å¤„ | ğŸŸ¡ ä¸­ |
| `pages/notion-config/notion-config.js` | 5å¤„ | ğŸŸ¡ ä¸­ |
| `pages/assessment/assessment.js` | 3å¤„ | ğŸŸ¡ ä¸­ |
| `pages/daily-status/daily-status.js` | 2å¤„ | ğŸŸ¢ ä½ |
| `pages/timeline/timeline.js` | 1å¤„ | ğŸŸ¢ ä½ |

---

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡

### Notion ä¹æ•°æ®åº“æ¶æ„

```
è¯­å¯„å¿ƒå£° - æ•°æ®ä¸­å¿ƒ
â”œâ”€â”€ ğŸ¯ Goalsï¼ˆç›®æ ‡åº“ï¼‰
â”œâ”€â”€ âœ… Todosï¼ˆå¾…åŠåº“ï¼‰
â”œâ”€â”€ ğŸ“ Main Recordsï¼ˆä¸»è®°å½•è¡¨ï¼‰
â”œâ”€â”€ â±ï¸ Activity Detailsï¼ˆæ´»åŠ¨æ˜ç»†è¡¨ï¼‰
â”œâ”€â”€ ğŸ“Š Daily Statusï¼ˆæ¯æ—¥çŠ¶æ€åº“ï¼‰
â”œâ”€â”€ ğŸ˜Š Happy Thingsï¼ˆå¼€å¿ƒåº“ï¼‰
â”œâ”€â”€ ğŸ’¬ Quotesï¼ˆç®´è¨€åº“ï¼‰
â”œâ”€â”€ ğŸ“š Knowledgeï¼ˆçŸ¥è¯†åº“ï¼‰
â””â”€â”€ ğŸ‘¤ Usersï¼ˆç”¨æˆ·åº“ï¼‰â­ æ–°å¢
```

### ğŸ‘¤ Users æ•°æ®åº“ Schema

```javascript
const UsersDatabaseSchema = {
  title: 'ğŸ‘¤ è¯­å¯„å¿ƒå£° - ç”¨æˆ·åº“ (Users)',
  description: 'ç”¨æˆ·è´¦æˆ·å’Œé…ç½®ç®¡ç†',
  properties: {
    // === åŸºç¡€ä¿¡æ¯ ===
    'Email': { title: {} },                    // é‚®ç®±ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
    'Display Name': { rich_text: {} },         // æ˜¾ç¤ºåç§°
    'Password Hash': { rich_text: {} },        // å¯†ç å“ˆå¸Œï¼ˆSHA-256ï¼‰
    'Avatar URL': { url: {} },                 // å¤´åƒåœ°å€

    // === Notion é…ç½® ===
    'Notion API Key': { rich_text: {} },       // ç”¨æˆ·è‡ªå·±çš„ Notion API Keyï¼ˆåŠ å¯†ï¼‰
    'Database IDs': { rich_text: {} },         // JSON: 8ä¸ªæ•°æ®åº“ID

    // === AI é…ç½® ===
    'AI Provider': {                           // AI æœåŠ¡å•†
      select: {
        options: [
          { name: 'OpenAI', color: 'green' },
          { name: 'è±†åŒ…', color: 'blue' },
          { name: 'DeepSeek', color: 'purple' },
          { name: 'Claude', color: 'orange' },
          { name: 'æ— ', color: 'gray' }
        ]
      }
    },
    'AI API Key': { rich_text: {} },           // AI API Keyï¼ˆåŠ å¯†ï¼‰
    'AI Model': { rich_text: {} },             // ä½¿ç”¨çš„æ¨¡å‹åç§°

    // === ç”¨æˆ·åå¥½ ===
    'Custom Tags': { multi_select: {} },       // è‡ªå®šä¹‰æ ‡ç­¾
    'Preferences': { rich_text: {} },          // JSON: å…¶ä»–åå¥½è®¾ç½®
    'Theme': {                                 // ä¸»é¢˜
      select: {
        options: [
          { name: 'é»˜è®¤', color: 'default' },
          { name: 'æ·±è‰²', color: 'gray' },
          { name: 'æŠ¤çœ¼', color: 'green' }
        ]
      }
    },

    // === çŠ¶æ€ä¿¡æ¯ ===
    'Status': {
      select: {
        options: [
          { name: 'æ´»è·ƒ', color: 'green' },
          { name: 'ä¼‘çœ ', color: 'yellow' },
          { name: 'å·²æ³¨é”€', color: 'red' }
        ]
      }
    },
    'Last Login': { date: {} },                // æœ€åç™»å½•æ—¶é—´
    'Created At': { date: {} },                // æ³¨å†Œæ—¶é—´
    'Login Count': { number: {} },             // ç™»å½•æ¬¡æ•°

    // === ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¯é€‰ï¼ŒRollupï¼‰ ===
    'Total Records': { number: {} },           // æ€»è®°å½•æ•°
    'Total Goals': { number: {} },             // æ€»ç›®æ ‡æ•°
  }
}
```

---

## ğŸ“… å®æ–½é˜¶æ®µ

### é˜¶æ®µä¸€ï¼šå‡†å¤‡å·¥ä½œï¼ˆ1å¤©ï¼‰

#### ä»»åŠ¡ 1.1ï¼šæ›´æ–°æ•°æ®åº“åˆ›å»ºè„šæœ¬
- [ ] åœ¨ `notionDatabaseSetup.js` æ·»åŠ  Users æ•°æ®åº“ Schema
- [ ] åœ¨ `notionQuadDatabaseCreator.js` æ·»åŠ  Users æ•°æ®åº“åˆ›å»ºé€»è¾‘
- [ ] æµ‹è¯•ä¹æ•°æ®åº“è‡ªåŠ¨åˆ›å»ºæµç¨‹

#### ä»»åŠ¡ 1.2ï¼šåˆ›å»º Notion ç”¨æˆ·æœåŠ¡
- [ ] åˆ›å»º `utils/notionUserService.js`
- [ ] å®ç°ç”¨æˆ· CRUD æ“ä½œï¼ˆé€šè¿‡ Notion APIï¼‰
- [ ] å®ç°å¯†ç å“ˆå¸Œå’ŒéªŒè¯
- [ ] å®ç° API Key åŠ å¯†å­˜å‚¨

#### ä»»åŠ¡ 1.3ï¼šåˆ›å»º AI æœåŠ¡å°è£…
- [ ] åˆ›å»º `utils/aiService.js`
- [ ] æ”¯æŒå¤šä¸ª AI æœåŠ¡å•†ï¼ˆOpenAIã€è±†åŒ…ã€DeepSeekï¼‰
- [ ] ä»ç”¨æˆ·é…ç½®åŠ¨æ€è·å– API Key

#### ä»»åŠ¡ 1.4ï¼šé›†æˆå¾®ä¿¡åŒå£°ä¼ è¯‘æ’ä»¶
- [ ] åœ¨ `app.json` æ·»åŠ æ’ä»¶é…ç½®
- [ ] åˆ›å»º `utils/speechService.js` å°è£…è¯­éŸ³åŠŸèƒ½
- [ ] æµ‹è¯•è¯­éŸ³è¯†åˆ«åŠŸèƒ½

---

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½è¿ç§»ï¼ˆ2-3å¤©ï¼‰

#### ä»»åŠ¡ 2.1ï¼šè¿ç§»ç™»å½•åŠŸèƒ½
**æ–‡ä»¶**ï¼š`pages/login/login.js`

ä¿®æ”¹å‰ï¼š
```javascript
// è°ƒç”¨äº‘å‡½æ•°è·å–ç”¨æˆ·
const result = await apiService.getUserByEmail(email)
const loginRes = await wx.cloud.callFunction({ name: 'login' })
```

ä¿®æ”¹åï¼š
```javascript
// ç›´æ¥è°ƒç”¨ Notion API
const notionUserService = require('../../utils/notionUserService.js')
const result = await notionUserService.getUserByEmail(email)
// ç§»é™¤ openid è·å–ï¼Œä½¿ç”¨é‚®ç®±ä½œä¸ºå”¯ä¸€æ ‡è¯†
```

#### ä»»åŠ¡ 2.2ï¼šè¿ç§»æ³¨å†ŒåŠŸèƒ½
**æ–‡ä»¶**ï¼š`pages/register/register.js`

ä¿®æ”¹å‰ï¼š
```javascript
const syncResult = await apiService.createUserWithPassword(syncData)
```

ä¿®æ”¹åï¼š
```javascript
const notionUserService = require('../../utils/notionUserService.js')
const result = await notionUserService.createUser(userData)
```

#### ä»»åŠ¡ 2.3ï¼šè¿ç§»è®¾ç½®åŠŸèƒ½
**æ–‡ä»¶**ï¼š`pages/settings/settings.js`

- ç§»é™¤äº‘å‡½æ•°è°ƒç”¨
- æ”¹ç”¨ `notionUserService` æ›´æ–°ç”¨æˆ·é…ç½®

#### ä»»åŠ¡ 2.4ï¼šè¿ç§»ç›®æ ‡å¾…åŠåŠŸèƒ½
**æ–‡ä»¶**ï¼š`pages/goals-todos/goals-todos.js`

- å·²ç»ä½¿ç”¨ `notionApiService`ï¼Œåªéœ€ç§»é™¤å°‘é‡äº‘å‡½æ•°è°ƒç”¨

---

### é˜¶æ®µä¸‰ï¼šAI è¯„ä¼°åŠŸèƒ½è¿ç§»ï¼ˆ1å¤©ï¼‰

#### ä»»åŠ¡ 3.1ï¼šè¿ç§» AI å¯¹è¯åŠŸèƒ½
**æ–‡ä»¶**ï¼š`pages/assessment/assessment.js`

ä¿®æ”¹å‰ï¼š
```javascript
wx.cloud.callFunction({
  name: 'human30-assessment',
  data: { action: 'chat', data: { messages } }
})
```

ä¿®æ”¹åï¼š
```javascript
const aiService = require('../../utils/aiService.js')
const result = await aiService.chat(messages, userConfig.aiProvider)
```

#### ä»»åŠ¡ 3.2ï¼šè¿ç§»æŠ¥å‘Šç”ŸæˆåŠŸèƒ½
- ä½¿ç”¨ AI æœåŠ¡ç”ŸæˆæŠ¥å‘Š
- æŠ¥å‘Šå­˜å…¥ Notion Knowledge æ•°æ®åº“

---

### é˜¶æ®µå››ï¼šè¯­éŸ³åŠŸèƒ½è¿ç§»ï¼ˆ0.5å¤©ï¼‰

#### ä»»åŠ¡ 4.1ï¼šé›†æˆå¾®ä¿¡åŒå£°ä¼ è¯‘æ’ä»¶
**æ–‡ä»¶**ï¼š`app.json`

```json
{
  "plugins": {
    "WechatSI": {
      "version": "0.3.6",
      "provider": "wx069ba97219f66d99"
    }
  }
}
```

#### ä»»åŠ¡ 4.2ï¼šæ›´æ–°è¯­éŸ³è¯†åˆ«è°ƒç”¨
**æ–‡ä»¶**ï¼šä½¿ç”¨è¯­éŸ³åŠŸèƒ½çš„é¡µé¢

ä¿®æ”¹å‰ï¼š
```javascript
wx.cloud.callFunction({
  name: 'speechRecognition',
  data: { fileID }
})
```

ä¿®æ”¹åï¼š
```javascript
const speechService = require('../../utils/speechService.js')
const result = await speechService.recognize(tempFilePath)
```

---

### é˜¶æ®µäº”ï¼šæ¸…ç†å’Œæµ‹è¯•ï¼ˆ1å¤©ï¼‰

#### ä»»åŠ¡ 5.1ï¼šç§»é™¤äº‘å¼€å‘ä¾èµ–
- [ ] åˆ é™¤ `utils/apiService.js` ä¸­çš„äº‘å‡½æ•°è°ƒç”¨ä»£ç 
- [ ] åˆ é™¤ `app.js` ä¸­çš„ `wx.cloud.init()` è°ƒç”¨
- [ ] åˆ é™¤ `envList.js`ï¼ˆå¦‚æœä¸å†éœ€è¦ï¼‰
- [ ] æ›´æ–° `project.config.json`ï¼Œç§»é™¤äº‘å¼€å‘é…ç½®

#### ä»»åŠ¡ 5.2ï¼šæ•°æ®è¿ç§»
- [ ] å¯¼å‡º `memo_users` é›†åˆæ•°æ®
- [ ] å¯¼å…¥åˆ° Notion Users æ•°æ®åº“
- [ ] éªŒè¯ç”¨æˆ·æ•°æ®å®Œæ•´æ€§

#### ä»»åŠ¡ 5.3ï¼šå…¨åŠŸèƒ½æµ‹è¯•
- [ ] æµ‹è¯•æ³¨å†Œæµç¨‹
- [ ] æµ‹è¯•ç™»å½•æµç¨‹
- [ ] æµ‹è¯•æ•°æ®è®°å½•åŠŸèƒ½
- [ ] æµ‹è¯• AI è¯„ä¼°åŠŸèƒ½
- [ ] æµ‹è¯•è¯­éŸ³è¯†åˆ«åŠŸèƒ½
- [ ] æµ‹è¯•æ‰€æœ‰é¡µé¢åŠŸèƒ½

#### ä»»åŠ¡ 5.4ï¼šæ–‡æ¡£æ›´æ–°
- [ ] æ›´æ–° `CLAUDE.md` é¡¹ç›®è®°å¿†
- [ ] æ›´æ–° `.claude/skills.json` æŠ€èƒ½é…ç½®
- [ ] åˆ›å»ºè¿ç§»å®Œæˆè®°å½•

---

## ğŸ“ æ–°å¢/ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `utils/notionUserService.js` | Notion ç”¨æˆ·ç®¡ç†æœåŠ¡ |
| `utils/aiService.js` | AI æœåŠ¡å°è£…ï¼ˆå¤šæœåŠ¡å•†ï¼‰ |
| `utils/speechService.js` | è¯­éŸ³è¯†åˆ«æœåŠ¡å°è£… |
| `utils/cryptoService.js` | åŠ å¯†è§£å¯†æœåŠ¡ |

### ä¿®æ”¹æ–‡ä»¶
| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `utils/notionDatabaseSetup.js` | æ·»åŠ  Users æ•°æ®åº“ Schema |
| `utils/notionQuadDatabaseCreator.js` | æ·»åŠ  Users æ•°æ®åº“åˆ›å»º |
| `utils/apiService.js` | ç§»é™¤äº‘å‡½æ•°è°ƒç”¨ï¼Œä¿ç•™ Notion è°ƒç”¨ |
| `pages/login/login.js` | æ”¹ç”¨ notionUserService |
| `pages/register/register.js` | æ”¹ç”¨ notionUserService |
| `pages/settings/settings.js` | æ”¹ç”¨ notionUserService |
| `pages/assessment/assessment.js` | æ”¹ç”¨ aiService |
| `pages/goals-todos/goals-todos.js` | ç§»é™¤å°‘é‡äº‘å‡½æ•°è°ƒç”¨ |
| `app.json` | æ·»åŠ è¯­éŸ³æ’ä»¶é…ç½® |
| `app.js` | ç§»é™¤ wx.cloud.init() |
| `project.config.json` | ç§»é™¤äº‘å¼€å‘é…ç½® |

### å¯åˆ é™¤æ–‡ä»¶/ç›®å½•
| æ–‡ä»¶/ç›®å½• | è¯´æ˜ |
|-----------|------|
| `cloudfunctions/` | æ•´ä¸ªäº‘å‡½æ•°ç›®å½• |
| `cloudbase/` | CloudBase ç›®å½• |
| `envList.js` | äº‘ç¯å¢ƒé…ç½® |

---

## âš ï¸ é£é™©å’Œæ³¨æ„äº‹é¡¹

### 1. æ•°æ®è¿ç§»é£é™©
- **é£é™©**ï¼šç”¨æˆ·æ•°æ®ä¸¢å¤±
- **ç¼“è§£**ï¼šè¿ç§»å‰å®Œæ•´å¤‡ä»½äº‘æ•°æ®åº“

### 2. API Key å®‰å…¨
- **é£é™©**ï¼šç”¨æˆ· API Key æ³„éœ²
- **ç¼“è§£**ï¼š
  - å‰ç«¯åŠ å¯†å­˜å‚¨
  - Notion æ•°æ®åº“æƒé™æ§åˆ¶
  - ä¸åœ¨æœ¬åœ°æŒä¹…åŒ–æ˜æ–‡ Key

### 3. å°ç¨‹åºå®¡æ ¸
- **é£é™©**ï¼šç§»é™¤äº‘å¼€å‘å¯èƒ½å½±å“å®¡æ ¸
- **ç¼“è§£**ï¼šçº¯å‰ç«¯ + Notion API æ˜¯åˆè§„çš„

### 4. åŠŸèƒ½å›é€€
- **å»ºè®®**ï¼šä¿ç•™äº‘å‡½æ•°ä»£ç å¤‡ä»½ï¼Œä»¥ä¾¿å¿…è¦æ—¶å›é€€

---

## ğŸ“Š è¿ç§»æ”¶ç›Š

| é¡¹ç›® | è¿ç§»å‰ | è¿ç§»å |
|------|--------|--------|
| äº‘å‡½æ•°è´¹ç”¨ | æœ‰ | Â¥0 |
| äº‘æ•°æ®åº“è´¹ç”¨ | æœ‰ | Â¥0 |
| ç½‘ç»œé™åˆ¶ | æœ‰ | æ—  |
| æ¶æ„å¤æ‚åº¦ | é«˜ | ä½ |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ |
| æ•°æ®æ‰€æœ‰æƒ | å¹³å° | ç”¨æˆ· |

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç¡®è®¤è®¡åˆ’**ï¼šè¯·reviewæ­¤è®¡åˆ’ï¼Œç¡®è®¤æ— é—æ¼
2. **å¼€å§‹é˜¶æ®µä¸€**ï¼šæ›´æ–°æ•°æ®åº“åˆ›å»ºè„šæœ¬
3. **é€æ­¥å®æ–½**ï¼šæŒ‰é˜¶æ®µå®Œæˆè¿ç§»
4. **æµ‹è¯•éªŒè¯**ï¼šæ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œæµ‹è¯•

---

*è®¡åˆ’åˆ›å»ºæ—¥æœŸï¼š2026-01-21*
*é¢„è®¡å®Œæˆæ—¶é—´ï¼š5-6å¤©*
