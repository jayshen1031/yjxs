{
  "skill_name": "Notionæ•°æ®åº“è‡ªåŠ¨åˆ›å»ºæœ€ä½³å®è·µ",
  "version": "1.0.0",
  "created_date": "2025-11-02",
  "category": "Notion API",
  "description": "ä½¿ç”¨Notion APIåˆ›å»ºæ•°æ®åº“æ—¶çš„é‡è¦æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ",

  "critical_knowledge": {
    "dual_property_timing": {
      "title": "â±ï¸ dual_propertyå…³ç³»åˆ›å»ºéœ€è¦ç­‰å¾…",
      "severity": "HIGH",
      "problem": "ä½¿ç”¨dual_propertyåˆ›å»ºåŒå‘å…³ç³»æ—¶ï¼ŒNotionéœ€è¦æ—¶é—´åœ¨åå°åˆ›å»ºåå‘å…³ç³»å­—æ®µ",
      "symptom": "ç«‹å³åŸºäºåå‘å…³ç³»åˆ›å»ºrollupå­—æ®µä¼šå¤±è´¥ï¼Œé”™è¯¯ï¼š'Cannot create rollup with relation property XXX'",
      "solution": "åœ¨åˆ›å»ºå…³ç³»åç­‰å¾…5ç§’ï¼Œå†å°è¯•åˆ›å»ºä¾èµ–è¯¥å…³ç³»çš„rollupå­—æ®µ",
      "code_example": {
        "wrong": "await createActivityDetails()\nawait addRollup('Related Activities') // âŒ ç«‹å³å¤±è´¥",
        "correct": "await createActivityDetails()\nawait sleep(5000) // â±ï¸ ç­‰å¾…Notionåˆ›å»ºåå‘å…³ç³»\nawait addRollup('Related Activities') // âœ… æˆåŠŸ"
      }
    },

    "retry_mechanism": {
      "title": "ğŸ”„ Rollupå­—æ®µåˆ›å»ºéœ€è¦é‡è¯•æœºåˆ¶",
      "severity": "MEDIUM",
      "problem": "å³ä½¿ç­‰å¾…5ç§’ï¼Œç½‘ç»œå»¶è¿Ÿæˆ–Notion APIå“åº”æ…¢æ—¶ä»å¯èƒ½å¤±è´¥",
      "solution": "æ·»åŠ é‡è¯•é€»è¾‘ï¼šå¤±è´¥åå†ç­‰å¾…5ç§’é‡è¯•ä¸€æ¬¡",
      "best_practice": [
        "ç¬¬ä¸€æ¬¡å¤±è´¥ï¼šè®°å½•è­¦å‘Šï¼Œç­‰å¾…5ç§’åé‡è¯•",
        "ç¬¬äºŒæ¬¡å¤±è´¥ï¼šè®°å½•é”™è¯¯ï¼Œä½†ç»§ç»­æµç¨‹ï¼ˆrollupæ˜¯å¯é€‰å­—æ®µï¼‰",
        "æä¾›æ¸…æ™°çš„æ—¥å¿—ï¼Œå‘ŠçŸ¥ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨æ·»åŠ "
      ],
      "code_pattern": "for (let i = 0; i < 2; i++) {\n  try {\n    await createRollup()\n    break\n  } catch (error) {\n    if (i === 0) {\n      console.warn('å¤±è´¥ï¼Œ5ç§’åé‡è¯•')\n      await sleep(5000)\n    } else {\n      console.warn('åˆ›å»ºå¤±è´¥ï¼Œå¯æ‰‹åŠ¨æ·»åŠ ')\n    }\n  }\n}"
    },

    "rollup_optional": {
      "title": "ğŸ“Š Rollupå­—æ®µæ˜¯å¯é€‰çš„",
      "severity": "LOW",
      "insight": "Rollupå­—æ®µæ˜¯ç»Ÿè®¡å­—æ®µï¼Œä¸æ˜¯æ ¸å¿ƒåŠŸèƒ½",
      "design_principle": "å³ä½¿rollupåˆ›å»ºå¤±è´¥ï¼Œæ•°æ®åº“ä»ç„¶å¯ç”¨ï¼Œä¸åº”é˜»å¡æ•´ä¸ªæµç¨‹",
      "user_experience": "æä¾›æ¸…æ™°çš„è­¦å‘Šä¿¡æ¯ï¼Œå‘ŠçŸ¥ç”¨æˆ·å¯ä»¥åœ¨Notionç•Œé¢æ‰‹åŠ¨æ·»åŠ "
    }
  },

  "implementation_checklist": [
    {
      "step": 1,
      "task": "æ·»åŠ sleepå·¥å…·å‡½æ•°",
      "code": "sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)) }"
    },
    {
      "step": 2,
      "task": "åˆ›å»ºå…³ç³»å­—æ®µï¼ˆdual_propertyï¼‰",
      "note": "è¿™ä¸€æ­¥ä¼šè§¦å‘Notionåå°åˆ›å»ºåå‘å…³ç³»"
    },
    {
      "step": 3,
      "task": "ç­‰å¾…5ç§’",
      "code": "await this.sleep(5000)",
      "reason": "è®©Notionå®Œæˆåå‘å…³ç³»åˆ›å»º"
    },
    {
      "step": 4,
      "task": "åˆ›å»ºrollupå­—æ®µï¼ˆå¸¦é‡è¯•ï¼‰",
      "pattern": "forå¾ªç¯ï¼Œæœ€å¤šå°è¯•2æ¬¡ï¼Œå¤±è´¥åç­‰å¾…5ç§’"
    },
    {
      "step": 5,
      "task": "è®°å½•è¯¦ç»†æ—¥å¿—",
      "requirements": [
        "æˆåŠŸï¼šâœ… å·²æ·»åŠ  XXX rollupå­—æ®µ",
        "ç¬¬ä¸€æ¬¡å¤±è´¥ï¼šâš ï¸ XXX rollupå­—æ®µåˆ›å»ºå¤±è´¥ï¼Œ5ç§’åé‡è¯•...",
        "ç¬¬äºŒæ¬¡å¤±è´¥ï¼šâš ï¸ XXX rollupå­—æ®µåˆ›å»ºå¤±è´¥ï¼ˆå¯é€‰å­—æ®µï¼Œå¯åœ¨Notionç•Œé¢æ‰‹åŠ¨æ·»åŠ ï¼‰"
      ]
    }
  ],

  "timing_recommendations": {
    "initial_wait": {
      "duration": "5ç§’",
      "location": "åˆ›å»ºå…³ç³»å­—æ®µåï¼Œæ·»åŠ rollupå­—æ®µå‰",
      "reason": "ç»™Notionæ—¶é—´åˆ›å»ºåå‘å…³ç³»"
    },
    "retry_wait": {
      "duration": "5ç§’",
      "location": "ç¬¬ä¸€æ¬¡rollupåˆ›å»ºå¤±è´¥å",
      "reason": "ç½‘ç»œå»¶è¿Ÿæˆ–Notion APIå“åº”æ…¢"
    },
    "total_overhead": {
      "best_case": "5ç§’ï¼ˆæ‰€æœ‰rollupç¬¬ä¸€æ¬¡æˆåŠŸï¼‰",
      "worst_case": "20ç§’ï¼ˆ3ä¸ªrollupå„é‡è¯•1æ¬¡ï¼‰",
      "acceptable": "ç”¨æˆ·ä½“éªŒä¼˜äºåˆ›å»ºå¤±è´¥åæ‰‹åŠ¨æ·»åŠ "
    }
  },

  "error_handling_strategy": {
    "principle": "ä¼˜é›…é™çº§",
    "levels": [
      {
        "level": "å…³é”®å­—æ®µï¼ˆæ•°æ®åº“æœ¬èº«ï¼‰",
        "strategy": "å¤±è´¥å³ä¸­æ–­ï¼ŒæŠ›å‡ºé”™è¯¯"
      },
      {
        "level": "é‡è¦å­—æ®µï¼ˆrelationå…³ç³»ï¼‰",
        "strategy": "å¤±è´¥å¯é‡è¯•ï¼Œä½†ä¸åº”ç»§ç»­"
      },
      {
        "level": "å¯é€‰å­—æ®µï¼ˆrollupç»Ÿè®¡ï¼‰",
        "strategy": "å¤±è´¥åè­¦å‘Šï¼Œç»§ç»­æµç¨‹"
      }
    ]
  },

  "real_world_example": {
    "project": "è¯­å¯„å¿ƒå£°å¾®ä¿¡å°ç¨‹åº",
    "file": "utils/notionQuadDatabaseCreator.js",
    "scenario": "åˆ›å»º8æ•°æ®åº“æ¶æ„",
    "affected_rollups": [
      "Total Time (ä¸»è®°å½•è¡¨)",
      "Activity Count (ä¸»è®°å½•è¡¨)",
      "Actual Time (å¾…åŠåº“)"
    ],
    "solution_location": {
      "sleep_function": "ç¬¬23-28è¡Œ",
      "wait_after_activity_db": "ç¬¬90-93è¡Œ",
      "rollup_retry_logic": "ç¬¬573-636è¡Œ, 667-698è¡Œ"
    }
  },

  "lessons_learned": [
    "Notion APIçš„å¼‚æ­¥ç‰¹æ€§éœ€è¦æ˜¾å¼ç­‰å¾…",
    "ä¸è¦å‡è®¾APIè°ƒç”¨ç«‹å³ç”Ÿæ•ˆ",
    "å…³é”®å­—æ®µå’Œå¯é€‰å­—æ®µè¦åŒºåˆ«å¯¹å¾…",
    "é‡è¯•æœºåˆ¶è¦æœ‰ä¸Šé™ï¼Œé¿å…æ— é™å¾ªç¯",
    "è¯¦ç»†çš„æ—¥å¿—å¯¹æ’æŸ¥é—®é¢˜è‡³å…³é‡è¦",
    "ç”¨æˆ·ä½“éªŒä¼˜å…ˆï¼š5-20ç§’ç­‰å¾… > åˆ›å»ºå¤±è´¥æ‰‹åŠ¨ä¿®å¤"
  ],

  "anti_patterns": [
    {
      "pattern": "ç«‹å³åˆ›å»ºrollup",
      "why_wrong": "åå‘å…³ç³»è¿˜æ²¡åˆ›å»ºå¥½",
      "result": "400é”™è¯¯ï¼Œrollupåˆ›å»ºå¤±è´¥"
    },
    {
      "pattern": "æ— é™é‡è¯•",
      "why_wrong": "å¯èƒ½å¡ä½æµç¨‹",
      "result": "ç”¨æˆ·ç­‰å¾…è¿‡ä¹…ï¼Œä½“éªŒå·®"
    },
    {
      "pattern": "rollupå¤±è´¥å°±ä¸­æ–­",
      "why_wrong": "rollupä¸æ˜¯æ ¸å¿ƒåŠŸèƒ½",
      "result": "é˜»å¡äº†æ•´ä¸ªæ•°æ®åº“åˆ›å»º"
    },
    {
      "pattern": "æ²¡æœ‰è¯¦ç»†æ—¥å¿—",
      "why_wrong": "ç”¨æˆ·ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ",
      "result": "è°ƒè¯•å›°éš¾ï¼Œç”¨æˆ·å›°æƒ‘"
    }
  ],

  "testing_tips": {
    "test_scenarios": [
      "æ­£å¸¸æƒ…å†µï¼šæ‰€æœ‰rollupç¬¬ä¸€æ¬¡æˆåŠŸ",
      "ç½‘ç»œæ…¢ï¼šéœ€è¦é‡è¯•çš„æƒ…å†µ",
      "APIæ•…éšœï¼šä¸¤æ¬¡éƒ½å¤±è´¥çš„æƒ…å†µ"
    ],
    "verification": [
      "æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åˆ›å»ºæˆåŠŸ",
      "æ£€æŸ¥rollupå­—æ®µæ˜¯å¦å­˜åœ¨",
      "æ£€æŸ¥æ—¥å¿—è¾“å‡ºæ˜¯å¦æ¸…æ™°",
      "æ£€æŸ¥å¤±è´¥åç³»ç»Ÿæ˜¯å¦ä»å¯ç”¨"
    ]
  },

  "references": {
    "notion_api_docs": "https://developers.notion.com/reference/property-object#relation",
    "project_memory": "CLAUDE.md (ç¬¬1569-1684è¡Œ)",
    "iteration_log": "è¿­ä»£è®°å½•/2025-11-02_å…«æ•°æ®åº“è‡ªåŠ¨åˆ›å»ºä¼˜åŒ–.md",
    "related_skills": [
      "wechat-console-critical-rules.skill.json",
      "notion-database.skill.json"
    ]
  }
}
