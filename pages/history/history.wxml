<view class="container">
  <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
  <view class="date-selector">
    <button class="date-btn" bindtap="previousDay">â—€ å‰ä¸€å¤©</button>
    <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
      <view class="date-display">{{ selectedDateDisplay }}</view>
    </picker>
    <button class="date-btn" bindtap="nextDay">åä¸€å¤© â–¶</button>
    <button class="today-btn" bindtap="goToToday">ä»Šå¤©</button>
  </view>

  <!-- ä»Šæ—¥ç»Ÿè®¡ -->
  <view class="stats-card">
    <view class="stats-title">ğŸ“Š ä»Šæ—¥ç»Ÿè®¡</view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-label">æ€»æ—¶é•¿</view>
        <view class="stat-value">{{ stats.totalHours }}h</view>
      </view>
      <view class="stat-item">
        <view class="stat-label">ç³»ç»Ÿç›®æ ‡</view>
        <view class="stat-value system-goal-color">{{ stats.systemGoalHours }}h</view>
      </view>
      <view class="stat-item">
        <view class="stat-label">æ¯æ—¥äº‹é¡¹</view>
        <view class="stat-value daily-task-color">{{ stats.dailyTaskHours }}h</view>
      </view>
      <view class="stat-item">
        <view class="stat-label">æµæ°´è´¦</view>
        <view class="stat-value journal-color">{{ stats.journalHours }}h</view>
      </view>
      <view class="stat-item">
        <view class="stat-label">æ´»åŠ¨æ•°</view>
        <view class="stat-value">{{ stats.activityCount }}</view>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨æ˜ç»†è¡¨æ ¼ -->
  <view class="activities-section">
    <view class="section-header">
      <view class="section-title">â±ï¸ ä»Šæ—¥æ´»åŠ¨æ˜ç»†ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰</view>
      <button class="refresh-btn" bindtap="loadActivities" disabled="{{ isLoading }}">
        {{ isLoading ? 'åŠ è½½ä¸­...' : 'ğŸ”„ åˆ·æ–°' }}
      </button>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{ activities.length === 0 && !isLoading }}" class="empty-state">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•æ´»åŠ¨</view>
      <view class="empty-hint">ç‚¹å‡»ä¸‹æ–¹"æ·»åŠ æ´»åŠ¨"å¼€å§‹è®°å½•</view>
    </view>

    <!-- æ´»åŠ¨è¡¨æ ¼ -->
    <scroll-view wx:if="{{ activities.length > 0 }}" class="table-scroll" scroll-y>
      <view class="activity-table">
        <!-- è¡¨å¤´ -->
        <view class="table-header">
          <view class="th time-col">å¼€å§‹</view>
          <view class="th time-col">ç»“æŸ</view>
          <view class="th name-col">æ´»åŠ¨</view>
          <view class="th relation-col">å…³è”</view>
          <view class="th status-col">çŠ¶æ€</view>
          <view class="th duration-col">æ—¶é•¿</view>
          <view class="th action-col">æ“ä½œ</view>
        </view>

        <!-- è¡¨æ ¼å†…å®¹ -->
        <view
          wx:for="{{ activities }}"
          wx:key="id"
          class="table-row activity-row {{ item.activityTypeClass }}"
        >
          <!-- å¼€å§‹æ—¶é—´ -->
          <view class="td time-col time-cell">{{ item.startTimeDisplay }}</view>

          <!-- ç»“æŸæ—¶é—´ -->
          <view class="td time-col time-cell">{{ item.endTimeDisplay }}</view>

          <!-- æ´»åŠ¨åç§° -->
          <view class="td name-col activity-name-cell">{{ item.activityName }}</view>

          <!-- å…³è” -->
          <view class="td relation-col relation-cell">
            <view wx:if="{{ item.relatedGoalName }}" class="relation-item">
              ğŸ¯ {{ item.relatedGoalName }}
            </view>
            <view wx:if="{{ item.relatedTodoName }}" class="relation-item">
              âœ… {{ item.relatedTodoName }}
            </view>
            <view wx:if="{{ item.relatedKnowledgeName }}" class="relation-item">
              ğŸ“š {{ item.relatedKnowledgeName }}
            </view>
            <view wx:if="{{ !item.relatedGoalName && !item.relatedTodoName && !item.relatedKnowledgeName }}">
              -
            </view>
          </view>

          <!-- çŠ¶æ€ -->
          <view class="td status-col status-cell">{{ item.statusDisplay }}</view>

          <!-- æ—¶é•¿ -->
          <view class="td duration-col duration-cell">{{ item.durationDisplay }}</view>

          <!-- æ“ä½œ -->
          <view class="td action-col action-cell">
            <button class="action-btn edit-btn" bindtap="editActivity" data-id="{{ item.id }}">âœï¸</button>
            <button class="action-btn delete-btn" bindtap="deleteActivity" data-id="{{ item.id }}">ğŸ—‘ï¸</button>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ·»åŠ æ´»åŠ¨æŒ‰é’® -->
  <view class="add-button-container">
    <button class="add-activity-btn" bindtap="showAddActivityDialog">
      + æ·»åŠ æ´»åŠ¨
    </button>
  </view>

  <!-- æç¤ºä¿¡æ¯ -->
  <view class="tips-card">
    <view class="tips-title">ğŸ’¡ æç¤º</view>
    <view class="tips-list">
      <view class="tip-item">â€¢ ç³»ç»Ÿç›®æ ‡æ˜¾ç¤ºè¿›åº¦ï¼ˆå¦‚ï¼š122/500hï¼‰</view>
      <view class="tip-item">â€¢ æ¯æ—¥äº‹é¡¹æ˜¾ç¤ºçŠ¶æ€ï¼ˆè¿›è¡Œä¸­/å·²å®Œæˆï¼‰</view>
      <view class="tip-item">â€¢ æµæ°´è´¦ä¸æ˜¾ç¤ºçŠ¶æ€</view>
    </view>
  </view>
</view>

<!-- æ·»åŠ æ´»åŠ¨å¼¹çª—ï¼ˆåç»­å®ç°ï¼‰ -->
<view wx:if="{{ showAddDialog }}" class="modal-overlay" bindtap="closeAddDialog">
  <view class="add-activity-modal" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">æ·»åŠ æ´»åŠ¨</view>
      <button class="close-btn" bindtap="closeAddDialog">Ã—</button>
    </view>

    <!-- å¼¹çª—å†…å®¹ï¼ˆå¾…å®ç°ï¼‰ -->
    <view class="modal-body">
      <view class="coming-soon">åŠŸèƒ½å¼€å‘ä¸­...</view>
    </view>
  </view>
</view>