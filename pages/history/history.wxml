<view class="container">
  <!-- é¡µé¢æ ‡é¢˜è¯´æ˜ -->
  <view class="page-header">
    <view class="header-top">
      <view class="header-left">
        <view class="page-title">â±ï¸ æˆ‘çš„è¶³è¿¹</view>
        <view class="page-desc">çœ‹çœ‹æ—¶é—´éƒ½å»å“ªäº†ï¼Œæ¯ä¸€åˆ†é’Ÿéƒ½å€¼å¾—å›é¡¾</view>
      </view>
      <view class="refresh-btn" bindtap="onRefresh">
        <text class="refresh-icon">ğŸ”„</text>
      </view>
    </view>
  </view>

  <!-- æ—¥æœŸé€‰æ‹©å’Œç»Ÿè®¡ -->
  <view class="header-section">
    <view class="date-selector">
      <picker mode="date" value="{{ selectedDate }}" bindchange="onDateChange" start="2020-01-01" end="{{ todayDate }}">
        <view class="date-picker">
          <text class="date-text">{{ selectedDateDisplay }}</text>
          <text class="date-icon">ğŸ“…</text>
        </view>
      </picker>
    </view>
    
    <!-- æ ¸å¿ƒç»Ÿè®¡å¡ç‰‡ - åªæ˜¾ç¤ºæœ‰æ„ä¹‰çš„æŒ‡æ ‡ -->
    <view class="stats-grid-simple">
      <view class="stat-card valuable" bindtap="showStatsDebug">
        <view class="stat-icon">âœ…</view>
        <view class="stat-number">{{ stats.valuableMinutes }}</view>
        <view class="stat-label">åˆ†é’Ÿ</view>
      </view>
      <view class="stat-card wasteful" bindtap="showStatsDebug">
        <view class="stat-icon">âš ï¸</view>
        <view class="stat-number">{{ stats.wastefulMinutes }}</view>
        <view class="stat-label">åˆ†é’Ÿ</view>
      </view>
    </view>
  </view>

  <!-- é«˜çº§ç­›é€‰ -->
  <view class="advanced-filter">
    <view class="filter-header" bindtap="toggleFilterPanel">
      <text class="filter-title">é«˜çº§ç­›é€‰</text>
      <text class="filter-arrow {{ showFilterPanel ? 'active' : '' }}">â–¼</text>
    </view>
    
    <view class="filter-panel {{ showFilterPanel ? 'show' : '' }}">
      <!-- æ ‡ç­¾ç­›é€‰ -->
      <view class="filter-group">
        <view class="filter-label">æ ‡ç­¾ç­›é€‰</view>
        <view class="tag-filter">
          <view class="filter-tag {{ selectedTags.indexOf(item) !== -1 ? 'selected' : '' }}" wx:for="{{ allTags }}" wx:key="index" bindtap="toggleTagFilter" data-tag="{{ item }}">
            {{ item }}
          </view>
        </view>
      </view>

      <!-- æ—¶é—´èŒƒå›´ç­›é€‰ -->
      <view class="filter-group">
        <view class="filter-label">æ—¶é—´èŒƒå›´</view>
        <view class="time-range-filter">
          <view class="time-range-item {{ timeRange === item.value ? 'active' : '' }}" wx:for="{{ timeRangeOptions }}" wx:key="value" bindtap="setTimeRange" data-range="{{ item.value }}">
            {{ item.label }}
          </view>
        </view>
      </view>

      <!-- æ’åºæ–¹å¼ -->
      <view class="filter-group">
        <view class="filter-label">æ’åºæ–¹å¼</view>
        <view class="sort-options">
          <view class="sort-option {{ sortBy === item.value ? 'active' : '' }}" wx:for="{{ sortOptions }}" wx:key="value" bindtap="setSortBy" data-sort="{{ item.value }}">
            {{ item.label }}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="memo-list" wx:if="{{ filteredMemos.length > 0 }}">
    <!-- æŒ‰æ—¥æœŸåˆ†ç»„æ˜¾ç¤º -->
    <view class="date-group" wx:for="{{ groupedMemos }}" wx:key="date">
      <view class="date-header">
        <text class="date-title">{{ item.dateDisplay }}</text>
        <text class="date-count">{{ item.memos.length }}æ¡</text>
      </view>
      
      <view class="memo-item" wx:for="{{ item.memos }}" wx:key="id" wx:for-item="memo">
        <!-- æ´»åŠ¨æ—¶é—´æ®µåˆ—è¡¨ - æå‡ä¸ºä¸»è¦å†…å®¹ -->
        <view class="activity-list-primary" wx:if="{{ memo.activities && memo.activities.length > 0 }}">
          <view class="activity-header">
            <view class="activity-header-left">
              <text class="activity-period">{{ memo.timePeriodDisplay }}</text>
              <text class="activity-summary">{{ memo.activities.length }}é¡¹æ´»åŠ¨</text>
            </view>
            <view class="activity-actions">
              <text class="action-btn edit-btn" bindtap="editMemo" data-id="{{ memo.id }}">âœï¸</text>
              <text class="action-btn delete-btn" bindtap="deleteMemo" data-id="{{ memo.id }}">ğŸ—‘ï¸</text>
            </view>
          </view>
          <view class="activity-item" wx:for="{{ memo.activities }}" wx:key="index" wx:for-item="activity">
            <view class="activity-icon" data-type="{{ activity.activityType }}">
              <text wx:if="{{ activity.activityType.includes('æœ‰ä»·å€¼') || activity.activityType === 'valuable' }}">âœ…</text>
              <text wx:elif="{{ activity.activityType.includes('ä½æ•ˆ') || activity.activityType === 'wasteful' }}">âš ï¸</text>
              <text wx:else>ğŸ“Š</text>
            </view>
            <view class="activity-info">
              <view class="activity-name">{{ activity.name }}</view>
              <view class="activity-meta">
                <text class="activity-duration">{{ activity.duration }}åˆ†é’Ÿ</text>
              </view>
            </view>
          </view>
        </view>

        <!-- æ— æ´»åŠ¨æ˜ç»†æ—¶æ˜¾ç¤ºåŸè®°å½• -->
        <view class="memo-content-fallback" wx:else>
          <view class="memo-header">
            <view class="memo-header-left">
              <view class="memo-type {{ memo.isPlanning ? 'planning' : memo.type }}">
                <text>{{ memo.isPlanning ? 'ğŸ“‹' : (memo.type === 'voice' ? 'ğŸ¤' : 'ğŸ“') }}</text>
              </view>
              <view class="memo-time-info">
                <view class="time-period-main">{{ memo.timePeriodDisplay }}</view>
              </view>
            </view>
            <view class="activity-actions">
              <text class="action-btn edit-btn" bindtap="editMemo" data-id="{{ memo.id }}">âœï¸</text>
              <text class="action-btn delete-btn" bindtap="deleteMemo" data-id="{{ memo.id }}">ğŸ—‘ï¸</text>
            </view>
          </view>

          <view class="memo-text">{{ memo.content }}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-state">
    <view class="empty-icon">ğŸ—‚ï¸</view>
    <view class="empty-text">
      <text wx:if="{{ hasActiveFilters }}">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•</text>
      <text wx:else>æš‚æ— å†å²è®°å½•</text>
    </view>
    <button wx:if="{{ hasActiveFilters }}" class="btn btn-secondary" bindtap="clearFilters">
      <text>æ¸…é™¤ç­›é€‰</text>
    </button>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{ filteredMemos.length > 0 && hasMore }}">
    <button class="btn btn-secondary" bindtap="loadMore" loading="{{ isLoading }}">
      <text>{{ isLoading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š' }}</text>
    </button>
  </view>

  <!-- æ‚¬æµ®çš„æ–°å»ºè®°å½•æŒ‰é’® -->
  <view class="float-add-btn" bindtap="createNewRecord">
    <text class="add-icon">âœï¸</text>
  </view>
</view>