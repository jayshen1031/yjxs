<view class="container">
  <!-- é¡µé¢æ ‡é¢˜è¯´æ˜ -->
  <view class="page-header">
    <view class="page-title">å®Œæ•´å†å²è®°å½•</view>
    <view class="page-desc">é«˜çº§ç­›é€‰ã€æœç´¢å’Œç®¡ç†æ‰€æœ‰è®°å½•</view>
  </view>

  <!-- æ—¥æœŸé€‰æ‹©å’Œç»Ÿè®¡ -->
  <view class="header-section">
    <view class="date-selector">
      <picker mode="date" value="{{ selectedDate }}" bindchange="onDateChange" start="2020-01-01" end="{{ todayDate }}">
        <view class="date-picker">
          <text class="date-text">{{ selectedDateDisplay }}</text>
          <text class="date-icon">ğŸ“…</text>
        </view>
      </picker>
    </view>
    
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-number">{{ stats.total }}</view>
        <view class="stat-label">æ€»è®°å½•</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{ stats.text }}</view>
        <view class="stat-label">æ–‡å­—è®°å½•</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{ stats.voice }}</view>
        <view class="stat-label">è¯­éŸ³è®°å½•</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{ stats.todayCount }}</view>
        <view class="stat-label">ä»Šæ—¥è®°å½•</view>
      </view>
    </view>
  </view>

  <!-- é«˜çº§ç­›é€‰ -->
  <view class="advanced-filter">
    <view class="filter-header" bindtap="toggleFilterPanel">
      <text class="filter-title">é«˜çº§ç­›é€‰</text>
      <text class="filter-arrow {{ showFilterPanel ? 'active' : '' }}">â–¼</text>
    </view>
    
    <view class="filter-panel {{ showFilterPanel ? 'show' : '' }}">
      <!-- æ ‡ç­¾ç­›é€‰ -->
      <view class="filter-group">
        <view class="filter-label">æ ‡ç­¾ç­›é€‰</view>
        <view class="tag-filter">
          <view class="filter-tag {{ selectedTags.indexOf(item) !== -1 ? 'selected' : '' }}" wx:for="{{ allTags }}" wx:key="index" bindtap="toggleTagFilter" data-tag="{{ item }}">
            {{ item }}
          </view>
        </view>
      </view>

      <!-- æ—¶é—´èŒƒå›´ç­›é€‰ -->
      <view class="filter-group">
        <view class="filter-label">æ—¶é—´èŒƒå›´</view>
        <view class="time-range-filter">
          <view class="time-range-item {{ timeRange === item.value ? 'active' : '' }}" wx:for="{{ timeRangeOptions }}" wx:key="value" bindtap="setTimeRange" data-range="{{ item.value }}">
            {{ item.label }}
          </view>
        </view>
      </view>

      <!-- æ’åºæ–¹å¼ -->
      <view class="filter-group">
        <view class="filter-label">æ’åºæ–¹å¼</view>
        <view class="sort-options">
          <view class="sort-option {{ sortBy === item.value ? 'active' : '' }}" wx:for="{{ sortOptions }}" wx:key="value" bindtap="setSortBy" data-sort="{{ item.value }}">
            {{ item.label }}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="memo-list" wx:if="{{ filteredMemos.length > 0 }}">
    <!-- æŒ‰æ—¥æœŸåˆ†ç»„æ˜¾ç¤º -->
    <view class="date-group" wx:for="{{ groupedMemos }}" wx:key="date">
      <view class="date-header">
        <text class="date-title">{{ item.dateDisplay }}</text>
        <text class="date-count">{{ item.memos.length }}æ¡</text>
      </view>
      
      <view class="memo-item" wx:for="{{ item.memos }}" wx:key="id" wx:for-item="memo">
        <view class="memo-content" bindtap="viewMemoDetail" data-memo="{{ memo }}">
          <view class="memo-header">
            <view class="memo-type {{ memo.isPlanning ? 'planning' : memo.type }}">
              <text>{{ memo.isPlanning ? 'ğŸ“‹' : (memo.type === 'voice' ? 'ğŸ¤' : 'ğŸ“') }}</text>
            </view>
            <view class="memo-time">{{ memo.timeStr }}</view>
            <view class="memo-actions">
              <button class="action-btn" wx:if="{{ memo.type === 'voice' }}" catchtap="playVoice" data-memo="{{ memo }}">
                <text>{{ memo.isPlaying ? 'â¸ï¸' : 'â–¶ï¸' }}</text>
              </button>
              <button class="action-btn" catchtap="editMemo" data-memo="{{ memo }}">
                <text>âœï¸</text>
              </button>
              <button class="action-btn delete" catchtap="deleteMemo" data-memo="{{ memo }}">
                <text>ğŸ—‘ï¸</text>
              </button>
            </view>
          </view>
          
          <view class="memo-text">{{ memo.content }}</view>
          
          <view class="memo-labels">
            <text class="tag period-{{ memo.periodColor }}">{{ memo.timePeriod }}</text>
            <text class="tag category-{{ memo.categoryColor }}">{{ memo.category }}</text>
          </view>
          
          <view class="memo-tags" wx:if="{{ memo.tags && memo.tags.length > 0 }}">
            <text class="tag user-tag" wx:for="{{ memo.tags }}" wx:key="index" wx:for-item="tag">{{ tag }}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-state">
    <view class="empty-icon">ğŸ—‚ï¸</view>
    <view class="empty-text">
      <text wx:if="{{ hasActiveFilters }}">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•</text>
      <text wx:else>æš‚æ— å†å²è®°å½•</text>
    </view>
    <button wx:if="{{ hasActiveFilters }}" class="btn btn-secondary" bindtap="clearFilters">
      <text>æ¸…é™¤ç­›é€‰</text>
    </button>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{ filteredMemos.length > 0 && hasMore }}">
    <button class="btn btn-secondary" bindtap="loadMore" loading="{{ isLoading }}">
      <text>{{ isLoading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š' }}</text>
    </button>
  </view>
</view>