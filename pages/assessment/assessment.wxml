<view class="container">
  <!-- é¡¶éƒ¨è¿›åº¦æ¡ -->
  <view class="progress-section">
    <view class="progress-header">
      <view class="quadrant-name">
        <view class="quadrant-icon">{{currentQuadrantInfo.icon}}</view>
        <view class="quadrant-text">{{currentQuadrantInfo.name}}</view>
      </view>
      <view class="progress-count">{{questionCount}}/{{estimatedTotal}}</view>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{overallProgress}}%"></view>
    </view>
    <view class="progress-label">æ€»ä½“è¿›åº¦ {{overallProgress}}%</view>
  </view>

  <!-- å¯¹è¯åŒºåŸŸ -->
  <scroll-view class="chat-area" scroll-y scroll-into-view="{{scrollToView}}" scroll-with-animation>
    <!-- å¯¹è¯æ¶ˆæ¯åˆ—è¡¨ -->
    <view class="messages-list">
      <block wx:for="{{messages}}" wx:key="index">
        <!-- AIæ¶ˆæ¯ -->
        <view class="message-item message-ai" wx:if="{{item.role === 'assistant'}}" id="msg-{{index}}">
          <view class="message-avatar">ğŸ¤–</view>
          <view class="message-bubble bubble-ai">
            <text class="message-text">{{item.content}}</text>
          </view>
        </view>

        <!-- ç”¨æˆ·æ¶ˆæ¯ -->
        <view class="message-item message-user" wx:if="{{item.role === 'user'}}" id="msg-{{index}}">
          <view class="message-bubble bubble-user">
            <text class="message-text">{{item.content}}</text>
          </view>
          <view class="message-avatar">ğŸ‘¤</view>
        </view>
      </block>

      <!-- åŠ è½½ä¸­æç¤º -->
      <view class="message-item message-ai" wx:if="{{isLoading}}">
        <view class="message-avatar">ğŸ¤–</view>
        <view class="message-bubble bubble-ai">
          <view class="loading-dots">
            <view class="dot"></view>
            <view class="dot"></view>
            <view class="dot"></view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-section">
    <!-- æç¤ºæ–‡æœ¬ -->
    <view class="input-hint" wx:if="{{!userInput}}">
      ğŸ’¡ è¯·è¯¦ç»†å›ç­”ï¼Œé¿å…ç®€å•çš„"æ˜¯"æˆ–"å¦"
    </view>

    <!-- è¾“å…¥æ¡† -->
    <view class="input-container">
      <textarea
        class="input-box"
        placeholder="è¾“å…¥ä½ çš„å›ç­”..."
        value="{{userInput}}"
        bindinput="onInput"
        auto-height
        maxlength="1000"
        show-confirm-bar="{{false}}"
      />
      <view class="input-actions">
        <view class="char-count">{{userInput.length}}/1000</view>
        <button class="btn-voice" bindtap="startVoiceInput" wx:if="{{!isRecording}}">
          ğŸ¤
        </button>
        <button class="btn-voice recording" bindtap="stopVoiceInput" wx:if="{{isRecording}}">
          â¹ï¸
        </button>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="button-row">
      <button class="btn btn-save" bindtap="saveProgress">ğŸ’¾ æš‚åœä¿å­˜</button>
      <button class="btn btn-submit" bindtap="submitAnswer" disabled="{{!userInput || isLoading}}">
        â¡ï¸ æäº¤ç­”æ¡ˆ
      </button>
    </view>

    <!-- æå‰ç”ŸæˆæŠ¥å‘ŠæŒ‰é’®ï¼ˆæµ‹è¯•ç”¨ï¼Œé—®é¢˜æ•°>=4æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="button-row" wx:if="{{questionCount >= 4 && questionCount < 10}}">
      <button class="btn btn-test-report" bindtap="generateReport">
        ğŸ§ª æå‰ç”ŸæˆæŠ¥å‘Šï¼ˆæµ‹è¯•ï¼‰
      </button>
      <view class="test-hint">âš ï¸ æ­£å¸¸éœ€è¦å›ç­”{{estimatedTotal}}ä¸ªé—®é¢˜</view>
    </view>

    <!-- æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®ï¼ˆé—®é¢˜æ•°>=10æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="button-row" wx:if="{{questionCount >= 10}}">
      <button class="btn btn-report" bindtap="generateReport">
        ğŸ“Š æŸ¥çœ‹å½“å‰è¯„ä¼°æŠ¥å‘Š
      </button>
    </view>
  </view>
</view>
