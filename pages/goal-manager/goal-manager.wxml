<view class="container">
  <!-- ç›®æ ‡ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stats-row">
        <view class="stat-item">
          <view class="stat-number">{{goalStats.total}}</view>
          <view class="stat-label">æ€»ç›®æ ‡</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{goalStats.active}}</view>
          <view class="stat-label">è¿›è¡Œä¸­</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{goalStats.completed}}</view>
          <view class="stat-label">å·²å®Œæˆ</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{goalStats.averageProgress}}%</view>
          <view class="stat-label">å¹³å‡è¿›åº¦</view>
        </view>
      </view>
    </view>
    
    <!-- å¿«é€Ÿæ“ä½œ -->
    <view class="quick-actions">
      <button class="action-btn primary" bindtap="addGoal">
        <text class="icon">ğŸ¯</text>
        <text>æ–°å»ºç›®æ ‡</text>
      </button>
      <button class="action-btn secondary" bindtap="showToday">
        <text class="icon">ğŸ“…</text>
        <text>ä»Šæ—¥ç›®æ ‡</text>
      </button>
      <button class="action-btn secondary" bindtap="showSettings">
        <text class="icon">âš™ï¸</text>
        <text>è®¾ç½®</text>
      </button>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæœç´¢ -->
  <view class="filter-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢ç›®æ ‡æ ‡é¢˜æˆ–æè¿°..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-icon">ğŸ”</text>
    </view>
    
    <!-- ç±»å‹ç­›é€‰ -->
    <scroll-view class="type-filter" scroll-x="true">
      <view class="filter-item {{selectedType === '' ? 'active' : ''}}" bindtap="filterByType" data-type="">
        å…¨éƒ¨ ({{goalStats.total}})
      </view>
      <view class="filter-item {{selectedType === 'short' ? 'active' : ''}}" bindtap="filterByType" data-type="short">
        çŸ­æœŸ ({{goalStats.shortTerm}})
      </view>
      <view class="filter-item {{selectedType === 'medium' ? 'active' : ''}}" bindtap="filterByType" data-type="medium">
        ä¸­æœŸ ({{goalStats.mediumTerm}})
      </view>
      <view class="filter-item {{selectedType === 'long' ? 'active' : ''}}" bindtap="filterByType" data-type="long">
        é•¿æœŸ ({{goalStats.longTerm}})
      </view>
    </scroll-view>
    
    <!-- çŠ¶æ€ç­›é€‰ -->
    <scroll-view class="status-filter" scroll-x="true">
      <view class="status-chip {{selectedStatus === '' ? 'active' : ''}}" bindtap="filterByStatus" data-status="">
        å…¨éƒ¨çŠ¶æ€
      </view>
      <view class="status-chip {{selectedStatus === 'active' ? 'active' : ''}}" bindtap="filterByStatus" data-status="active">
        è¿›è¡Œä¸­
      </view>
      <view class="status-chip {{selectedStatus === 'completed' ? 'active' : ''}}" bindtap="filterByStatus" data-status="completed">
        å·²å®Œæˆ
      </view>
      <view class="status-chip {{selectedStatus === 'paused' ? 'active' : ''}}" bindtap="filterByStatus" data-status="paused">
        å·²æš‚åœ
      </view>
    </scroll-view>
  </view>

  <!-- ç›®æ ‡åˆ—è¡¨ -->
  <view class="goals-section">
    <view class="section-header">
      <view class="section-title">
        <text class="icon">ğŸ“‹</text>
        <text>ç›®æ ‡åˆ—è¡¨ ({{filteredGoals.length}})</text>
      </view>
      <view class="sort-options">
        <picker bindchange="onSortChange" value="{{sortIndex}}" range="{{sortOptions}}" range-key="label">
          <view class="sort-btn">
            <text>{{sortOptions[sortIndex].label}}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <scroll-view class="goals-list" scroll-y="true">
      <view 
        class="goal-item goal-{{goal.type}} priority-{{goal.priority}}" 
        wx:for="{{filteredGoals}}" 
        wx:key="id"
        wx:for-item="goal"
      >
        <view class="goal-header">
          <view class="goal-title">{{goal.title}}</view>
          <view class="goal-actions">
            <view class="action-icon" bindtap="toggleGoalStatus" data-id="{{goal.id}}">
              <text>{{goal.status === 'active' ? 'â¸ï¸' : goal.status === 'completed' ? 'âœ…' : 'â–¶ï¸'}}</text>
            </view>
            <view class="action-icon" bindtap="editGoal" data-id="{{goal.id}}">
              <text>âœï¸</text>
            </view>
          </view>
        </view>
        
        <view class="goal-content">
          <view class="goal-description" wx:if="{{goal.description}}">{{goal.description}}</view>
          
          <!-- è¿›åº¦æ¡ -->
          <view class="progress-section">
            <view class="progress-header">
              <text class="progress-label">è¿›åº¦</text>
              <text class="progress-value">{{goal.progress}}%</text>
            </view>
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{goal.progress}}%"></view>
            </view>
          </view>
          
          <!-- ç›®æ ‡æ ‡ç­¾ -->
          <view class="goal-meta">
            <view class="goal-tags">
              <view class="type-tag type-{{goal.type}}">{{goal.type === 'short' ? 'çŸ­æœŸ' : goal.type === 'medium' ? 'ä¸­æœŸ' : 'é•¿æœŸ'}}</view>
              <view class="priority-tag priority-{{goal.priority}}">{{goal.priority === 'high' ? 'é«˜ä¼˜å…ˆçº§' : goal.priority === 'low' ? 'ä½ä¼˜å…ˆçº§' : 'ä¸­ä¼˜å…ˆçº§'}}</view>
              <view class="category-tag">{{goal.category}}</view>
              <view class="deadline-tag" wx:if="{{goal.targetDate}}">
                {{goal.deadlineText}}
              </view>
            </view>
            <view class="goal-info">
              <text class="milestone-count" wx:if="{{goal.milestones.length > 0}}">
                ğŸ“ {{goal.completedMilestones}}/{{goal.milestones.length}} é‡Œç¨‹ç¢‘
              </text>
              <text class="memo-count" wx:if="{{goal.relatedMemos.length > 0}}">
                ğŸ“ {{goal.relatedMemos.length}} æ¡è®°å½•
              </text>
              <text class="time-investment" wx:if="{{goal.totalTimeInvestment > 0}}">
                â±ï¸ å·²æŠ•å…¥ {{goal.timeInvestmentDisplay}}
              </text>
            </view>
          </view>
        </view>
        
        <!-- é‡Œç¨‹ç¢‘åˆ—è¡¨ -->
        <view class="milestones-section" wx:if="{{goal.milestones.length > 0}}">
          <view class="milestones-header" bindtap="toggleMilestones" data-id="{{goal.id}}">
            <text class="milestones-title">é‡Œç¨‹ç¢‘ ({{goal.completedMilestones}}/{{goal.milestones.length}})</text>
            <text class="toggle-icon">{{goal.showMilestones ? 'â–¼' : 'â–¶'}}</text>
          </view>
          <view class="milestones-list" wx:if="{{goal.showMilestones}}">
            <view 
              class="milestone-item {{milestone.completed ? 'completed' : ''}}"
              wx:for="{{goal.milestones}}"
              wx:key="id"
              wx:for-item="milestone"
            >
              <view class="milestone-header">
                <view class="milestone-title">{{milestone.title}}</view>
                <view class="milestone-status" bindtap="toggleMilestone" data-goal-id="{{goal.id}}" data-milestone-id="{{milestone.id}}">
                  <text class="status-icon">{{milestone.completed ? 'âœ…' : 'â­•'}}</text>
                </view>
              </view>
              <view class="milestone-date" wx:if="{{milestone.targetDate}}">
                ç›®æ ‡: {{milestone.targetDateText}}
              </view>
            </view>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="goal-actions-row">
          <button class="btn-action" bindtap="addMilestone" data-id="{{goal.id}}">
            <text>ğŸ“ æ·»åŠ é‡Œç¨‹ç¢‘</text>
          </button>
          <button class="btn-action" bindtap="updateProgress" data-id="{{goal.id}}">
            <text>ğŸ“Š æ›´æ–°è¿›åº¦</text>
          </button>
          <button class="btn-action" bindtap="viewGoalDetail" data-id="{{goal.id}}">
            <text>ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…</text>
          </button>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredGoals.length === 0}}">
        <text class="empty-icon">ğŸ¯</text>
        <text class="empty-text">{{searchKeyword ? 'æš‚æ— ç¬¦åˆæ¡ä»¶çš„ç›®æ ‡' : 'è¿˜æ²¡æœ‰è®¾å®šç›®æ ‡'}}</text>
        <button class="empty-action" bindtap="addGoal">è®¾å®šç¬¬ä¸€ä¸ªç›®æ ‡</button>
      </view>
    </scroll-view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘ç›®æ ‡å¼¹çª— -->
  <view class="modal {{showAddModal ? 'show' : ''}}" wx:if="{{showAddModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{editingGoal ? 'ç¼–è¾‘ç›®æ ‡' : 'æ–°å»ºç›®æ ‡'}}</text>
        <text class="close-btn" bindtap="closeAddModal">âœ•</text>
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡æ ‡é¢˜ *</label>
        <input 
          class="form-input" 
          placeholder="å¦‚ï¼šå­¦ä¼šå¼¹å‰ä»–ã€å‡é‡10å…¬æ–¤..." 
          value="{{formData.title}}"
          bindinput="onTitleInput"
          maxlength="50"
        />
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡æè¿°</label>
        <textarea 
          class="form-textarea" 
          placeholder="è¯¦ç»†æè¿°è¿™ä¸ªç›®æ ‡çš„å…·ä½“å†…å®¹å’Œæ„ä¹‰..." 
          value="{{formData.description}}"
          bindinput="onDescriptionInput"
          maxlength="200"
        ></textarea>
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡ç±»å‹ *</label>
        <picker bindchange="onTypeChange" value="{{typeIndex}}" range="{{typeOptions}}" range-key="label">
          <view class="picker-input">
            <text>{{typeOptions[typeIndex].label}}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡åˆ†ç±»</label>
        <picker bindchange="onCategoryChange" value="{{categoryIndex}}" range="{{categoryOptions}}">
          <view class="picker-input">
            <text>{{formData.category}}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-group">
        <label class="form-label">ä¼˜å…ˆçº§</label>
        <picker bindchange="onPriorityChange" value="{{priorityIndex}}" range="{{priorityOptions}}" range-key="label">
          <view class="picker-input">
            <text>{{priorityOptions[priorityIndex].label}}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡æˆªæ­¢æ—¥æœŸ</label>
        <picker mode="date" value="{{targetDate}}" bindchange="onTargetDateChange">
          <view class="picker-input">
            <text>{{targetDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-group">
        <label class="form-label">æ ‡ç­¾ (ç”¨ç©ºæ ¼åˆ†éš”)</label>
        <input 
          class="form-input" 
          placeholder="å¦‚: å¥åº· æŠ€èƒ½ å­¦ä¹ " 
          value="{{tagsInput}}"
          bindinput="onTagsInput"
        />
      </view>
      
      <view class="form-actions">
        <button class="btn-cancel" bindtap="closeAddModal">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmAddGoal" disabled="{{!formData.title}}">
          {{editingGoal ? 'ä¿å­˜' : 'åˆ›å»º'}}
        </button>
      </view>
    </view>
  </view>

  <!-- é‡Œç¨‹ç¢‘å¼¹çª— -->
  <view class="modal {{showMilestoneModal ? 'show' : ''}}" wx:if="{{showMilestoneModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ é‡Œç¨‹ç¢‘</text>
        <text class="close-btn" bindtap="closeMilestoneModal">âœ•</text>
      </view>
      
      <view class="form-group">
        <label class="form-label">é‡Œç¨‹ç¢‘æ ‡é¢˜ *</label>
        <input 
          class="form-input" 
          placeholder="å¦‚ï¼šå®Œæˆç¬¬ä¸€ç« ç»ƒä¹ ..." 
          value="{{milestoneData.title}}"
          bindinput="onMilestoneTitleInput"
          maxlength="30"
        />
      </view>
      
      <view class="form-group">
        <label class="form-label">é‡Œç¨‹ç¢‘æè¿°</label>
        <textarea 
          class="form-textarea" 
          placeholder="è¯¦ç»†æè¿°è¿™ä¸ªé‡Œç¨‹ç¢‘..." 
          value="{{milestoneData.description}}"
          bindinput="onMilestoneDescriptionInput"
          maxlength="100"
        ></textarea>
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡å®Œæˆæ—¥æœŸ</label>
        <picker mode="date" value="{{milestoneTargetDate}}" bindchange="onMilestoneTargetDateChange">
          <view class="picker-input">
            <text>{{milestoneTargetDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-actions">
        <button class="btn-cancel" bindtap="closeMilestoneModal">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmAddMilestone" disabled="{{!milestoneData.title}}">
          æ·»åŠ 
        </button>
      </view>
    </view>
  </view>

  <!-- è¿›åº¦æ›´æ–°å¼¹çª— -->
  <view class="modal {{showProgressModal ? 'show' : ''}}" wx:if="{{showProgressModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ›´æ–°è¿›åº¦</text>
        <text class="close-btn" bindtap="closeProgressModal">âœ•</text>
      </view>
      
      <view class="form-group">
        <label class="form-label">å½“å‰è¿›åº¦ï¼š{{progressValue}}%</label>
        <slider 
          value="{{progressValue}}" 
          min="0" 
          max="100" 
          step="5"
          show-value
          bindchange="onProgressChange"
          activeColor="#6366f1"
          backgroundColor="#e5e7eb"
        />
      </view>
      
      <view class="form-actions">
        <button class="btn-cancel" bindtap="closeProgressModal">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmUpdateProgress">
          æ›´æ–°è¿›åº¦
        </button>
      </view>
    </view>
  </view>
</view>