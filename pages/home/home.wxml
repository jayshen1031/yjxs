<wxs module="utils">
function getCategoryClass(category) {
  var categoryMap = {
    'åŠ±å¿—': 'inspire',
    'ç”Ÿæ´»': 'life', 
    'æˆé•¿': 'growth',
    'å“²ç†': 'philosophy',
    'è®°å½•': 'record',
    'æ—¶é—´': 'time',
    'è‡ªä¿¡': 'confidence',
    'å¿ƒç†': 'psychology',
    'å†³ç­–': 'decision',
    'è‡ªå®šä¹‰': 'custom'
  }
  return categoryMap[category] || 'custom'
}

module.exports = {
  getCategoryClass: getCategoryClass
}
</wxs>

<view class="container">
  <!-- â­ æ¯æ—¥ç®´è¨€åŠ›é‡åº“ - åˆ†åˆ«æ˜¾ç¤ºç³»ç»Ÿç®´è¨€å’Œæˆ‘çš„ç®´è¨€ -->
  <view class="quote-section fade-in">
    <!-- ç³»ç»Ÿç®´è¨€ -->
    <view class="quote-card-wrapper">
      <view class="quote-header">
        <view class="quote-title">
          <text class="icon">â­</text>
          <text>ç³»ç»Ÿç®´è¨€</text>
        </view>
        <view class="quote-actions">
          <view class="action-btn" bindtap="refreshSystemQuote">
            <text class="icon">ğŸ²</text>
          </view>
          <view class="action-btn" bindtap="goToQuoteManager">
            <text class="icon">âš™ï¸</text>
          </view>
        </view>
      </view>

      <view class="quote-card theme-purple" wx:if="{{systemQuote}}">
        <view class="quote-content">{{ systemQuote.content }}</view>
        <view class="quote-meta">
          <view class="category-tag category-{{ utils.getCategoryClass(systemQuote.category) }}">{{ systemQuote.category }}</view>
          <view class="source-info">{{ systemQuote.source || 'ç³»ç»Ÿé»˜è®¤' }}</view>
        </view>
      </view>

      <view class="quote-card theme-purple" wx:else>
        <view class="quote-content empty-quote">æš‚æ— ç³»ç»Ÿç®´è¨€</view>
      </view>
    </view>

    <!-- æˆ‘çš„ç®´è¨€ -->
    <view class="quote-card-wrapper">
      <view class="quote-header">
        <view class="quote-title">
          <text class="icon">âœï¸</text>
          <text>æˆ‘çš„ç®´è¨€</text>
        </view>
        <view class="quote-actions">
          <view class="action-btn" bindtap="refreshMyQuote">
            <text class="icon">ğŸ²</text>
          </view>
          <view class="action-btn" bindtap="goToQuoteManager">
            <text class="icon">â•</text>
          </view>
        </view>
      </view>

      <view class="quote-card theme-orange" wx:if="{{myQuote}}">
        <view class="quote-content">{{ myQuote.content }}</view>
        <view class="quote-meta">
          <view class="category-tag category-{{ utils.getCategoryClass(myQuote.category) }}">{{ myQuote.category }}</view>
          <view class="source-info">{{ myQuote.source || 'æˆ‘çš„åˆ›ä½œ' }}</view>
        </view>
      </view>

      <view class="quote-card theme-orange" wx:else>
        <view class="quote-content empty-quote">ç‚¹å‡»â•æ·»åŠ ä½ çš„ç¬¬ä¸€æ¡ç®´è¨€</view>
      </view>
    </view>
  </view>

  <!-- â­ ä»Šæ—¥æœ‰ä»·å€¼æŠ•å…¥ - æ”¹ä¸ºåˆ—è¡¨å±•ç¤º -->
  <view class="card value-activities-card">
    <view class="card-content">
      <view class="title-row">
        <view class="title">
          <text class="title-icon">ğŸŒŸ</text>
          <text>ä»Šæ—¥æœ‰ä»·å€¼æŠ•å…¥</text>
        </view>
        <view class="value-total">
          <text class="total-minutes">{{ todayValueMinutes }}</text>
          <text class="total-unit">åˆ†é’Ÿ</text>
        </view>
      </view>

      <!-- æ´»åŠ¨åˆ—è¡¨ -->
      <view class="value-activities-list" wx:if="{{todayValueActivities.length > 0}}">
        <view
          class="value-activity-item"
          wx:for="{{ todayValueActivities }}"
          wx:key="id"
        >
          <view class="activity-time">{{ item.startTime || 'æœªè®°å½•' }}</view>
          <view class="activity-content">
            <view class="activity-name">{{ item.name }}</view>
            <view class="activity-meta">
              <view class="activity-duration">{{ item.duration }}åˆ†é’Ÿ</view>
              <view class="activity-type" wx:if="{{ item.activityType }}">{{ item.activityType }}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:else>
        <view class="empty-icon">ğŸ“</view>
        <view class="empty-text">ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•æœ‰ä»·å€¼çš„æ´»åŠ¨</view>
        <view class="empty-hint">å»"è®°å½•æ—¶é—´æŠ•å…¥"é¡µé¢æ·»åŠ å§ï½</view>
      </view>
    </view>
  </view>

  <!-- HUMAN 3.0 è¯„ä¼°å…¥å£ -->
  <view class="card human30-card" bindtap="goToAssessment">
    <view class="human30-header">
      <view class="human30-icon">ğŸ§­</view>
      <view class="human30-title">HUMAN 3.0 å‘å±•è¯„ä¼°</view>
    </view>
    <view class="human30-desc">
      äº†è§£ä½ åœ¨å¿ƒæ™ºã€èº«ä½“ã€ç²¾ç¥ã€äº‹ä¸šå››ä¸ªç»´åº¦çš„å‘å±•æ°´å¹³
    </view>
    <view class="human30-actions">
      <view class="human30-btn human30-btn-primary">å¼€å§‹è¯„ä¼°</view>
      <view class="human30-btn human30-btn-secondary" catchtap="viewAssessmentHistory">æŸ¥çœ‹å†å²</view>
    </view>
    <view class="human30-status" wx:if="{{lastAssessment}}">
      <text class="status-text">ä¸Šæ¬¡è¯„ä¼°ï¼š{{lastAssessment.timeAgo}}</text>
      <text class="status-type">{{lastAssessment.metatype}}</text>
    </view>
  </view>

  <!-- ä»Šæ—¥å¼€å¿ƒæ¨è -->
  <view class="card happy-things-card">
    <view class="card-content">
      <view class="title-row">
        <view class="title">ğŸ˜Š ä»Šæ—¥å¼€å¿ƒæ¨è</view>
        <view class="action-links">
          <view class="action-link" bindtap="refreshHappyThings">ğŸ”„ æ¢ä¸€æ‰¹</view>
          <view class="action-link" bindtap="goToHappyManager">âš™ï¸ ç®¡ç†</view>
        </view>
      </view>

      <view class="happy-things-list">
        <view
          class="happy-item"
          wx:for="{{ todayHappyThings }}"
          wx:key="id"
        >
          <view class="happy-emoji">{{ item.emoji }}</view>
          <view class="happy-info">
            <view class="happy-content">{{ item.content }}</view>
            <view class="happy-meta">
              <view class="happy-category">{{ item.category }}</view>
              <view class="happy-energy energy-{{ item.energy }}">
                {{ item.energy === 'low' ? 'è½»æ¾' : item.energy === 'medium' ? 'é€‚ä¸­' : 'éœ€ç²¾åŠ›' }}
              </view>
            </view>
          </view>
        </view>
      </view>

      <view class="happy-tip">
        ğŸ’¡ é€‰ä¸€ä»¶å¼€å¿ƒçš„äº‹ï¼Œè®©ä»Šå¤©æ›´ç¾å¥½
      </view>
    </view>
  </view>

  <!-- æ¯æ—¥çŠ¶æ€æ‘˜è¦ -->
  <view class="card daily-status-card">
    <view class="card-content">
      <view class="title-row">
        <view class="title">ğŸ“Š æ¯æ—¥çŠ¶æ€</view>
        <view class="action-link" bindtap="goToDailyStatus">
          {{ todayStatus ? 'æŸ¥çœ‹è¯¦æƒ…' : 'è®°å½•çŠ¶æ€' }}
        </view>
      </view>

      <view wx:if="{{ todayStatus }}" class="status-summary">
        <view class="status-row">
          <view class="status-item">
            <view class="status-icon">ğŸ˜Š</view>
            <view class="status-info">
              <view class="status-label">å¿ƒæƒ…</view>
              <view class="status-value">{{ todayStatus.mood || 'æœªè®°å½•' }}</view>
            </view>
          </view>
          <view class="status-item">
            <view class="status-icon">ğŸ˜´</view>
            <view class="status-info">
              <view class="status-label">æ˜¨æ™šç¡çœ </view>
              <view class="status-value" wx:if="{{ todayStatus.bedTime && todayStatus.wakeUpTime }}">
                {{ todayStatus.bedTime }} - {{ todayStatus.wakeUpTime }}
                <text wx:if="{{ todayStatus.sleepHours }}" style="font-size: 24rpx; color: #9ca3af;"> ({{ todayStatus.sleepHours }}h)</text>
              </view>
              <view class="status-value" wx:elif="{{ todayStatus.sleepHours }}">{{ todayStatus.sleepHours }}h</view>
              <view class="status-value" wx:else>æœªè®°å½•</view>
            </view>
          </view>
          <view class="status-item">
            <view class="status-icon">âš–ï¸</view>
            <view class="status-info">
              <view class="status-label">ä½“é‡</view>
              <view class="status-value">{{ todayStatus.weight ? todayStatus.weight + 'kg' : 'æœªè®°å½•' }}</view>
            </view>
          </view>
        </view>

        <view wx:if="{{ todayStatus.highlights }}" class="status-highlights">
          <view class="highlights-label">âœ¨ ä»Šæ—¥äº®ç‚¹</view>
          <view class="highlights-text">{{ todayStatus.highlights }}</view>
        </view>
      </view>

      <view wx:else class="empty-status">
        <view class="empty-icon">ğŸ“Š</view>
        <view class="empty-text">è¿˜æœªè®°å½•ä»Šæ—¥çŠ¶æ€</view>
        <button class="btn btn-primary-small" bindtap="goToDailyStatus">
          <text>ğŸ“ å¼€å§‹è®°å½•</text>
        </button>
      </view>
    </view>
  </view>

  <!-- ç›®æ ‡è¿›å±• -->
  <view class="card" wx:if="{{ goalStats.total > 0 }}">
    <view class="card-content">
      <view class="title-row">
        <view class="title">ğŸ¯ ç›®æ ‡è¿›å±•</view>
        <view class="action-link" bindtap="goToGoalsTodos">æŸ¥çœ‹å…¨éƒ¨</view>
      </view>

      <!-- ç›®æ ‡ç»Ÿè®¡ -->
      <view class="goal-stats">
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.total }}</view>
          <view class="stat-desc">æ€»ç›®æ ‡</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.active }}</view>
          <view class="stat-desc">è¿›è¡Œä¸­</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.completed }}</view>
          <view class="stat-desc">å·²å®Œæˆ</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.averageProgress }}%</view>
          <view class="stat-desc">å¹³å‡è¿›åº¦</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="card">
    <view class="card-content">
      <view class="title">å¿«é€Ÿè®°å½•</view>
      <view class="grid grid-2">
        <view class="grid-item">
          <button class="btn btn-primary" bindtap="goToTextMemo">
            <text>ğŸ“ ä»·å€¼è®°å½•</text>
          </button>
        </view>
        <view class="grid-item">
          <button class="btn btn-planning" bindtap="goToGoalsTodos">
            <text>âœ… å¾…åŠç®¡ç†</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥å¾…åŠé‡ç‚¹ï¼ˆæ˜¨æ—¥è§„åˆ’ï¼‰ -->
  <view wx:if="{{ todayPlanning }}" class="card planning-highlight">
    <view class="card-content">
      <view class="planning-header">
        <view class="title">ğŸ“‹ ä»Šæ—¥å¾…åŠé‡ç‚¹</view>
        <view class="planning-date">{{ planningDate }}</view>
      </view>
      <view class="planning-content">
        <text class="planning-text">{{ todayPlanning.title }}</text>
        <text wx:if="{{ todayPlanning.description }}" class="planning-desc">{{ todayPlanning.description }}</text>
      </view>
      <view class="planning-meta">
        <view class="time-tag">ğŸ“… {{ todayPlanning.dueDateDisplay }}</view>
        <view class="priority-tag priority-{{ todayPlanning.priorityClass }}">{{ todayPlanning.priorityText }}</view>
      </view>
    </view>
  </view>

  <!-- è¿›è¡Œä¸­å¾…åŠ -->
  <view wx:if="{{ inProgressTodos.length > 0 }}" class="card">
    <view class="card-content">
      <view class="title-row">
        <view class="title">â–¶ï¸ è¿›è¡Œä¸­å¾…åŠ</view>
        <view class="action-link" bindtap="goToGoalsTodos">ç®¡ç†å¾…åŠ</view>
      </view>

      <view class="in-progress-todos">
        <view
          class="todo-item-home"
          wx:for="{{ inProgressTodos }}"
          wx:key="id"
          wx:for-item="todo"
          bindtap="goToMemoWithTodo"
          data-todo-id="{{ todo.id }}"
        >
          <view class="todo-header-home">
            <view class="todo-title-home">{{ todo.title }}</view>
            <view class="todo-type-badge">{{ todo.todoType }}</view>
          </view>
          <view class="todo-progress-info">
            <text class="progress-text">å·²æŠ•å…¥ {{ todo.actualMinutes || 0 }}åˆ†é’Ÿ</text>
            <text wx:if="{{ todo.estimatedMinutes > 0 }}" class="progress-text">/ é¢„è®¡ {{ todo.estimatedMinutes }}åˆ†é’Ÿ</text>
            <text wx:if="{{ todo.estimatedMinutes > 0 }}" class="progress-percentage">{{ todo.progressPercentage }}%</text>
          </view>
          <view wx:if="{{ todo.estimatedMinutes > 0 }}" class="progress-bar-home">
            <view class="progress-fill-home" style="width: {{ todo.progressPercentage }}%; background: {{ todo.progressPercentage >= 100 ? '#ef4444' : '#f59e0b' }}"></view>
          </view>
        </view>
      </view>

      <view wx:if="{{ inProgressTodos.length === 0 }}" class="empty-tip">
        <text>æš‚æ— è¿›è¡Œä¸­çš„å¾…åŠäº‹é¡¹</text>
      </view>
    </view>
  </view>

</view>