<wxs module="utils">
function getCategoryClass(category) {
  var categoryMap = {
    'åŠ±å¿—': 'inspire',
    'ç”Ÿæ´»': 'life', 
    'æˆé•¿': 'growth',
    'å“²ç†': 'philosophy',
    'è®°å½•': 'record',
    'æ—¶é—´': 'time',
    'è‡ªä¿¡': 'confidence',
    'å¿ƒç†': 'psychology',
    'å†³ç­–': 'decision',
    'è‡ªå®šä¹‰': 'custom'
  }
  return categoryMap[category] || 'custom'
}

module.exports = {
  getCategoryClass: getCategoryClass
}
</wxs>

<view class="container">
  <!-- æ¯æ—¥ç®´è¨€åŠ›é‡åº“ -->
  <view class="quote-section fade-in">
    <view class="quote-header">
      <view class="quote-title">
        <text class="icon">ğŸ’«</text>
        <text>ä»Šæ—¥ç®´è¨€</text>
      </view>
      <view class="quote-actions">
        <view class="action-btn" bindtap="refreshQuote">
          <text class="icon">ğŸ²</text>
        </view>
        <view class="action-btn" bindtap="toggleQuoteFavorite">
          <text class="icon heart {{currentQuoteData.isFavorite ? 'favorite' : ''}}">â¤ï¸</text>
        </view>
        <view class="action-btn" bindtap="goToQuoteManager">
          <text class="icon">âš™ï¸</text>
        </view>
      </view>
    </view>
    
    <view class="quote-card">
      <view class="quote-content">{{ currentQuoteData.content || currentQuote }}</view>
      <view class="quote-meta" wx:if="{{ currentQuoteData.category }}">
        <view class="category-tag category-{{ utils.getCategoryClass(currentQuoteData.category) }}">{{ currentQuoteData.category }}</view>
        <view class="usage-count">å·²æ¿€åŠ± {{ currentQuoteData.usageCount || 0 }} æ¬¡</view>
        <view class="source-info">{{ currentQuoteData.source }}</view>
      </view>
    </view>
    
    <!-- å¿ƒæƒ…é€‰æ‹©å™¨ -->
    <view class="mood-selector">
      <view class="mood-title">
        <text class="icon">ğŸ’­</text>
        <text>ä»Šæ—¥å¿ƒæƒ…</text>
      </view>
      <view class="mood-options">
        <view 
          class="mood-chip {{selectedMood === moodItem.mood ? 'active' : ''}}" 
          wx:for="{{ moodOptions }}" 
          wx:key="mood"
          wx:for-item="moodItem"
          bindtap="selectMood"
          data-mood="{{ moodItem.mood }}"
        >
          <text class="mood-emoji">{{ moodItem.emoji }}</text>
          <text class="mood-text">{{ moodItem.mood }}</text>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿç®´è¨€åˆ†ç±» -->
    <scroll-view class="quick-categories" scroll-x="true" wx:if="{{ quoteCategories.length > 0 }}">
      <view 
        class="category-chip {{selectedQuoteCategory === category ? 'active' : ''}}" 
        wx:for="{{ quoteCategories }}" 
        wx:key="*this"
        wx:for-item="category"
        bindtap="quickFilterByCategory"
        data-category="{{ category }}"
      >
        {{ category }}
      </view>
    </scroll-view>
  </view>

  <!-- å¿«é€Ÿç»Ÿè®¡ -->
  <view class="grid grid-2 mb-20">
    <view class="grid-item">
      <view class="stat-card">
        <view class="stat-number">{{ continuousDays }}</view>
        <view class="stat-label">è¿ç»­è®°å½•</view>
      </view>
    </view>
    <view class="grid-item">
      <view class="stat-card">
        <view class="stat-number">{{ todayValueScore }}%</view>
        <view class="stat-label">ä»Šæ—¥ä»·å€¼åº¦</view>
      </view>
    </view>
  </view>

  <!-- ç›®æ ‡è¿›å±• -->
  <view class="card" wx:if="{{ goalStats.total > 0 }}">
    <view class="card-content">
      <view class="title-row">
        <view class="title">ğŸ¯ ç›®æ ‡è¿›å±•</view>
        <view class="action-link" bindtap="goToGoalManager">ç®¡ç†ç›®æ ‡</view>
      </view>
      
      <!-- ç›®æ ‡ç»Ÿè®¡ -->
      <view class="goal-stats">
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.total }}</view>
          <view class="stat-desc">æ€»ç›®æ ‡</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.active }}</view>
          <view class="stat-desc">è¿›è¡Œä¸­</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.completed }}</view>
          <view class="stat-desc">å·²å®Œæˆ</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.averageProgress }}%</view>
          <view class="stat-desc">å¹³å‡è¿›åº¦</view>
        </view>
      </view>
      
      <!-- ä»Šæ—¥ç›®æ ‡ -->
      <view wx:if="{{ todayGoals.length > 0 }}" class="today-goals">
        <view class="goals-header">
          <text class="goals-title">ğŸ“… ä»Šæ—¥ç›®æ ‡</text>
          <text class="goals-count">{{ todayGoals.length }}ä¸ª</text>
        </view>
        <view class="goals-list">
          <view 
            class="goal-item-mini" 
            wx:for="{{ todayGoals }}" 
            wx:key="id"
            wx:for-item="goal"
          >
            <view class="goal-info">
              <view class="goal-title-mini">{{ goal.title }}</view>
              <view class="goal-meta-mini">
                <view class="type-indicator type-{{ goal.type }}"></view>
                <text class="goal-category">{{ goal.category }}</text>
                <text class="goal-progress">{{ goal.progress }}%</text>
              </view>
            </view>
            <view class="goal-progress-bar">
              <view class="progress-fill" style="width: {{ goal.progress }}%"></view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å¿«é€Ÿç›®æ ‡æ“ä½œ -->
      <view class="quick-goal-actions">
        <view wx:if="{{ goalStats.total === 0 }}" class="no-goals-tip">
          <button class="btn btn-goal" bindtap="goToGoalManager">
            <text>ğŸ¯ è®¾å®šç¬¬ä¸€ä¸ªç›®æ ‡</text>
          </button>
        </view>
        <view wx:else class="goal-quick-actions">
          <button class="btn btn-goal-add" bindtap="quickAddGoal">
            <text>â• å¿«é€Ÿæ·»åŠ ç›®æ ‡</text>
          </button>
          <button class="btn btn-goal-manage" bindtap="goToGoalManager">
            <text>âš™ï¸ ç®¡ç†ç›®æ ‡</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="card">
    <view class="card-content">
      <view class="title">å¿«é€Ÿè®°å½•</view>
      <view class="grid grid-2">
        <view class="grid-item">
          <button class="btn btn-primary" bindtap="goToTextMemo">
            <text>ğŸ“ ä»·å€¼è®°å½•</text>
          </button>
        </view>
        <view class="grid-item">
          <button class="btn btn-planning" bindtap="goToPlanningMemo">
            <text>ğŸ“‹ æ˜æ—¥è§„åˆ’</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ˜æ—¥è§„åˆ’é‡ç‚¹ -->
  <view wx:if="{{ todayPlanning }}" class="card planning-highlight">
    <view class="card-content">
      <view class="planning-header">
        <view class="title">ğŸ“‹ æ˜æ—¥è§„åˆ’é‡ç‚¹</view>
        <view class="planning-date">{{ planningDate }}</view>
      </view>
      <view class="planning-content">
        <text class="planning-text">{{ todayPlanning.content }}</text>
      </view>
      <view class="planning-meta">
        <view class="time-tag">â° è§„åˆ’æ—¶é—´ï¼š{{ todayPlanning.formattedTime }}</view>
        <view class="tag planning">è§„åˆ’</view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥å¾…åŠ -->
  <view class="card today-todos-section">
    <view class="card-content">
      <view class="section-header">
        <view class="title">âœ… ä»Šæ—¥å¾…åŠ ({{ todayTodosStats.total }})</view>
        <view class="action-link" bindtap="goToTodosPage">
          <text>ç®¡ç†å…¨éƒ¨</text>
          <text class="icon">â†’</text>
        </view>
      </view>

      <view wx:if="{{ todayTodos.length > 0 }}">
        <view class="todo-item" wx:for="{{ todayTodos }}" wx:key="id" bindtap="toggleTodoStatus" data-id="{{ item.id }}">
          <view class="todo-checkbox">
            <text class="icon {{item.status === 'å·²å®Œæˆ' ? 'checked' : ''}}">{{ item.status === 'å·²å®Œæˆ' ? 'âœ“' : 'â—‹' }}</text>
          </view>
          <view class="todo-content">
            <view class="todo-title {{item.status === 'å·²å®Œæˆ' ? 'completed' : ''}}">{{ item.title }}</view>
            <view class="todo-meta">
              <view class="todo-type-tag">{{ item.type }}</view>
              <view class="todo-priority-tag priority-{{item.priorityLevel}}">{{ item.priorityText }}</view>
              <view wx:if="{{ item.estimatedMinutes }}" class="todo-time-tag">â± {{ item.estimatedMinutes }}åˆ†é’Ÿ</view>
            </view>
          </view>
        </view>

        <view class="todos-summary">
          <view class="summary-item">
            <text class="label">å¾…åŠ:</text>
            <text class="value">{{ todayTodosStats.pending }}</text>
          </view>
          <view class="summary-item">
            <text class="label">è¿›è¡Œä¸­:</text>
            <text class="value">{{ todayTodosStats.inProgress }}</text>
          </view>
          <view class="summary-item">
            <text class="label">å·²å®Œæˆ:</text>
            <text class="value">{{ todayTodosStats.completed }}</text>
          </view>
        </view>
      </view>

      <view wx:else class="empty-state">
        <view class="icon">ğŸ“</view>
        <view class="text">ä»Šå¤©è¿˜æ²¡æœ‰å¾…åŠäº‹é¡¹</view>
        <view class="hint">å¯ä»¥åœ¨"æ˜æ—¥è§„åˆ’"ä¸­æ·»åŠ ï¼Œæˆ–åœ¨"ç›®æ ‡Â·å¾…åŠ"é¡µé¢ç®¡ç†</view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="card">
    <view class="card-content">
      <view class="title">æœ€è¿‘è®°å½•</view>
      <view wx:if="{{ recentMemos.length > 0 }}">
        <view class="list-item" wx:for="{{ recentMemos }}" wx:key="id">
          <view class="content">
            <view class="subtitle">{{ item.content }}</view>
            <view class="memo-meta">
              <view class="time-tag">{{ item.formattedTime }}</view>
              <view class="tag period-{{ item.periodColor }}">{{ item.timePeriod }}</view>
              <view class="tag category-{{ item.categoryColor }}">{{ item.category }}</view>
              <view class="tag {{ item.isPlanning ? 'planning' : item.type }}">
                {{ item.isPlanning ? 'è§„åˆ’' : (item.type === 'voice' ? 'è¯­éŸ³' : 'æ–‡å­—') }}
              </view>
            </view>
            <!-- ç”¨æˆ·è‡ªå®šä¹‰æ ‡ç­¾ -->
            <view class="memo-tags" wx:if="{{ item.tags && item.tags.length > 0 }}">
              <text class="tag user-tag" wx:for="{{ item.tags }}" wx:key="index" wx:for-item="tag">{{ tag }}</text>
            </view>
          </view>
        </view>
        <view class="text-center mt-20">
          <button class="btn btn-secondary" bindtap="viewAllMemos">æŸ¥çœ‹å…¨éƒ¨</button>
        </view>
      </view>
      <view wx:else class="empty-state">
        <view class="icon">ğŸ“</view>
        <view class="text">æš‚æ— è®°å½•ï¼Œå¼€å§‹è®°å½•ç¾å¥½ç”Ÿæ´»å§ï¼</view>
      </view>
    </view>
  </view>

  <!-- æé†’è®¾ç½® -->
  <view class="card">
    <view class="card-content">
      <view class="title">â° å‡†ç‚¹æé†’</view>
      <view class="flex flex-between">
        <text>æ¯å°æ—¶å‡†ç‚¹æé†’</text>
        <switch checked="{{ reminderEnabled }}" bindchange="toggleReminder" color="#6366f1"/>
      </view>
      <view wx:if="{{ reminderEnabled }}" class="reminder-info">
        <view class="reminder-time-range">
          <text class="time-badge">7:00</text>
          <text class="time-separator">-</text>
          <text class="time-badge">22:00</text>
        </view>
        <text class="reminder-desc">ç”Ÿæ´»æ—¶é—´æ®µå†…æ¯å°æ—¶æ•´ç‚¹æé†’è®°å½•</text>
        <text class="reminder-note">ğŸ’¡ è¿‡å»1å°æ—¶çš„æ´»åŠ¨å›é¡¾å’Œè®°å½•</text>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ·»åŠ ç›®æ ‡å¼¹çª— -->
  <view class="modal {{ showQuickGoalModal ? 'show' : '' }}" wx:if="{{ showQuickGoalModal }}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">å¿«é€Ÿæ·»åŠ ç›®æ ‡</text>
        <text class="close-btn" bindtap="closeQuickGoalModal">âœ•</text>
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡æ ‡é¢˜ *</label>
        <input 
          class="form-input" 
          placeholder="å¦‚ï¼šæ¯å¤©è·‘æ­¥30åˆ†é’Ÿã€å­¦ä¼šå¼¹å‰ä»–..." 
          value="{{ quickGoalForm.title }}"
          bindinput="onQuickGoalTitleInput"
          maxlength="50"
        />
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡ç±»å‹</label>
        <picker bindchange="onQuickGoalTypeChange" value="{{ quickGoalTypeIndex }}" range="{{ quickGoalTypes }}" range-key="label">
          <view class="picker-input">
            <text>{{ quickGoalTypes[quickGoalTypeIndex].label }}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-group">
        <label class="form-label">ç›®æ ‡åˆ†ç±»</label>
        <picker bindchange="onQuickGoalCategoryChange" value="{{ quickGoalCategoryIndex }}" range="{{ quickGoalCategories }}">
          <view class="picker-input">
            <text>{{ quickGoalCategories[quickGoalCategoryIndex] }}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-actions">
        <button class="btn-cancel" bindtap="closeQuickGoalModal">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmQuickAddGoal" disabled="{{ !quickGoalForm.title }}">
          åˆ›å»ºç›®æ ‡
        </button>
      </view>
    </view>
  </view>
</view>