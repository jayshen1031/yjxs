<wxs module="utils">
function getCategoryClass(category) {
  var categoryMap = {
    '励志': 'inspire',
    '生活': 'life', 
    '成长': 'growth',
    '哲理': 'philosophy',
    '记录': 'record',
    '时间': 'time',
    '自信': 'confidence',
    '心理': 'psychology',
    '决策': 'decision',
    '自定义': 'custom'
  }
  return categoryMap[category] || 'custom'
}

module.exports = {
  getCategoryClass: getCategoryClass
}
</wxs>

<view class="container">
  <!-- 每日箴言力量库 -->
  <view class="quote-section fade-in">
    <view class="quote-header">
      <view class="quote-title">
        <text class="icon">💫</text>
        <text>今日箴言</text>
      </view>
      <view class="quote-actions">
        <view class="action-btn" bindtap="refreshQuote">
          <text class="icon">🎲</text>
        </view>
        <view class="action-btn" bindtap="toggleQuoteFavorite">
          <text class="icon heart {{currentQuoteData.isFavorite ? 'favorite' : ''}}">❤️</text>
        </view>
        <view class="action-btn" bindtap="changeQuoteTheme">
          <text class="icon">🎨</text>
        </view>
        <view class="action-btn" bindtap="goToQuoteManager">
          <text class="icon">⚙️</text>
        </view>
      </view>
    </view>
    
    <view class="quote-card {{quoteTheme ? 'theme-' + quoteTheme : 'theme-purple'}}">
      <view class="quote-content">{{ currentQuoteData.content || currentQuote }}</view>
      <view class="quote-meta" wx:if="{{ currentQuoteData.category }}">
        <view class="category-tag category-{{ utils.getCategoryClass(currentQuoteData.category) }}">{{ currentQuoteData.category }}</view>
        <view class="usage-count">已激励 {{ currentQuoteData.usageCount || 0 }} 次</view>
        <view class="source-info">{{ currentQuoteData.source }}</view>
      </view>
    </view>

  </view>

  <!-- 今日价值统计 -->
  <view class="stat-card-single">
    <view class="stat-number">{{ todayValueMinutes }}</view>
    <view class="stat-label">今日价值分钟</view>
  </view>

  <!-- 今日开心推荐 -->
  <view class="card happy-things-card">
    <view class="card-content">
      <view class="title-row">
        <view class="title">😊 今日开心推荐</view>
        <view class="action-links">
          <view class="action-link" bindtap="refreshHappyThings">🔄 换一批</view>
          <view class="action-link" bindtap="goToHappyManager">⚙️ 管理</view>
        </view>
      </view>

      <view class="happy-things-list">
        <view
          class="happy-item"
          wx:for="{{ todayHappyThings }}"
          wx:key="id"
        >
          <view class="happy-emoji">{{ item.emoji }}</view>
          <view class="happy-info">
            <view class="happy-content">{{ item.content }}</view>
            <view class="happy-meta">
              <view class="happy-category">{{ item.category }}</view>
              <view class="happy-energy energy-{{ item.energy }}">
                {{ item.energy === 'low' ? '轻松' : item.energy === 'medium' ? '适中' : '需精力' }}
              </view>
            </view>
          </view>
        </view>
      </view>

      <view class="happy-tip">
        💡 选一件开心的事，让今天更美好
      </view>
    </view>
  </view>

  <!-- 每日状态摘要 -->
  <view class="card daily-status-card">
    <view class="card-content">
      <view class="title-row">
        <view class="title">📊 每日状态</view>
        <view class="action-link" bindtap="goToDailyStatus">
          {{ todayStatus ? '查看详情' : '记录状态' }}
        </view>
      </view>

      <view wx:if="{{ todayStatus }}" class="status-summary">
        <view class="status-row">
          <view class="status-item">
            <view class="status-icon">😊</view>
            <view class="status-info">
              <view class="status-label">心情</view>
              <view class="status-value">{{ todayStatus.mood || '未记录' }}</view>
            </view>
          </view>
          <view class="status-item">
            <view class="status-icon">😴</view>
            <view class="status-info">
              <view class="status-label">昨晚睡眠</view>
              <view class="status-value" wx:if="{{ todayStatus.bedTime && todayStatus.wakeUpTime }}">
                {{ todayStatus.bedTime }} - {{ todayStatus.wakeUpTime }}
                <text wx:if="{{ todayStatus.sleepHours }}" style="font-size: 24rpx; color: #9ca3af;"> ({{ todayStatus.sleepHours }}h)</text>
              </view>
              <view class="status-value" wx:elif="{{ todayStatus.sleepHours }}">{{ todayStatus.sleepHours }}h</view>
              <view class="status-value" wx:else>未记录</view>
            </view>
          </view>
          <view class="status-item">
            <view class="status-icon">⚖️</view>
            <view class="status-info">
              <view class="status-label">体重</view>
              <view class="status-value">{{ todayStatus.weight ? todayStatus.weight + 'kg' : '未记录' }}</view>
            </view>
          </view>
        </view>

        <view wx:if="{{ todayStatus.highlights }}" class="status-highlights">
          <view class="highlights-label">✨ 今日亮点</view>
          <view class="highlights-text">{{ todayStatus.highlights }}</view>
        </view>
      </view>

      <view wx:else class="empty-status">
        <view class="empty-icon">📊</view>
        <view class="empty-text">还未记录今日状态</view>
        <button class="btn btn-primary-small" bindtap="goToDailyStatus">
          <text>📝 开始记录</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 目标进展 -->
  <view class="card" wx:if="{{ goalStats.total > 0 }}">
    <view class="card-content">
      <view class="title-row">
        <view class="title">🎯 目标进展</view>
        <view class="action-link" bindtap="goToGoalsTodos">查看全部</view>
      </view>

      <!-- 目标统计 -->
      <view class="goal-stats">
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.total }}</view>
          <view class="stat-desc">总目标</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.active }}</view>
          <view class="stat-desc">进行中</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.completed }}</view>
          <view class="stat-desc">已完成</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{ goalStats.averageProgress }}%</view>
          <view class="stat-desc">平均进度</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 快速操作 -->
  <view class="card">
    <view class="card-content">
      <view class="title">快速记录</view>
      <view class="grid grid-2">
        <view class="grid-item">
          <button class="btn btn-primary" bindtap="goToTextMemo">
            <text>📝 价值记录</text>
          </button>
        </view>
        <view class="grid-item">
          <button class="btn btn-planning" bindtap="goToGoalsTodos">
            <text>✅ 待办管理</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- 今日待办重点（昨日规划） -->
  <view wx:if="{{ todayPlanning }}" class="card planning-highlight">
    <view class="card-content">
      <view class="planning-header">
        <view class="title">📋 今日待办重点</view>
        <view class="planning-date">{{ planningDate }}</view>
      </view>
      <view class="planning-content">
        <text class="planning-text">{{ todayPlanning.title }}</text>
        <text wx:if="{{ todayPlanning.description }}" class="planning-desc">{{ todayPlanning.description }}</text>
      </view>
      <view class="planning-meta">
        <view class="time-tag">📅 {{ todayPlanning.dueDateDisplay }}</view>
        <view class="priority-tag priority-{{ todayPlanning.priorityClass }}">{{ todayPlanning.priorityText }}</view>
      </view>
    </view>
  </view>

  <!-- 进行中待办 -->
  <view wx:if="{{ inProgressTodos.length > 0 }}" class="card">
    <view class="card-content">
      <view class="title-row">
        <view class="title">▶️ 进行中待办</view>
        <view class="action-link" bindtap="goToGoalsTodos">管理待办</view>
      </view>

      <view class="in-progress-todos">
        <view
          class="todo-item-home"
          wx:for="{{ inProgressTodos }}"
          wx:key="id"
          wx:for-item="todo"
          bindtap="goToMemoWithTodo"
          data-todo-id="{{ todo.id }}"
        >
          <view class="todo-header-home">
            <view class="todo-title-home">{{ todo.title }}</view>
            <view class="todo-type-badge">{{ todo.todoType }}</view>
          </view>
          <view class="todo-progress-info">
            <text class="progress-text">已投入 {{ todo.actualMinutes || 0 }}分钟</text>
            <text wx:if="{{ todo.estimatedMinutes > 0 }}" class="progress-text">/ 预计 {{ todo.estimatedMinutes }}分钟</text>
            <text wx:if="{{ todo.estimatedMinutes > 0 }}" class="progress-percentage">{{ todo.progressPercentage }}%</text>
          </view>
          <view wx:if="{{ todo.estimatedMinutes > 0 }}" class="progress-bar-home">
            <view class="progress-fill-home" style="width: {{ todo.progressPercentage }}%; background: {{ todo.progressPercentage >= 100 ? '#ef4444' : '#f59e0b' }}"></view>
          </view>
        </view>
      </view>

      <view wx:if="{{ inProgressTodos.length === 0 }}" class="empty-tip">
        <text>暂无进行中的待办事项</text>
      </view>
    </view>
  </view>

</view>