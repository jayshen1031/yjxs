<view class="container">
  <!-- è®°å½•æ¨¡å¼é€‰æ‹© -->
  <view class="mode-selector">
    <view class="selector-item {{ recordMode === 'normal' ? 'active' : '' }}" bindtap="selectNormalMode">
      <text class="icon">ğŸ“</text>
      <text class="label">æ—¥å¸¸è®°å½•</text>
    </view>
    <view class="selector-item {{ recordMode === 'planning' ? 'active' : '' }}" bindtap="selectPlanningMode">
      <text class="icon">ğŸ“‹</text>
      <text class="label">æ˜æ—¥è§„åˆ’</text>
    </view>
  </view>


  <!-- è®°å½•è¾“å…¥åŒºåŸŸ -->
  <view class="input-section fade-in">
    <view class="card">
      <view class="card-content">
        <view class="title">{{ recordMode === 'planning' ? 'æ˜æ—¥è§„åˆ’' : 'è¿‡å»1å°æ—¶çš„ä»·å€¼å›é¡¾' }}</view>
        <view wx:if="{{ recordMode === 'planning' }}" class="planning-tip">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">è§„åˆ’æ˜å¤©çš„é‡è¦äº‹é¡¹ï¼Œè®©æ¯ä¸€å¤©éƒ½æœ‰æ–¹å‘</text>
        </view>
        <view wx:else class="value-tip">
          <text class="tip-icon">ğŸ¯</text>
          <text class="tip-text">åˆ†ç±»è®°å½•è¿‡å»1å°æ—¶çš„æ´»åŠ¨ï¼Œæå‡è‡ªæˆ‘è®¤çŸ¥</text>
        </view>

        <!-- å½•éŸ³çŠ¶æ€æç¤º -->
        <view wx:if="{{ isRecording }}" class="recording-status">
          <view class="recording-info">
            <text class="recording-icon">ğŸ”´</text>
            <text class="recording-text">æ­£åœ¨å½•éŸ³... {{ recordingTime }}s</text>
            <text class="recording-hint">å†æ¬¡ç‚¹å‡»ğŸ¤åœæ­¢å½•éŸ³</text>
          </view>
        </view>

        <!-- ä»·å€¼åˆ†ç±»è¾“å…¥ -->
        <view wx:if="{{ recordMode === 'normal' }}" class="value-categories">
          <!-- æœ‰ä»·å€¼å†…å®¹ -->
          <view class="value-category valuable">
            <view class="category-header">
              <text class="category-icon">ğŸŒŸ</text>
              <text class="category-title">æœ‰ä»·å€¼çš„æ´»åŠ¨</text>
              <button class="voice-input-btn {{ isRecording && currentVoiceType === 'valuable' ? 'recording' : '' }}" bindtap="toggleVoiceInput" data-type="valuable">
                <text class="btn-icon">{{ isRecording && currentVoiceType === 'valuable' ? 'â¹ï¸' : 'ğŸ¤' }}</text>
              </button>
            </view>
            <textarea 
              class="category-textarea valuable"
              placeholder="è¿‡å»1å°æ—¶ä¸­æœ‰æ”¶è·ã€æœ‰æ„ä¹‰çš„æ´»åŠ¨ï¼Œå¦‚å­¦ä¹ ã€å·¥ä½œè¿›å±•ã€å¥åº·æ´»åŠ¨ç­‰..."
              value="{{ valuableContent }}"
              bindinput="onValuableInput"
              maxlength="200"
            />
            <view class="textarea-footer">
              <view class="char-count">{{ valuableContent.length }}/200</view>
              <button wx:if="{{ valuableContent.length > 0 }}" 
                      class="format-btn" 
                      bindtap="applyMarkdownFormatting" 
                      data-type="valuable">
                <text class="format-icon">âœ¨</text>
                <text class="format-text">æ ¼å¼åŒ–</text>
              </button>
            </view>
            
            <!-- æ—¶é—´æŠ•å…¥ç»Ÿè®¡ -->
            <view class="time-investment-section">
              <view class="investment-header">
                <text class="header-icon">â±ï¸</text>
                <text class="header-title">æ—¶é—´æŠ•å…¥ç»Ÿè®¡</text>
                <text class="header-subtitle">(5åˆ†é’Ÿä¸ºæœ€å°å•ä½)</text>
              </view>
              
              <!-- å·²æ·»åŠ çš„æ—¶é—´æŠ•å…¥åˆ—è¡¨ -->
              <view wx:if="{{ valuableTimeEntries.length > 0 }}" class="time-entries-list">
                <view
                  class="time-entry-item"
                  wx:for="{{ valuableTimeEntries }}"
                  wx:key="index"
                >
                  <view class="entry-main">
                    <view class="entry-content">
                      <text class="entry-activity">{{ item.activity }}</text>
                      <text class="entry-minutes">{{ item.minutes }}åˆ†é’Ÿ</text>
                    </view>
                    <button class="entry-delete-btn" bindtap="removeTimeEntry" data-index="{{ index }}" data-type="valuable">
                      <text class="delete-icon">âŒ</text>
                    </button>
                  </view>
                  <view wx:if="{{ item.tags && item.tags.length > 0 }}" class="entry-tags">
                    <text class="tag-item" wx:for="{{ item.tags }}" wx:key="tag" wx:for-item="tag">{{ tag }}</text>
                  </view>
                </view>
                <view class="total-time">
                  <text class="total-label">æ€»è®¡ï¼š</text>
                  <text class="total-minutes">{{ totalValuableMinutes }}åˆ†é’Ÿ</text>
                </view>
              </view>

              <!-- æ·»åŠ æ–°çš„æ—¶é—´æŠ•å…¥ -->
              <view class="add-time-entry">
                <view class="input-row">
                  <input
                    class="activity-input"
                    placeholder="æ´»åŠ¨åç§°ï¼ˆå¦‚ï¼šç¼–ç¨‹ã€å­¦ä¹ ã€è¿åŠ¨ï¼‰"
                    value="{{ currentActivity }}"
                    bindinput="onActivityInput"
                    maxlength="20"
                  />
                  <input
                    class="minutes-input"
                    type="number"
                    placeholder="åˆ†é’Ÿ"
                    value="{{ currentMinutes }}"
                    bindinput="onMinutesInput"
                  />
                </view>

                <!-- æ ‡ç­¾é€‰æ‹© -->
                <view class="tags-selector">
                  <text class="tags-label">ğŸ·ï¸ æ ‡ç­¾ï¼š</text>
                  <view class="tags-list">
                    <view
                      class="tag-option {{ currentActivityTags.indexOf(tag) > -1 ? 'selected' : '' }}"
                      wx:for="{{ availableTags }}"
                      wx:key="tag"
                      wx:for-item="tag"
                      bindtap="toggleActivityTag"
                      data-tag="{{ tag }}"
                      data-type="valuable"
                    >
                      <text>{{ tag }}</text>
                    </view>
                  </view>
                  <!-- è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
                  <view class="custom-tag-input">
                    <input
                      class="custom-tag-field"
                      placeholder="è¾“å…¥è‡ªå®šä¹‰æ ‡ç­¾"
                      value="{{ currentCustomTag }}"
                      bindinput="onCustomTagInput"
                      data-type="valuable"
                      maxlength="10"
                    />
                    <button
                      class="add-custom-tag-btn"
                      bindtap="addCustomTag"
                      data-type="valuable"
                    >
                      <text>+</text>
                    </button>
                  </view>
                </view>

                <button
                  class="add-entry-btn"
                  bindtap="addTimeEntry"
                  data-type="valuable"
                  disabled="{{ !canAddTimeEntry }}"
                >
                  <text>âœ… æ·»åŠ æ´»åŠ¨</text>
                </button>

                <view class="input-hint">
                  <text class="hint-text">ğŸ’¡ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°ï¼ˆå¦‚ï¼š5, 10, 15, 30, 60ï¼‰</text>
                </view>
              </view>
            </view>
          </view>

          <!-- ä¸­æ€§å†…å®¹ -->
          <view class="value-category neutral">
            <view class="category-header">
              <text class="category-icon">ğŸ˜</text>
              <text class="category-title">ä¸­æ€§çš„æ´»åŠ¨</text>
              <button class="voice-input-btn {{ isRecording && currentVoiceType === 'neutral' ? 'recording' : '' }}" bindtap="toggleVoiceInput" data-type="neutral">
                <text class="btn-icon">{{ isRecording && currentVoiceType === 'neutral' ? 'â¹ï¸' : 'ğŸ¤' }}</text>
              </button>
            </view>
            <textarea 
              class="category-textarea neutral"
              placeholder="æ—¥å¸¸å¿…è¦çš„æ´»åŠ¨ï¼Œå¦‚åƒé¥­ã€é€šå‹¤ã€åŸºæœ¬æ²Ÿé€šç­‰..."
              value="{{ neutralContent }}"
              bindinput="onNeutralInput"
              maxlength="200"
            />
            <view class="textarea-footer">
              <view class="char-count">{{ neutralContent.length }}/200</view>
              <button wx:if="{{ neutralContent.length > 0 }}" 
                      class="format-btn" 
                      bindtap="applyMarkdownFormatting" 
                      data-type="neutral">
                <text class="format-icon">âœ¨</text>
                <text class="format-text">æ ¼å¼åŒ–</text>
              </button>
            </view>
            
            <!-- ä¸­æ€§æ´»åŠ¨æ—¶é—´æŠ•å…¥ç»Ÿè®¡ -->
            <view class="time-investment-section">
              <view class="investment-header">
                <text class="header-icon">â±ï¸</text>
                <text class="header-title">æ—¶é—´æŠ•å…¥ç»Ÿè®¡</text>
                <text class="header-subtitle">(5åˆ†é’Ÿä¸ºæœ€å°å•ä½)</text>
              </view>
              
              <!-- å·²æ·»åŠ çš„æ—¶é—´æŠ•å…¥åˆ—è¡¨ -->
              <view wx:if="{{ neutralTimeEntries.length > 0 }}" class="time-entries-list">
                <view
                  class="time-entry-item"
                  wx:for="{{ neutralTimeEntries }}"
                  wx:key="index"
                >
                  <view class="entry-main">
                    <view class="entry-content">
                      <text class="entry-activity">{{ item.activity }}</text>
                      <text class="entry-minutes">{{ item.minutes }}åˆ†é’Ÿ</text>
                    </view>
                    <button class="entry-delete-btn" bindtap="removeTimeEntry" data-index="{{ index }}" data-type="neutral">
                      <text class="delete-icon">âŒ</text>
                    </button>
                  </view>
                  <view wx:if="{{ item.tags && item.tags.length > 0 }}" class="entry-tags">
                    <text class="tag-item" wx:for="{{ item.tags }}" wx:key="tag" wx:for-item="tag">{{ tag }}</text>
                  </view>
                </view>
                <view class="total-time">
                  <text class="total-label">æ€»è®¡ï¼š</text>
                  <text class="total-minutes">{{ totalNeutralMinutes }}åˆ†é’Ÿ</text>
                </view>
              </view>

              <!-- æ·»åŠ æ–°çš„æ—¶é—´æŠ•å…¥ -->
              <view class="add-time-entry">
                <view class="input-row">
                  <input
                    class="activity-input"
                    placeholder="æ´»åŠ¨åç§°ï¼ˆå¦‚ï¼šåƒé¥­ã€é€šå‹¤ã€ä¼‘æ¯ï¼‰"
                    value="{{ currentNeutralActivity }}"
                    bindinput="onNeutralActivityInput"
                    maxlength="20"
                  />
                  <input
                    class="minutes-input"
                    type="number"
                    placeholder="åˆ†é’Ÿ"
                    value="{{ currentNeutralMinutes }}"
                    bindinput="onNeutralMinutesInput"
                  />
                </view>

                <!-- æ ‡ç­¾é€‰æ‹© -->
                <view class="tags-selector">
                  <text class="tags-label">ğŸ·ï¸ æ ‡ç­¾ï¼š</text>
                  <view class="tags-list">
                    <view
                      class="tag-option {{ currentNeutralActivityTags.indexOf(tag) > -1 ? 'selected' : '' }}"
                      wx:for="{{ availableTags }}"
                      wx:key="tag"
                      wx:for-item="tag"
                      bindtap="toggleActivityTag"
                      data-tag="{{ tag }}"
                      data-type="neutral"
                    >
                      <text>{{ tag }}</text>
                    </view>
                  </view>
                  <!-- è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
                  <view class="custom-tag-input">
                    <input
                      class="custom-tag-field"
                      placeholder="è¾“å…¥è‡ªå®šä¹‰æ ‡ç­¾"
                      value="{{ currentCustomTag }}"
                      bindinput="onCustomTagInput"
                      data-type="neutral"
                      maxlength="10"
                    />
                    <button
                      class="add-custom-tag-btn"
                      bindtap="addCustomTag"
                      data-type="neutral"
                    >
                      <text>+</text>
                    </button>
                  </view>
                </view>

                <button
                  class="add-entry-btn"
                  bindtap="addTimeEntry"
                  data-type="neutral"
                  disabled="{{ !canAddNeutralTimeEntry }}"
                >
                  <text>âœ… æ·»åŠ æ´»åŠ¨</text>
                </button>

                <view class="input-hint">
                  <text class="hint-text">ğŸ’¡ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°ï¼ˆå¦‚ï¼š5, 10, 15, 30, 60ï¼‰</text>
                </view>
              </view>
            </view>
          </view>

          <!-- æ— ä»·å€¼å†…å®¹ -->
          <view class="value-category wasteful">
            <view class="category-header">
              <text class="category-icon">ğŸ—‘ï¸</text>
              <text class="category-title">ä½æ•ˆçš„æ´»åŠ¨</text>
              <button class="voice-input-btn {{ isRecording && currentVoiceType === 'wasteful' ? 'recording' : '' }}" bindtap="toggleVoiceInput" data-type="wasteful">
                <text class="btn-icon">{{ isRecording && currentVoiceType === 'wasteful' ? 'â¹ï¸' : 'ğŸ¤' }}</text>
              </button>
            </view>
            <textarea 
              class="category-textarea wasteful"
              placeholder="æµªè´¹æ—¶é—´çš„æ´»åŠ¨ï¼Œå¦‚æ— æ„ä¹‰åˆ·æ‰‹æœºã€å‘å‘†ã€æ‹–å»¶ç­‰..."
              value="{{ wastefulContent }}"
              bindinput="onWastefulInput"
              maxlength="200"
            />
            <view class="textarea-footer">
              <view class="char-count">{{ wastefulContent.length }}/200</view>
              <button wx:if="{{ wastefulContent.length > 0 }}" 
                      class="format-btn" 
                      bindtap="applyMarkdownFormatting" 
                      data-type="wasteful">
                <text class="format-icon">âœ¨</text>
                <text class="format-text">æ ¼å¼åŒ–</text>
              </button>
            </view>
            
            <!-- ä½æ•ˆæ´»åŠ¨æ—¶é—´æŠ•å…¥ç»Ÿè®¡ -->
            <view class="time-investment-section">
              <view class="investment-header">
                <text class="header-icon">â±ï¸</text>
                <text class="header-title">æ—¶é—´æŠ•å…¥ç»Ÿè®¡</text>
                <text class="header-subtitle">(5åˆ†é’Ÿä¸ºæœ€å°å•ä½)</text>
              </view>
              
              <!-- å·²æ·»åŠ çš„æ—¶é—´æŠ•å…¥åˆ—è¡¨ -->
              <view wx:if="{{ wastefulTimeEntries.length > 0 }}" class="time-entries-list">
                <view
                  class="time-entry-item"
                  wx:for="{{ wastefulTimeEntries }}"
                  wx:key="index"
                >
                  <view class="entry-main">
                    <view class="entry-content">
                      <text class="entry-activity">{{ item.activity }}</text>
                      <text class="entry-minutes">{{ item.minutes }}åˆ†é’Ÿ</text>
                    </view>
                    <button class="entry-delete-btn" bindtap="removeTimeEntry" data-index="{{ index }}" data-type="wasteful">
                      <text class="delete-icon">âŒ</text>
                    </button>
                  </view>
                  <view wx:if="{{ item.tags && item.tags.length > 0 }}" class="entry-tags">
                    <text class="tag-item" wx:for="{{ item.tags }}" wx:key="tag" wx:for-item="tag">{{ tag }}</text>
                  </view>
                </view>
                <view class="total-time">
                  <text class="total-label">æ€»è®¡ï¼š</text>
                  <text class="total-minutes">{{ totalWastefulMinutes }}åˆ†é’Ÿ</text>
                </view>
              </view>

              <!-- æ·»åŠ æ–°çš„æ—¶é—´æŠ•å…¥ -->
              <view class="add-time-entry">
                <view class="input-row">
                  <input
                    class="activity-input"
                    placeholder="æ´»åŠ¨åç§°ï¼ˆå¦‚ï¼šåˆ·æ‰‹æœºã€å‘å‘†ã€æ‹–å»¶ï¼‰"
                    value="{{ currentWastefulActivity }}"
                    bindinput="onWastefulActivityInput"
                    maxlength="20"
                  />
                  <input
                    class="minutes-input"
                    type="number"
                    placeholder="åˆ†é’Ÿ"
                    value="{{ currentWastefulMinutes }}"
                    bindinput="onWastefulMinutesInput"
                  />
                </view>

                <!-- æ ‡ç­¾é€‰æ‹© -->
                <view class="tags-selector">
                  <text class="tags-label">ğŸ·ï¸ æ ‡ç­¾ï¼š</text>
                  <view class="tags-list">
                    <view
                      class="tag-option {{ currentWastefulActivityTags.indexOf(tag) > -1 ? 'selected' : '' }}"
                      wx:for="{{ availableTags }}"
                      wx:key="tag"
                      wx:for-item="tag"
                      bindtap="toggleActivityTag"
                      data-tag="{{ tag }}"
                      data-type="wasteful"
                    >
                      <text>{{ tag }}</text>
                    </view>
                  </view>
                  <!-- è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
                  <view class="custom-tag-input">
                    <input
                      class="custom-tag-field"
                      placeholder="è¾“å…¥è‡ªå®šä¹‰æ ‡ç­¾"
                      value="{{ currentCustomTag }}"
                      bindinput="onCustomTagInput"
                      data-type="wasteful"
                      maxlength="10"
                    />
                    <button
                      class="add-custom-tag-btn"
                      bindtap="addCustomTag"
                      data-type="wasteful"
                    >
                      <text>+</text>
                    </button>
                  </view>
                </view>

                <button
                  class="add-entry-btn"
                  bindtap="addTimeEntry"
                  data-type="wasteful"
                  disabled="{{ !canAddWastefulTimeEntry }}"
                >
                  <text>âœ… æ·»åŠ æ´»åŠ¨</text>
                </button>

                <view class="input-hint">
                  <text class="hint-text">ğŸ’¡ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°ï¼ˆå¦‚ï¼š5, 10, 15, 30, 60ï¼‰</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- è§„åˆ’æ¨¡å¼ä¿æŒåŸæœ‰è¾“å…¥ -->
        <view wx:if="{{ recordMode === 'planning' }}">
          <view class="planning-input-header">
            <view class="planning-input-title">
              <text class="icon">ğŸ“‹</text>
              <text>æ˜æ—¥è§„åˆ’å†…å®¹</text>
            </view>
            <button class="voice-input-btn {{ isRecording && currentVoiceType === 'planning' ? 'recording' : '' }}" bindtap="toggleVoiceInput" data-type="planning">
              <text class="btn-icon">{{ isRecording && currentVoiceType === 'planning' ? 'â¹ï¸' : 'ğŸ¤' }}</text>
            </button>
          </view>
          <textarea 
            class="memo-textarea planning"
            placeholder="æ˜å¤©æˆ‘è¦åšçš„é‡è¦äº‹æƒ…..."
            value="{{ textContent }}"
            bindinput="onTextInput"
            maxlength="{{ maxLength }}"
            auto-focus="{{ inputType === 'text' }}"
          />
          <view class="textarea-footer">
            <view class="char-count">{{ textContent.length }}/{{ maxLength }}</view>
            <button wx:if="{{ textContent.length > 0 }}"
                    class="format-btn"
                    bindtap="applyMarkdownFormatting"
                    data-type="planning">
              <text class="format-icon">âœ¨</text>
              <text class="format-text">æ ¼å¼åŒ–</text>
            </button>
          </view>

          <!-- è§„åˆ’æ—¶é—´æç¤º -->
          <view class="planning-time-notice">
            <text class="notice-icon">â°</text>
            <text class="notice-text">è§„åˆ’æ—¶é—´å°†è‡ªåŠ¨è®°å½•ä¸ºå½“å‰æ—¶åˆ»</text>
          </view>

          <!-- å¤šå¾…åŠæç¤º -->
          <view class="planning-time-notice" style="margin-top: 12rpx; border-left-color: #6366f1;">
            <text class="notice-icon">ğŸ’¡</text>
            <text class="notice-text">å¤šä¸ªå¾…åŠäº‹é¡¹è¯·ç”¨<text style="font-weight: bold; color: #6366f1;">æ¢è¡Œ</text>åˆ†éš”ï¼Œä¿å­˜æ—¶å¯æ™ºèƒ½åˆ›å»º</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿæ¨¡æ¿ -->
    <view class="card">
      <view class="card-content">
        <view class="subtitle">{{ recordMode === 'planning' ? 'è§„åˆ’æ¨¡æ¿' : 'å¿«é€Ÿæ¨¡æ¿' }}</view>
        <view class="template-list">
          <view class="template-item" wx:for="{{ currentTemplates }}" wx:key="index" bindtap="useTemplate" data-template="{{ item }}">
            {{ item }}
          </view>
        </view>
      </view>
    </view>
  </view>


  <!-- æ—¶é—´é€‰æ‹© (æ˜æ—¥è§„åˆ’æ¨¡å¼ä¸‹éšè—) -->
  <view class="card" wx:if="{{ recordMode === 'normal' }}">
    <view class="card-content">
      <view class="subtitle">é€‰æ‹©æ—¶é—´</view>
      <view class="time-tip">
        <text class="tip-icon">â°</text>
        <text class="tip-text">é€‰æ‹©æ´»åŠ¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´</text>
      </view>
      
      <!-- æ—¥æœŸé€‰æ‹© -->
      <view class="date-selector">
        <view class="date-options">
          <view 
            class="date-chip {{ selectedDateType === 'today' ? 'active' : '' }}"
            bindtap="selectDateType"
            data-type="today"
          >
            <text class="chip-icon">ğŸ“…</text>
            <text class="chip-text">ä»Šå¤©</text>
          </view>
          <view 
            class="date-chip {{ selectedDateType === 'yesterday' ? 'active' : '' }}"
            bindtap="selectDateType"
            data-type="yesterday"
          >
            <text class="chip-icon">ğŸ“†</text>
            <text class="chip-text">æ˜¨å¤©</text>
          </view>
          <view 
            class="date-chip {{ selectedDateType === 'custom' ? 'active' : '' }}"
            bindtap="selectDateType"
            data-type="custom"
          >
            <text class="chip-icon">ğŸ“‹</text>
            <text class="chip-text">å…¶ä»–æ—¥æœŸ</text>
          </view>
        </view>
        
        <!-- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨ -->
        <view wx:if="{{ selectedDateType === 'custom' }}" class="custom-date-picker">
          <picker 
            mode="date" 
            value="{{ customDate }}" 
            start="2020-01-01" 
            end="{{ todayDate }}"
            bindchange="onDateChange"
          >
            <view class="date-picker-display">
              <text class="picker-icon">ğŸ“…</text>
              <text class="picker-text">{{ customDateDisplay }}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>

      <!-- æ—¶é—´é€‰æ‹©å™¨ -->
      <view class="time-selector">
        <!-- å¼€å§‹æ—¶é—´ -->
        <view class="time-input-group">
          <view class="time-label">
            <text class="label-icon">ğŸ•</text>
            <text class="label-text">å¼€å§‹æ—¶é—´</text>
          </view>
          <picker 
            mode="selector" 
            range="{{ timeOptions }}"
            range-key="label"
            value="{{ startTimeIndex }}" 
            bindchange="onStartTimeChange"
          >
            <view class="time-picker-display">
              <text class="time-text">{{ startTimeDisplay }}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <!-- ç»“æŸæ—¶é—´ -->
        <view class="time-input-group">
          <view class="time-label">
            <text class="label-icon">ğŸ•</text>
            <text class="label-text">ç»“æŸæ—¶é—´</text>
          </view>
          <picker 
            mode="selector" 
            range="{{ timeOptions }}"
            range-key="label"
            value="{{ endTimeIndex }}" 
            bindchange="onEndTimeChange"
          >
            <view class="time-picker-display">
              <text class="time-text">{{ endTimeDisplay }}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>

      <!-- é€‰ä¸­çš„æ—¶é—´æ˜¾ç¤º -->
      <view class="selected-time-display">
        <text class="display-icon">â±ï¸</text>
        <text class="display-text">{{ selectedTimeDisplay }}</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é€‰æ‹© -->
  <view class="card">
    <view class="card-content">
      <view class="subtitle">æ·»åŠ æ ‡ç­¾</view>
      
      
      <view class="tag-selector">
        <view 
          class="tag-item {{ selectedTags.indexOf(item) !== -1 ? 'selected' : '' }}"
          wx:for="{{ availableTags }}" 
          wx:key="index"
          bindtap="toggleTag"
          data-tag="{{ item }}"
        >
          {{ item }}
        </view>
      </view>
      
      <!-- è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
      <view class="custom-tag-input">
        <input 
          class="input"
          placeholder="æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾"
          value="{{ customTag }}"
          bindinput="onCustomTagInput"
          bindconfirm="addCustomTag"
        />
        <button wx:if="{{ customTag.length > 0 }}" class="btn btn-secondary" bindtap="addCustomTag">æ·»åŠ </button>
      </view>
    </view>
  </view>

  <!-- ç›®æ ‡å…³è” -->
  <view class="card" wx:if="{{ recordMode === 'normal' && availableGoals.length > 0 }}">
    <view class="card-content">
      <view class="subtitle">å…³è”ç›®æ ‡</view>
      <view class="goal-association-tip">
        <text class="tip-icon">ğŸ¯</text>
        <text class="tip-text">å°†è¿™æ¡è®°å½•å…³è”åˆ°ç›®æ ‡ï¼Œè®°å½•å®ç°è·¯å¾„</text>
      </view>
      
      <!-- ç›®æ ‡é€‰æ‹©åˆ—è¡¨ -->
      <view class="goal-selector">
        <view 
          class="goal-item {{ selectedGoalId === goal.id ? 'selected' : '' }}"
          wx:for="{{ availableGoals }}"
          wx:key="id"
          wx:for-item="goal"
          bindtap="selectGoal"
          data-goal-id="{{ goal.id }}"
        >
          <view class="goal-header">
            <view class="goal-title">{{ goal.title }}</view>
            <view class="goal-type type-{{ goal.type }}">
              {{ goal.type === 'short' ? 'çŸ­æœŸ' : goal.type === 'medium' ? 'ä¸­æœŸ' : 'é•¿æœŸ' }}
            </view>
          </view>
          <view class="goal-meta">
            <text class="goal-category">{{ goal.category }}</text>
            <text class="goal-progress">{{ goal.progress }}%</text>
          </view>
          <view class="goal-progress-bar">
            <view class="progress-fill" style="width: {{ goal.progress }}%"></view>
          </view>
        </view>
      </view>
      
      <!-- æ¸…é™¤é€‰æ‹© -->
      <view wx:if="{{ selectedGoalId }}" class="clear-selection">
        <button class="btn btn-text" bindtap="clearGoalSelection">
          <text>âŒ å–æ¶ˆå…³è”</text>
        </button>
      </view>
      
      <!-- ç›®æ ‡æŠ•å…¥è¯¦æƒ… -->
      <view wx:if="{{ selectedGoalId }}" class="goal-investment-section">
        <view class="investment-header">
          <text class="icon">â±ï¸</text>
          <text class="investment-title">æŠ•å…¥è¯„ä¼°</text>
        </view>
        
        <!-- æ—¶é—´æŠ•å…¥ -->
        <view class="investment-group">
          <label class="investment-label">è¿‡å»1å°æ—¶å¯¹æ­¤ç›®æ ‡çš„æŠ•å…¥æ—¶é—´</label>
          <view class="investment-hint">ğŸ’¡ è®°å½•è¿‡å»1å°æ—¶ä¸­èŠ±åœ¨è¿™ä¸ªç›®æ ‡ä¸Šçš„æ—¶é—´</view>
          <view class="time-input-row">
            <slider 
              value="{{ goalTimeInvestment }}" 
              min="5" 
              max="120" 
              step="5"
              show-value
              bindchange="onTimeInvestmentChange"
              activeColor="#6366f1"
              backgroundColor="#e5e7eb"
            />
            <view class="time-display">{{ goalTimeInvestment }}åˆ†é’Ÿ</view>
          </view>
        </view>
        
        <!-- ä»·å€¼è¯„ä¼° -->
        <view class="investment-group">
          <label class="investment-label">ä»·å€¼è¯„ä¼°</label>
          <view class="value-selector">
            <view 
              class="value-item {{ goalValueAssessment === item.value ? 'selected' : '' }}"
              wx:for="{{ valueOptions }}"
              wx:key="value"
              bindtap="selectValueAssessment"
              data-value="{{ item.value }}"
            >
              <text class="value-emoji">{{ item.emoji }}</text>
              <text class="value-text">{{ item.label }}</text>
            </view>
          </view>
        </view>
        
        <!-- æ”¶è·è¯´æ˜ -->
        <view class="investment-group">
          <label class="investment-label">æ”¶è·è¯´æ˜ï¼ˆå¯é€‰ï¼‰</label>
          <textarea 
            class="investment-textarea"
            placeholder="ç®€è¿°æœ¬æ¬¡ä¸ºç›®æ ‡æŠ•å…¥çš„æ”¶è·æˆ–æˆæœ..."
            value="{{ goalInvestmentNote }}"
            bindinput="onInvestmentNoteInput"
            maxlength="100"
          />
          <view class="char-count">{{ goalInvestmentNote.length }}/100</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¿å­˜æŒ‰é’® -->
  <view class="save-section">
    <!-- ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºå–æ¶ˆæŒ‰é’® -->
    <button 
      wx:if="{{ isEditMode }}"
      class="btn btn-secondary cancel-btn"
      bindtap="cancelEdit"
    >
      <text>âŒ å–æ¶ˆç¼–è¾‘</text>
    </button>
    
    <button
      class="btn btn-primary save-btn {{ isEditMode ? 'edit-mode' : '' }}"
      bindtap="saveMemo"
      disabled="{{ !canSave || isSaving }}"
    >
      <text>{{ isSaving ? (isEditMode ? 'æ›´æ–°ä¸­...' : 'ä¿å­˜ä¸­...') : (isEditMode ? 'ğŸ’¾ æ›´æ–°è®°å½•' : (recordMode === 'planning' ? 'ğŸ“‹ ä¿å­˜è§„åˆ’' : 'ğŸ’¾ ä¿å­˜è®°å½•')) }}</text>
    </button>
  </view>
</view>