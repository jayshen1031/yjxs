<view class="container">
  <!-- è®°å½•è¾“å…¥åŒºåŸŸ -->
  <view class="input-section fade-in">
    <view class="card">
      <view class="card-content">
        <view class="title">ğŸ“ æ—¶é—´æŠ•å…¥è®°å½•</view>
        <view class="value-tip">
          <text class="tip-icon">ğŸ¯</text>
          <text class="tip-text">æŒ‰æ—¶é—´é¡ºåºè®°å½•æ´»åŠ¨ï¼Œæ¯ä¸ªæ´»åŠ¨ç‹¬ç«‹æ ‡è®°ä»·å€¼ç±»å‹</text>
        </view>

        <!-- æ—¶é—´é€‰æ‹©åŒºåŸŸ -->
        <view class="time-selection">
          <!-- æ—¥æœŸç±»å‹é€‰æ‹© -->
          <view class="date-type-selector">
            <view
              class="date-type-option {{ selectedDateType === 'today' ? 'active' : '' }}"
              bindtap="selectDateType"
              data-type="today"
            >
              <text class="date-type-label">ä»Šå¤©</text>
            </view>
            <view
              class="date-type-option {{ selectedDateType === 'yesterday' ? 'active' : '' }}"
              bindtap="selectDateType"
              data-type="yesterday"
            >
              <text class="date-type-label">æ˜¨å¤©</text>
            </view>
            <view
              class="date-type-option {{ selectedDateType === 'custom' ? 'active' : '' }}"
              bindtap="selectDateType"
              data-type="custom"
            >
              <text class="date-type-label">è‡ªå®šä¹‰</text>
            </view>
          </view>

          <!-- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©(ä»…åœ¨é€‰æ‹©è‡ªå®šä¹‰æ—¶æ˜¾ç¤º) -->
          <view wx:if="{{ selectedDateType === 'custom' }}" class="custom-date-picker">
            <picker
              mode="date"
              value="{{ customDate }}"
              bindchange="onDateChange"
              start="2024-01-01"
              end="{{ todayDate }}"
            >
              <view class="picker-display">
                <text class="picker-icon">ğŸ“…</text>
                <text class="picker-text">{{ customDateDisplay || 'é€‰æ‹©æ—¥æœŸ' }}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>

          <!-- æ—¶é—´æ®µé€‰æ‹© -->
          <view class="time-range-selector">
            <!-- å¼€å§‹æ—¶é—´ -->
            <view class="time-picker-group">
              <text class="time-label">å¼€å§‹</text>
              <picker
                mode="selector"
                range="{{ timeOptions }}"
                range-key="label"
                value="{{ startTimeIndex }}"
                bindchange="onStartTimeChange"
              >
                <view class="picker-display">
                  <text class="picker-icon">â°</text>
                  <text class="picker-text">{{ startTimeDisplay || 'é€‰æ‹©æ—¶é—´' }}</text>
                  <text class="picker-arrow">â–¼</text>
                </view>
              </picker>
            </view>

            <!-- è¿æ¥çº¿ -->
            <text class="time-separator">â†’</text>

            <!-- ç»“æŸæ—¶é—´ -->
            <view class="time-picker-group">
              <text class="time-label">ç»“æŸ</text>
              <picker
                mode="selector"
                range="{{ timeOptions }}"
                range-key="label"
                value="{{ endTimeIndex }}"
                bindchange="onEndTimeChange"
              >
                <view class="picker-display">
                  <text class="picker-icon">â°</text>
                  <text class="picker-text">{{ endTimeDisplay || 'é€‰æ‹©æ—¶é—´' }}</text>
                  <text class="picker-arrow">â–¼</text>
                </view>
              </picker>
            </view>
          </view>

          <!-- é€‰ä¸­æ—¶é—´æ˜¾ç¤º -->
          <view class="selected-time-display">
            <text class="time-display-icon">ğŸ“</text>
            <text class="time-display-text">{{ selectedTimeDisplay }}</text>
          </view>
        </view>

        <!-- å·²æ·»åŠ çš„æ´»åŠ¨åˆ—è¡¨ -->
        <view wx:if="{{ allActivities.length > 0 }}" class="activities-list">
          <view class="activities-header">
            <text class="header-title">å·²æ·»åŠ æ´»åŠ¨</text>
            <view class="stats-summary">
              <text wx:if="{{ totalValuableMinutes > 0 }}" class="stat-item valuable">âœ… {{ totalValuableMinutes }}åˆ†</text>
              <text wx:if="{{ totalNeutralMinutes > 0 }}" class="stat-item neutral">ğŸ“Š {{ totalNeutralMinutes }}åˆ†</text>
              <text wx:if="{{ totalWastefulMinutes > 0 }}" class="stat-item wasteful">âš ï¸ {{ totalWastefulMinutes }}åˆ†</text>
            </view>
          </view>

          <view class="activity-item" wx:for="{{ allActivities }}" wx:key="index">
            <view class="activity-main">
              <view class="activity-type-icon">
                <text wx:if="{{ item.activityType === 'valuable' }}">âœ…</text>
                <text wx:elif="{{ item.activityType === 'neutral' }}">ğŸ“Š</text>
                <text wx:else>âš ï¸</text>
              </view>
              <view class="activity-info">
                <view class="activity-name">{{ item.activity }}</view>
                <view class="activity-meta">
                  <text class="activity-duration">{{ item.minutes }}åˆ†é’Ÿ</text>
                  <view wx:if="{{ item.tags && item.tags.length > 0 }}" class="activity-tags">
                    <text class="tag-item" wx:for="{{ item.tags }}" wx:key="tag" wx:for-item="tag">{{ tag }}</text>
                  </view>
                </view>
                <!-- å…³è”ä¿¡æ¯ -->
                <view wx:if="{{ item.goalTitle || item.todoTitle }}" class="activity-associations">
                  <text wx:if="{{ item.goalTitle }}" class="association-item goal">ğŸ¯ {{ item.goalTitle }}</text>
                  <text wx:if="{{ item.todoTitle }}" class="association-item todo">âœ… {{ item.todoTitle }}</text>
                </view>
              </view>
              <button class="delete-btn" bindtap="removeActivity" data-index="{{ index }}">
                <text class="delete-icon">ğŸ—‘ï¸</text>
              </button>
            </view>
          </view>

          <view class="total-summary">
            <text class="total-label">æ€»è®¡ï¼š</text>
            <text class="total-value">{{ totalMinutes }}åˆ†é’Ÿ ({{ allActivities.length }}é¡¹æ´»åŠ¨)</text>
          </view>
        </view>

        <!-- æ·»åŠ æ–°æ´»åŠ¨è¡¨å• -->
        <view class="add-activity-form">
          <view class="form-header">
            <text class="form-title">â• æ·»åŠ æ–°æ´»åŠ¨</text>
          </view>

          <!-- æ´»åŠ¨åç§° -->
          <view class="form-field">
            <view class="field-label">æ´»åŠ¨åç§°</view>
            <input
              class="field-input"
              placeholder="å¦‚ï¼šæ™¨è¯»ã€é€šå‹¤ã€åˆ·æ‰‹æœº..."
              value="{{ currentActivity }}"
              bindinput="onActivityInput"
              maxlength="100"
            />
          </view>

          <!-- æ—¶é•¿ -->
          <view class="form-field">
            <view class="field-label">æ—¶é•¿ (åˆ†é’Ÿ)</view>
            <input
              class="field-input number-input"
              type="number"
              placeholder="æœ€å°5åˆ†é’Ÿ"
              value="{{ currentMinutes }}"
              bindinput="onMinutesInput"
            />
            <text class="field-hint">5åˆ†é’Ÿä¸ºæœ€å°å•ä½</text>
          </view>

          <!-- ä»·å€¼ç±»å‹é€‰æ‹© -->
          <view class="form-field">
            <view class="field-label">ä»·å€¼ç±»å‹</view>
            <view class="activity-type-selector">
              <view
                class="type-option {{ currentActivityType === 'valuable' ? 'active' : '' }}"
                bindtap="selectActivityType"
                data-type="valuable"
              >
                <text class="type-icon">ğŸŒŸ</text>
                <text class="type-label">æœ‰ä»·å€¼</text>
              </view>
              <view
                class="type-option {{ currentActivityType === 'neutral' ? 'active' : '' }}"
                bindtap="selectActivityType"
                data-type="neutral"
              >
                <text class="type-icon">ğŸ˜</text>
                <text class="type-label">ä¸­æ€§</text>
              </view>
              <view
                class="type-option {{ currentActivityType === 'wasteful' ? 'active' : '' }}"
                bindtap="selectActivityType"
                data-type="wasteful"
              >
                <text class="type-icon">ğŸ—‘ï¸</text>
                <text class="type-label">ä½æ•ˆ</text>
              </view>
            </view>
          </view>

          <!-- æ ‡ç­¾é€‰æ‹© -->
          <view class="form-field">
            <view class="field-label">ğŸ·ï¸ æ ‡ç­¾ (å¯é€‰)</view>
            <view wx:if="{{ availableTags.length > 0 }}" class="tags-selector">
              <view
                class="tag-option {{ currentActivityTags.indexOf(tag) !== -1 ? 'selected' : '' }}"
                wx:for="{{ availableTags }}"
                wx:key="index"
                wx:for-item="tag"
                bindtap="toggleActivityTag"
                data-tag="{{ tag }}"
              >
                {{ tag }}
              </view>
            </view>
            <view wx:else class="empty-tags-hint">
              <text class="hint-icon">ğŸ“</text>
              <text class="hint-text">æš‚æ— æ ‡ç­¾ï¼Œä½¿ç”¨tagManageræ·»åŠ </text>
            </view>
          </view>

          <!-- å…³è”ç›®æ ‡ -->
          <view class="form-field">
            <view class="field-label">ğŸ¯ å…³è”ç›®æ ‡ (å¯é€‰)</view>
            <picker
              wx:if="{{ availableGoals.length > 0 }}"
              mode="selector"
              range="{{ availableGoals }}"
              range-key="title"
              value="{{ currentActivityGoalIndex }}"
              bindchange="onGoalChange"
            >
              <view class="picker-display">
                <text class="picker-text">{{ currentActivityGoalIndex >= 0 ? availableGoals[currentActivityGoalIndex].title : 'ç‚¹å‡»é€‰æ‹©ç›®æ ‡' }}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
            <view wx:else class="picker-display disabled">
              <text class="picker-text hint">æš‚æ— ç›®æ ‡ï¼Œè¯·å…ˆåœ¨ç›®æ ‡é¡µé¢åˆ›å»º</text>
            </view>
          </view>

          <!-- å…³è”å¾…åŠ -->
          <view class="form-field">
            <view class="field-label">âœ… å…³è”å¾…åŠ (å¯é€‰)</view>
            <picker
              wx:if="{{ availableTodos.length > 0 }}"
              mode="selector"
              range="{{ availableTodos }}"
              range-key="title"
              value="{{ currentActivityTodoIndex }}"
              bindchange="onTodoChange"
            >
              <view class="picker-display">
                <text class="picker-text">{{ currentActivityTodoIndex >= 0 ? availableTodos[currentActivityTodoIndex].title : 'ç‚¹å‡»é€‰æ‹©å¾…åŠ' }}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
            <view wx:else class="picker-display disabled">
              <text class="picker-text hint">æš‚æ— å¾…åŠï¼Œè¯·å…ˆåœ¨å¾…åŠé¡µé¢åˆ›å»º</text>
            </view>
          </view>

          <!-- å¾…åŠçŠ¶æ€ (ä»…å½“å…³è”äº†å¾…åŠæ—¶æ˜¾ç¤º) -->
          <view class="form-field" wx:if="{{ currentActivityTodoIndex >= 0 }}">
            <view class="field-label">å¾…åŠçŠ¶æ€</view>
            <view class="status-selector">
              <view
                class="status-option {{ currentActivityTodoStatus === 'è¿›è¡Œä¸­' ? 'active' : '' }}"
                bindtap="selectTodoStatus"
                data-status="è¿›è¡Œä¸­"
              >
                <text class="status-icon">â–¶ï¸</text>
                <text class="status-label">è¿›è¡Œä¸­</text>
              </view>
              <view
                class="status-option {{ currentActivityTodoStatus === 'å·²å®Œæˆ' ? 'active' : '' }}"
                bindtap="selectTodoStatus"
                data-status="å·²å®Œæˆ"
              >
                <text class="status-icon">âœ…</text>
                <text class="status-label">å·²å®Œæˆ</text>
              </view>
            </view>
          </view>

          <!-- æ·»åŠ æŒ‰é’® -->
          <button
            class="add-activity-btn {{ canAddActivity ? '' : 'disabled' }}"
            bindtap="addActivity"
            disabled="{{ !canAddActivity }}"
          >
            <text class="btn-icon">â•</text>
            <text class="btn-text">æ·»åŠ æ´»åŠ¨</text>
          </button>
        </view>

        <!-- ä¿å­˜æŒ‰é’® -->
        <view class="save-section" wx:if="{{ allActivities.length > 0 }}">
          <button
            class="btn btn-primary save-btn"
            bindtap="saveMemo"
            disabled="{{ isSaving }}"
            loading="{{ isSaving }}"
          >
            <text>{{ isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜è®°å½•' }}</text>
          </button>
        </view>
      </view>
    </view>
  </view>
</view>
