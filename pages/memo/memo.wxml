<view class="container">
  <!-- è®°å½•è¾“å…¥åŒºåŸŸ -->
  <view class="input-section fade-in">
    <view class="card">
      <view class="card-content">
        <view class="title">è¿‡å»1å°æ—¶çš„ä»·å€¼å›é¡¾</view>
        <view class="value-tip">
          <text class="tip-icon">ğŸ¯</text>
          <text class="tip-text">åˆ†ç±»è®°å½•è¿‡å»1å°æ—¶çš„æ´»åŠ¨ï¼Œæå‡è‡ªæˆ‘è®¤çŸ¥</text>
        </view>

        <!-- å½•éŸ³çŠ¶æ€æç¤º -->
        <view wx:if="{{ isRecording }}" class="recording-status">
          <view class="recording-info">
            <text class="recording-icon">ğŸ”´</text>
            <text class="recording-text">æ­£åœ¨å½•éŸ³... {{ recordingTime }}s</text>
            <text class="recording-hint">å†æ¬¡ç‚¹å‡»ğŸ¤åœæ­¢å½•éŸ³</text>
          </view>
        </view>

        <!-- ä»·å€¼åˆ†ç±»è¾“å…¥ -->
        <view class="value-categories">
          <!-- Tabå¯¼èˆªæ  -->
          <view class="activity-tabs">
            <view
              class="tab-item {{ activeTab === 'valuable' ? 'active' : '' }}"
              bindtap="switchTab"
              data-tab="valuable"
            >
              <text class="tab-icon">ğŸŒŸ</text>
              <text class="tab-label">æœ‰ä»·å€¼</text>
            </view>
            <view
              class="tab-item {{ activeTab === 'neutral' ? 'active' : '' }}"
              bindtap="switchTab"
              data-tab="neutral"
            >
              <text class="tab-icon">ğŸ˜</text>
              <text class="tab-label">ä¸­æ€§</text>
            </view>
            <view
              class="tab-item {{ activeTab === 'wasteful' ? 'active' : '' }}"
              bindtap="switchTab"
              data-tab="wasteful"
            >
              <text class="tab-icon">ğŸ—‘ï¸</text>
              <text class="tab-label">ä½æ•ˆ</text>
            </view>
          </view>

          <!-- æœ‰ä»·å€¼å†…å®¹ -->
          <view wx:if="{{ activeTab === 'valuable' }}" class="value-category valuable">
            <view class="category-header">
              <text class="category-icon">ğŸŒŸ</text>
              <text class="category-title">æœ‰ä»·å€¼çš„æ´»åŠ¨</text>
              <button class="voice-input-btn {{ isRecording && currentVoiceType === 'valuable' ? 'recording' : '' }}" bindtap="toggleVoiceInput" data-type="valuable">
                <text class="btn-icon">{{ isRecording && currentVoiceType === 'valuable' ? 'â¹ï¸' : 'ğŸ¤' }}</text>
              </button>
            </view>
            <textarea 
              class="category-textarea valuable"
              placeholder="è¿‡å»1å°æ—¶ä¸­æœ‰æ”¶è·ã€æœ‰æ„ä¹‰çš„æ´»åŠ¨ï¼Œå¦‚å­¦ä¹ ã€å·¥ä½œè¿›å±•ã€å¥åº·æ´»åŠ¨ç­‰..."
              value="{{ valuableContent }}"
              bindinput="onValuableInput"
              maxlength="200"
            />
            <view class="textarea-footer">
              <view class="char-count">{{ valuableContent.length }}/200</view>
              <button wx:if="{{ valuableContent.length > 0 }}" 
                      class="format-btn" 
                      bindtap="applyMarkdownFormatting" 
                      data-type="valuable">
                <text class="format-icon">âœ¨</text>
                <text class="format-text">æ ¼å¼åŒ–</text>
              </button>
            </view>
            
            <!-- æ—¶é—´æŠ•å…¥ç»Ÿè®¡ -->
            <view class="time-investment-section">
              <view class="investment-header">
                <text class="header-icon">â±ï¸</text>
                <text class="header-title">æ—¶é—´æŠ•å…¥ç»Ÿè®¡</text>
                <text class="header-subtitle">(5åˆ†é’Ÿä¸ºæœ€å°å•ä½)</text>
              </view>
              
              <!-- å·²æ·»åŠ çš„æ—¶é—´æŠ•å…¥åˆ—è¡¨ -->
              <view wx:if="{{ valuableTimeEntries.length > 0 }}" class="time-entries-list">
                <view
                  class="time-entry-item"
                  wx:for="{{ valuableTimeEntries }}"
                  wx:key="index"
                >
                  <view class="entry-main">
                    <view class="entry-content">
                      <text class="entry-activity">{{ item.activity }}</text>
                      <text class="entry-minutes">{{ item.minutes }}åˆ†é’Ÿ</text>
                    </view>
                    <button class="entry-delete-btn" bindtap="removeTimeEntry" data-index="{{ index }}" data-type="valuable">
                      <text class="delete-icon">âŒ</text>
                    </button>
                  </view>
                  <view wx:if="{{ item.tags && item.tags.length > 0 }}" class="entry-tags">
                    <text class="tag-item" wx:for="{{ item.tags }}" wx:key="tag" wx:for-item="tag">{{ tag }}</text>
                  </view>
                  <!-- å…³è”ä¿¡æ¯æ˜¾ç¤º â­ æ–°å¢ -->
                  <view wx:if="{{ item.goalTitle || item.todoTitle }}" class="entry-associations">
                    <text wx:if="{{ item.goalTitle }}" class="association-item goal-association">ğŸ¯ {{ item.goalTitle }}</text>
                    <text wx:if="{{ item.todoTitle }}" class="association-item todo-association">âœ… {{ item.todoTitle }}</text>
                  </view>
                </view>
                <view class="total-time">
                  <text class="total-label">æ€»è®¡ï¼š</text>
                  <text class="total-minutes">{{ totalValuableMinutes }}åˆ†é’Ÿ</text>
                </view>
              </view>

              <!-- æ·»åŠ æ–°çš„æ—¶é—´æŠ•å…¥ -->
              <view class="add-time-entry">
                <view class="input-row">
                  <input
                    class="activity-input"
                    placeholder="æ´»åŠ¨åç§°ï¼ˆå¦‚ï¼šç¼–ç¨‹ã€å­¦ä¹ ã€è¿åŠ¨ï¼‰"
                    value="{{ currentActivity }}"
                    bindinput="onActivityInput"
                    maxlength="20"
                  />
                  <input
                    class="minutes-input"
                    type="number"
                    placeholder="åˆ†é’Ÿ"
                    value="{{ currentMinutes }}"
                    bindinput="onMinutesInput"
                  />
                </view>

                <!-- æ ‡ç­¾é€‰æ‹© -->
                <view class="tags-selector">
                  <text class="tags-label">ğŸ·ï¸ æ ‡ç­¾ï¼š</text>
                  <view class="tags-list">
                    <view
                      class="tag-option {{ currentActivityTags.indexOf(tag) > -1 ? 'selected' : '' }}"
                      wx:for="{{ availableTags }}"
                      wx:key="tag"
                      wx:for-item="tag"
                      bindtap="toggleActivityTag"
                      data-tag="{{ tag }}"
                      data-type="valuable"
                    >
                      <text>{{ tag }}</text>
                    </view>
                    <!-- è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ï¼ˆç´§å‡‘ç‰ˆï¼Œä½œä¸ºæ ‡ç­¾æŒ‰é’®ï¼‰ -->
                    <view class="tag-option custom-tag-compact">
                      <input
                        class="custom-tag-field-compact"
                        placeholder="+ æ–°å»º"
                        value="{{ currentCustomTag }}"
                        bindinput="onCustomTagInput"
                        bindblur="addCustomTag"
                        data-type="valuable"
                        maxlength="6"
                      />
                    </view>
                  </view>
                </view>

                <!-- ç›®æ ‡å…³è”é€‰æ‹© -->
                <view class="goal-selector">
                  <text class="goal-label">ğŸ¯ å…³è”ç›®æ ‡ï¼ˆå¯é€‰ï¼‰ï¼š</text>
                  <picker
                    class="goal-picker"
                    mode="selector"
                    range="{{ availableGoals }}"
                    range-key="title"
                    value="{{ currentActivityGoalIndex }}"
                    bindchange="onActivityGoalChange"
                    data-type="valuable"
                  >
                    <view class="picker-display">
                      <text>{{ currentActivityGoalIndex >= 0 ? availableGoals[currentActivityGoalIndex].title : 'é€‰æ‹©ç›®æ ‡' }}</text>
                    </view>
                  </picker>
                </view>

                <!-- å¾…åŠå…³è”é€‰æ‹© â­ æ–°å¢ -->
                <view class="todo-selector">
                  <text class="todo-label">âœ… å…³è”å¾…åŠï¼ˆå¯é€‰ï¼‰ï¼š</text>
                  <picker
                    class="todo-picker"
                    mode="selector"
                    range="{{ availableTodos }}"
                    range-key="title"
                    value="{{ currentActivityTodoIndex }}"
                    bindchange="onActivityTodoChange"
                    data-type="valuable"
                  >
                    <view class="picker-display">
                      <text>{{ currentActivityTodoIndex >= 0 ? availableTodos[currentActivityTodoIndex].title : 'é€‰æ‹©å¾…åŠ' }}</text>
                    </view>
                  </picker>

                  <!-- å¾…åŠçŠ¶æ€é€‰æ‹© â­ æ–°å¢ -->
                  <view wx:if="{{ currentActivityTodoIndex >= 0 }}" class="todo-status-selector">
                    <text class="status-label">æ ‡è®°ä¸ºï¼š</text>
                    <view class="status-options">
                      <view
                        class="status-option {{ currentActivityTodoStatus === 'è¿›è¡Œä¸­' ? 'selected' : '' }}"
                        bindtap="selectTodoStatus"
                        data-status="è¿›è¡Œä¸­"
                        data-type="valuable"
                      >
                        <text>â–¶ï¸ è¿›è¡Œä¸­</text>
                      </view>
                      <view
                        class="status-option {{ currentActivityTodoStatus === 'å·²å®Œæˆ' ? 'selected' : '' }}"
                        bindtap="selectTodoStatus"
                        data-status="å·²å®Œæˆ"
                        data-type="valuable"
                      >
                        <text>âœ… å·²å®Œæˆ</text>
                      </view>
                    </view>
                  </view>
                </view>

                <!-- è°ƒè¯•æç¤ºï¼šæ˜¾ç¤ºå½“å‰çŠ¶æ€ -->
                <view wx:if="{{ !canAddTimeEntry }}" class="debug-hint">
                  <text class="debug-text">
                    âš ï¸ æ´»åŠ¨åç§°ï¼š{{ currentActivity || '(æœªå¡«å†™)' }} |
                    åˆ†é’Ÿæ•°ï¼š{{ currentMinutes || '(æœªå¡«å†™)' }}
                    <text wx:if="{{ currentMinutes && currentMinutes % 5 !== 0 }}" class="error-hint">
                      âŒ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°
                    </text>
                  </text>
                </view>

                <button
                  class="add-entry-btn {{ canAddTimeEntry ? '' : 'btn-disabled' }}"
                  bindtap="addTimeEntry"
                  data-type="valuable"
                >
                  <text>{{ canAddTimeEntry ? 'âœ… æ·»åŠ æ´»åŠ¨' : 'âš ï¸ è¯·å…ˆå¡«å†™ä¿¡æ¯' }}</text>
                </button>

                <view class="input-hint">
                  <text class="hint-text">ğŸ’¡ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°ï¼ˆå¦‚ï¼š5, 10, 15, 30, 60ï¼‰</text>
                </view>
              </view>
            </view>
          </view>

          <!-- ä¸­æ€§å†…å®¹ -->
          <view wx:if="{{ activeTab === 'neutral' }}" class="value-category neutral">
            <view class="category-header">
              <text class="category-icon">ğŸ˜</text>
              <text class="category-title">ä¸­æ€§çš„æ´»åŠ¨</text>
              <button class="voice-input-btn {{ isRecording && currentVoiceType === 'neutral' ? 'recording' : '' }}" bindtap="toggleVoiceInput" data-type="neutral">
                <text class="btn-icon">{{ isRecording && currentVoiceType === 'neutral' ? 'â¹ï¸' : 'ğŸ¤' }}</text>
              </button>
            </view>
            <textarea 
              class="category-textarea neutral"
              placeholder="æ—¥å¸¸å¿…è¦çš„æ´»åŠ¨ï¼Œå¦‚åƒé¥­ã€é€šå‹¤ã€åŸºæœ¬æ²Ÿé€šç­‰..."
              value="{{ neutralContent }}"
              bindinput="onNeutralInput"
              maxlength="200"
            />
            <view class="textarea-footer">
              <view class="char-count">{{ neutralContent.length }}/200</view>
              <button wx:if="{{ neutralContent.length > 0 }}" 
                      class="format-btn" 
                      bindtap="applyMarkdownFormatting" 
                      data-type="neutral">
                <text class="format-icon">âœ¨</text>
                <text class="format-text">æ ¼å¼åŒ–</text>
              </button>
            </view>
            
            <!-- ä¸­æ€§æ´»åŠ¨æ—¶é—´æŠ•å…¥ç»Ÿè®¡ -->
            <view class="time-investment-section">
              <view class="investment-header">
                <text class="header-icon">â±ï¸</text>
                <text class="header-title">æ—¶é—´æŠ•å…¥ç»Ÿè®¡</text>
                <text class="header-subtitle">(5åˆ†é’Ÿä¸ºæœ€å°å•ä½)</text>
              </view>
              
              <!-- å·²æ·»åŠ çš„æ—¶é—´æŠ•å…¥åˆ—è¡¨ -->
              <view wx:if="{{ neutralTimeEntries.length > 0 }}" class="time-entries-list">
                <view
                  class="time-entry-item"
                  wx:for="{{ neutralTimeEntries }}"
                  wx:key="index"
                >
                  <view class="entry-main">
                    <view class="entry-content">
                      <text class="entry-activity">{{ item.activity }}</text>
                      <text class="entry-minutes">{{ item.minutes }}åˆ†é’Ÿ</text>
                    </view>
                    <button class="entry-delete-btn" bindtap="removeTimeEntry" data-index="{{ index }}" data-type="neutral">
                      <text class="delete-icon">âŒ</text>
                    </button>
                  </view>
                  <view wx:if="{{ item.tags && item.tags.length > 0 }}" class="entry-tags">
                    <text class="tag-item" wx:for="{{ item.tags }}" wx:key="tag" wx:for-item="tag">{{ tag }}</text>
                  </view>
                  <!-- å…³è”ä¿¡æ¯æ˜¾ç¤º â­ æ–°å¢ -->
                  <view wx:if="{{ item.goalTitle || item.todoTitle }}" class="entry-associations">
                    <text wx:if="{{ item.goalTitle }}" class="association-item goal-association">ğŸ¯ {{ item.goalTitle }}</text>
                    <text wx:if="{{ item.todoTitle }}" class="association-item todo-association">âœ… {{ item.todoTitle }}</text>
                  </view>
                </view>
                <view class="total-time">
                  <text class="total-label">æ€»è®¡ï¼š</text>
                  <text class="total-minutes">{{ totalNeutralMinutes }}åˆ†é’Ÿ</text>
                </view>
              </view>

              <!-- æ·»åŠ æ–°çš„æ—¶é—´æŠ•å…¥ -->
              <view class="add-time-entry">
                <view class="input-row">
                  <input
                    class="activity-input"
                    placeholder="æ´»åŠ¨åç§°ï¼ˆå¦‚ï¼šåƒé¥­ã€é€šå‹¤ã€ä¼‘æ¯ï¼‰"
                    value="{{ currentNeutralActivity }}"
                    bindinput="onNeutralActivityInput"
                    maxlength="20"
                  />
                  <input
                    class="minutes-input"
                    type="number"
                    placeholder="åˆ†é’Ÿ"
                    value="{{ currentNeutralMinutes }}"
                    bindinput="onNeutralMinutesInput"
                  />
                </view>

                <!-- æ ‡ç­¾é€‰æ‹© -->
                <view class="tags-selector">
                  <text class="tags-label">ğŸ·ï¸ æ ‡ç­¾ï¼š</text>
                  <view class="tags-list">
                    <view
                      class="tag-option {{ currentNeutralActivityTags.indexOf(tag) > -1 ? 'selected' : '' }}"
                      wx:for="{{ availableTags }}"
                      wx:key="tag"
                      wx:for-item="tag"
                      bindtap="toggleActivityTag"
                      data-tag="{{ tag }}"
                      data-type="neutral"
                    >
                      <text>{{ tag }}</text>
                    </view>
                    <!-- ç´§å‡‘çš„è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
                    <view class="tag-option custom-tag-compact">
                      <input
                        class="custom-tag-field-compact"
                        placeholder="+ æ–°å»º"
                        value="{{ currentCustomTag }}"
                        bindinput="onCustomTagInput"
                        bindblur="addCustomTag"
                        data-type="neutral"
                        maxlength="6"
                      />
                    </view>
                  </view>
                </view>

                <!-- ç›®æ ‡å…³è”é€‰æ‹© -->
                <view class="goal-selector">
                  <text class="goal-label">ğŸ¯ å…³è”ç›®æ ‡ï¼ˆå¯é€‰ï¼‰ï¼š</text>
                  <picker
                    class="goal-picker"
                    mode="selector"
                    range="{{ availableGoals }}"
                    range-key="title"
                    value="{{ currentNeutralActivityGoalIndex }}"
                    bindchange="onActivityGoalChange"
                    data-type="neutral"
                  >
                    <view class="picker-display">
                      <text>{{ currentNeutralActivityGoalIndex >= 0 ? availableGoals[currentNeutralActivityGoalIndex].title : 'é€‰æ‹©ç›®æ ‡' }}</text>
                    </view>
                  </picker>
                </view>

                <!-- å¾…åŠå…³è”é€‰æ‹© â­ æ–°å¢ -->
                <view class="todo-selector">
                  <text class="todo-label">âœ… å…³è”å¾…åŠï¼ˆå¯é€‰ï¼‰ï¼š</text>
                  <picker
                    class="todo-picker"
                    mode="selector"
                    range="{{ availableTodos }}"
                    range-key="title"
                    value="{{ currentNeutralActivityTodoIndex }}"
                    bindchange="onActivityTodoChange"
                    data-type="neutral"
                  >
                    <view class="picker-display">
                      <text>{{ currentNeutralActivityTodoIndex >= 0 ? availableTodos[currentNeutralActivityTodoIndex].title : 'é€‰æ‹©å¾…åŠ' }}</text>
                    </view>
                  </picker>

                  <!-- å¾…åŠçŠ¶æ€é€‰æ‹© â­ æ–°å¢ -->
                  <view wx:if="{{ currentNeutralActivityTodoIndex >= 0 }}" class="todo-status-selector">
                    <text class="status-label">æ ‡è®°ä¸ºï¼š</text>
                    <view class="status-options">
                      <view
                        class="status-option {{ currentNeutralActivityTodoStatus === 'è¿›è¡Œä¸­' ? 'selected' : '' }}"
                        bindtap="selectTodoStatus"
                        data-status="è¿›è¡Œä¸­"
                        data-type="neutral"
                      >
                        <text>â–¶ï¸ è¿›è¡Œä¸­</text>
                      </view>
                      <view
                        class="status-option {{ currentNeutralActivityTodoStatus === 'å·²å®Œæˆ' ? 'selected' : '' }}"
                        bindtap="selectTodoStatus"
                        data-status="å·²å®Œæˆ"
                        data-type="neutral"
                      >
                        <text>âœ… å·²å®Œæˆ</text>
                      </view>
                    </view>
                  </view>
                </view>

                <!-- è°ƒè¯•æç¤ºï¼šæ˜¾ç¤ºå½“å‰çŠ¶æ€ -->
                <view wx:if="{{ !canAddNeutralTimeEntry }}" class="debug-hint">
                  <text class="debug-text">
                    âš ï¸ æ´»åŠ¨åç§°ï¼š{{ currentNeutralActivity || '(æœªå¡«å†™)' }} |
                    åˆ†é’Ÿæ•°ï¼š{{ currentNeutralMinutes || '(æœªå¡«å†™)' }}
                    <text wx:if="{{ currentNeutralMinutes && currentNeutralMinutes % 5 !== 0 }}" class="error-hint">
                      âŒ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°
                    </text>
                  </text>
                </view>

                <button
                  class="add-entry-btn {{ canAddNeutralTimeEntry ? '' : 'btn-disabled' }}"
                  bindtap="addTimeEntry"
                  data-type="neutral"
                >
                  <text>{{ canAddNeutralTimeEntry ? 'âœ… æ·»åŠ æ´»åŠ¨' : 'âš ï¸ è¯·å…ˆå¡«å†™ä¿¡æ¯' }}</text>
                </button>

                <view class="input-hint">
                  <text class="hint-text">ğŸ’¡ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°ï¼ˆå¦‚ï¼š5, 10, 15, 30, 60ï¼‰</text>
                </view>
              </view>
            </view>
          </view>

          <!-- æ— ä»·å€¼å†…å®¹ -->
          <view wx:if="{{ activeTab === 'wasteful' }}" class="value-category wasteful">
            <view class="category-header">
              <text class="category-icon">ğŸ—‘ï¸</text>
              <text class="category-title">ä½æ•ˆçš„æ´»åŠ¨</text>
              <button class="voice-input-btn {{ isRecording && currentVoiceType === 'wasteful' ? 'recording' : '' }}" bindtap="toggleVoiceInput" data-type="wasteful">
                <text class="btn-icon">{{ isRecording && currentVoiceType === 'wasteful' ? 'â¹ï¸' : 'ğŸ¤' }}</text>
              </button>
            </view>
            <textarea 
              class="category-textarea wasteful"
              placeholder="æµªè´¹æ—¶é—´çš„æ´»åŠ¨ï¼Œå¦‚æ— æ„ä¹‰åˆ·æ‰‹æœºã€å‘å‘†ã€æ‹–å»¶ç­‰..."
              value="{{ wastefulContent }}"
              bindinput="onWastefulInput"
              maxlength="200"
            />
            <view class="textarea-footer">
              <view class="char-count">{{ wastefulContent.length }}/200</view>
              <button wx:if="{{ wastefulContent.length > 0 }}" 
                      class="format-btn" 
                      bindtap="applyMarkdownFormatting" 
                      data-type="wasteful">
                <text class="format-icon">âœ¨</text>
                <text class="format-text">æ ¼å¼åŒ–</text>
              </button>
            </view>
            
            <!-- ä½æ•ˆæ´»åŠ¨æ—¶é—´æŠ•å…¥ç»Ÿè®¡ -->
            <view class="time-investment-section">
              <view class="investment-header">
                <text class="header-icon">â±ï¸</text>
                <text class="header-title">æ—¶é—´æŠ•å…¥ç»Ÿè®¡</text>
                <text class="header-subtitle">(5åˆ†é’Ÿä¸ºæœ€å°å•ä½)</text>
              </view>
              
              <!-- å·²æ·»åŠ çš„æ—¶é—´æŠ•å…¥åˆ—è¡¨ -->
              <view wx:if="{{ wastefulTimeEntries.length > 0 }}" class="time-entries-list">
                <view
                  class="time-entry-item"
                  wx:for="{{ wastefulTimeEntries }}"
                  wx:key="index"
                >
                  <view class="entry-main">
                    <view class="entry-content">
                      <text class="entry-activity">{{ item.activity }}</text>
                      <text class="entry-minutes">{{ item.minutes }}åˆ†é’Ÿ</text>
                    </view>
                    <button class="entry-delete-btn" bindtap="removeTimeEntry" data-index="{{ index }}" data-type="wasteful">
                      <text class="delete-icon">âŒ</text>
                    </button>
                  </view>
                  <view wx:if="{{ item.tags && item.tags.length > 0 }}" class="entry-tags">
                    <text class="tag-item" wx:for="{{ item.tags }}" wx:key="tag" wx:for-item="tag">{{ tag }}</text>
                  </view>
                  <!-- å…³è”ä¿¡æ¯æ˜¾ç¤º â­ æ–°å¢ -->
                  <view wx:if="{{ item.goalTitle || item.todoTitle }}" class="entry-associations">
                    <text wx:if="{{ item.goalTitle }}" class="association-item goal-association">ğŸ¯ {{ item.goalTitle }}</text>
                    <text wx:if="{{ item.todoTitle }}" class="association-item todo-association">âœ… {{ item.todoTitle }}</text>
                  </view>
                </view>
                <view class="total-time">
                  <text class="total-label">æ€»è®¡ï¼š</text>
                  <text class="total-minutes">{{ totalWastefulMinutes }}åˆ†é’Ÿ</text>
                </view>
              </view>

              <!-- æ·»åŠ æ–°çš„æ—¶é—´æŠ•å…¥ -->
              <view class="add-time-entry">
                <view class="input-row">
                  <input
                    class="activity-input"
                    placeholder="æ´»åŠ¨åç§°ï¼ˆå¦‚ï¼šåˆ·æ‰‹æœºã€å‘å‘†ã€æ‹–å»¶ï¼‰"
                    value="{{ currentWastefulActivity }}"
                    bindinput="onWastefulActivityInput"
                    maxlength="20"
                  />
                  <input
                    class="minutes-input"
                    type="number"
                    placeholder="åˆ†é’Ÿ"
                    value="{{ currentWastefulMinutes }}"
                    bindinput="onWastefulMinutesInput"
                  />
                </view>

                <!-- æ ‡ç­¾é€‰æ‹© -->
                <view class="tags-selector">
                  <text class="tags-label">ğŸ·ï¸ æ ‡ç­¾ï¼š</text>
                  <view class="tags-list">
                    <view
                      class="tag-option {{ currentWastefulActivityTags.indexOf(tag) > -1 ? 'selected' : '' }}"
                      wx:for="{{ availableTags }}"
                      wx:key="tag"
                      wx:for-item="tag"
                      bindtap="toggleActivityTag"
                      data-tag="{{ tag }}"
                      data-type="wasteful"
                    >
                      <text>{{ tag }}</text>
                    </view>
                    <!-- ç´§å‡‘çš„è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
                    <view class="tag-option custom-tag-compact">
                      <input
                        class="custom-tag-field-compact"
                        placeholder="+ æ–°å»º"
                        value="{{ currentCustomTag }}"
                        bindinput="onCustomTagInput"
                        bindblur="addCustomTag"
                        data-type="wasteful"
                        maxlength="6"
                      />
                    </view>
                  </view>
                </view>

                <!-- è°ƒè¯•æç¤ºï¼šæ˜¾ç¤ºå½“å‰çŠ¶æ€ -->
                <view wx:if="{{ !canAddWastefulTimeEntry }}" class="debug-hint">
                  <text class="debug-text">
                    âš ï¸ æ´»åŠ¨åç§°ï¼š{{ currentWastefulActivity || '(æœªå¡«å†™)' }} |
                    åˆ†é’Ÿæ•°ï¼š{{ currentWastefulMinutes || '(æœªå¡«å†™)' }}
                    <text wx:if="{{ currentWastefulMinutes && currentWastefulMinutes % 5 !== 0 }}" class="error-hint">
                      âŒ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°
                    </text>
                  </text>
                </view>

                <button
                  class="add-entry-btn {{ canAddWastefulTimeEntry ? '' : 'btn-disabled' }}"
                  bindtap="addTimeEntry"
                  data-type="wasteful"
                >
                  <text>{{ canAddWastefulTimeEntry ? 'âœ… æ·»åŠ æ´»åŠ¨' : 'âš ï¸ è¯·å…ˆå¡«å†™ä¿¡æ¯' }}</text>
                </button>

                <view class="input-hint">
                  <text class="hint-text">ğŸ’¡ åˆ†é’Ÿæ•°å¿…é¡»æ˜¯5çš„å€æ•°ï¼ˆå¦‚ï¼š5, 10, 15, 30, 60ï¼‰</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

  </view>


  <!-- æ—¶é—´é€‰æ‹© -->
  <view class="card">
    <view class="card-content">
      <view class="subtitle">é€‰æ‹©æ—¶é—´</view>
      <view class="time-tip">
        <text class="tip-icon">â°</text>
        <text class="tip-text">é€‰æ‹©æ´»åŠ¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´</text>
      </view>
      
      <!-- æ—¥æœŸé€‰æ‹© -->
      <view class="date-selector">
        <view class="date-options">
          <view 
            class="date-chip {{ selectedDateType === 'today' ? 'active' : '' }}"
            bindtap="selectDateType"
            data-type="today"
          >
            <text class="chip-icon">ğŸ“…</text>
            <text class="chip-text">ä»Šå¤©</text>
          </view>
          <view 
            class="date-chip {{ selectedDateType === 'yesterday' ? 'active' : '' }}"
            bindtap="selectDateType"
            data-type="yesterday"
          >
            <text class="chip-icon">ğŸ“†</text>
            <text class="chip-text">æ˜¨å¤©</text>
          </view>
          <view 
            class="date-chip {{ selectedDateType === 'custom' ? 'active' : '' }}"
            bindtap="selectDateType"
            data-type="custom"
          >
            <text class="chip-icon">ğŸ“‹</text>
            <text class="chip-text">å…¶ä»–æ—¥æœŸ</text>
          </view>
        </view>
        
        <!-- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨ -->
        <view wx:if="{{ selectedDateType === 'custom' }}" class="custom-date-picker">
          <picker 
            mode="date" 
            value="{{ customDate }}" 
            start="2020-01-01" 
            end="{{ todayDate }}"
            bindchange="onDateChange"
          >
            <view class="date-picker-display">
              <text class="picker-icon">ğŸ“…</text>
              <text class="picker-text">{{ customDateDisplay }}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>

      <!-- æ—¶é—´é€‰æ‹©å™¨ -->
      <view class="time-selector">
        <!-- å¼€å§‹æ—¶é—´ -->
        <view class="time-input-group">
          <view class="time-label">
            <text class="label-icon">ğŸ•</text>
            <text class="label-text">å¼€å§‹æ—¶é—´</text>
          </view>
          <picker 
            mode="selector" 
            range="{{ timeOptions }}"
            range-key="label"
            value="{{ startTimeIndex }}" 
            bindchange="onStartTimeChange"
          >
            <view class="time-picker-display">
              <text class="time-text">{{ startTimeDisplay }}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <!-- ç»“æŸæ—¶é—´ -->
        <view class="time-input-group">
          <view class="time-label">
            <text class="label-icon">ğŸ•</text>
            <text class="label-text">ç»“æŸæ—¶é—´</text>
          </view>
          <picker 
            mode="selector" 
            range="{{ timeOptions }}"
            range-key="label"
            value="{{ endTimeIndex }}" 
            bindchange="onEndTimeChange"
          >
            <view class="time-picker-display">
              <text class="time-text">{{ endTimeDisplay }}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>

      <!-- é€‰ä¸­çš„æ—¶é—´æ˜¾ç¤º -->
      <view class="selected-time-display">
        <text class="display-icon">â±ï¸</text>
        <text class="display-text">{{ selectedTimeDisplay }}</text>
      </view>
    </view>
  </view>

  <!-- ä¿å­˜æŒ‰é’® -->
  <view class="save-section">
    <!-- ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºå–æ¶ˆæŒ‰é’® -->
    <button 
      wx:if="{{ isEditMode }}"
      class="btn btn-secondary cancel-btn"
      bindtap="cancelEdit"
    >
      <text>âŒ å–æ¶ˆç¼–è¾‘</text>
    </button>
    
    <button
      class="btn btn-primary save-btn {{ isEditMode ? 'edit-mode' : '' }}"
      bindtap="saveMemo"
      disabled="{{ !canSave || isSaving }}"
    >
      <text>{{ isSaving ? (isEditMode ? 'æ›´æ–°ä¸­...' : 'ä¿å­˜ä¸­...') : (isEditMode ? 'ğŸ’¾ æ›´æ–°è®°å½•' : 'ğŸ’¾ ä¿å­˜è®°å½•') }}</text>
    </button>
  </view>
</view>