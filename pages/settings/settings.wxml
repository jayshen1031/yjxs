<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="card user-card">
    <view class="card-content">
      <view class="user-info">
        <view class="avatar-section">
          <view wx:if="{{ currentUser.avatar }}" class="user-avatar">
            <image src="{{ currentUser.avatar }}" />
          </view>
          <view wx:else class="user-avatar default-avatar">
            <text>ğŸ‘¤</text>
          </view>
          <button class="avatar-edit-btn" bindtap="changeAvatar">
            <text>ğŸ“·</text>
          </button>
        </view>
        <view class="user-details">
          <view class="user-name">{{ currentUser.displayName || currentUser.name || 'æœªå‘½åç”¨æˆ·' }}</view>
          <view class="user-email">{{ currentUser.email }}</view>
          <view class="user-stats">
            <text class="stat-item">ğŸ“ {{ userStats.totalMemos }}æ¡è®°å½•</text>
            <text class="stat-item">ğŸ“‹ {{ userStats.planningMemos }}æ¡è§„åˆ’</text>
            <text class="stat-item">ğŸ—“ï¸ æ³¨å†Œ{{ userStats.daysSinceCreated }}å¤©</text>
          </view>
        </view>
      </view>
      <view class="user-actions">
        <button class="btn btn-secondary" bindtap="editProfile">ç¼–è¾‘èµ„æ–™</button>
        <button class="btn btn-logout" bindtap="logout">é€€å‡ºç™»å½•</button>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·åˆ‡æ¢ -->
  <view class="card" wx:if="{{ users.length > 1 }}">
    <view class="card-content">
      <view class="title">ğŸ‘¥ ç”¨æˆ·åˆ‡æ¢</view>
      <view class="user-list">
        <view 
          class="user-item {{ item.id === currentUser.id ? 'active' : '' }}"
          wx:for="{{ users }}" 
          wx:key="id"
          bindtap="switchUser"
          data-user-id="{{ item.id }}"
        >
          <view wx:if="{{ item.avatar }}" class="user-item-avatar">
            <image src="{{ item.avatar }}" />
          </view>
          <view wx:else class="user-item-avatar default-avatar">
            <text>ğŸ‘¤</text>
          </view>
          <view class="user-item-info">
            <view class="user-item-name">{{ item.displayName || item.name }}</view>
            <view class="user-item-email">{{ item.email }}</view>
            <view class="user-item-stats">{{ item.memoCount }}æ¡è®°å½•</view>
          </view>
          <view wx:if="{{ item.id === currentUser.id }}" class="current-indicator">
            <text>âœ“</text>
          </view>
        </view>
      </view>
      <button class="btn btn-primary" bindtap="addNewUser">+ æ·»åŠ æ–°ç”¨æˆ·</button>
    </view>
  </view>

  <!-- Notioné›†æˆ -->
  <view class="card">
    <view class="card-content">
      <view class="section-header">
        <view class="title">ğŸ”— Notioné›†æˆ</view>
        <view class="notion-status-indicator">
          <text class="status-text {{ notionConfigured ? 'connected' : 'disconnected' }}">
            {{ notionConfigured ? 'å·²é…ç½®' : 'æœªé…ç½®' }}
          </text>
        </view>
      </view>

      <!-- é…ç½®æ–¹å¼é€‰æ‹© -->
      <view class="config-mode-selector" wx:if="{{ !notionConfigured }}">
        <view class="mode-title">é…ç½®æ–¹å¼</view>
        <radio-group bindchange="onConfigModeChange" class="radio-group">
          <label class="radio-item">
            <radio value="auto" checked="{{ configMode === 'auto' }}" color="#6366f1"/>
            <text>ğŸš€ è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ï¼ˆæ¨èï¼‰</text>
          </label>
          <label class="radio-item">
            <radio value="manual" checked="{{ configMode === 'manual' }}" color="#6366f1"/>
            <text>âš™ï¸ ä½¿ç”¨å·²æœ‰æ•°æ®åº“</text>
          </label>
        </radio-group>
      </view>

      <!-- è‡ªåŠ¨åˆ›å»ºæ¨¡å¼ -->
      <view class="auto-create-section" wx:if="{{ configMode === 'auto' && !notionConfigured }}">
        <view class="input-group">
          <view class="input-label">Notion API Key</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥API Key"
            value="{{ notionConfig.apiKey }}"
            bindinput="onNotionApiKeyInput"
          />
        </view>
        <view class="input-group">
          <view class="input-label">çˆ¶é¡µé¢ID</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥Notionçˆ¶é¡µé¢ID"
            value="{{ notionConfig.parentPageId }}"
            bindinput="onParentPageIdInput"
          />
          <view class="input-hint">ğŸ’¡ åœ¨Notionä¸­åˆ›å»ºä¸€ä¸ªé¡µé¢ï¼Œä»URLä¸­å¤åˆ¶é¡µé¢ID</view>
        </view>
        <button
          class="btn btn-primary btn-create"
          bindtap="autoCreateDatabases"
          loading="{{ creating }}"
          disabled="{{ creating || !notionConfig.apiKey || !notionConfig.parentPageId }}"
        >
          <text>{{ creating ? 'åˆ›å»ºä¸­...' : 'ğŸš€ è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“' }}</text>
        </button>
        <button
          class="btn btn-secondary btn-diagnose"
          bindtap="diagnoseDatabases"
          loading="{{ diagnosing }}"
          disabled="{{ diagnosing || !notionConfig.apiKey }}"
        >
          <text>{{ diagnosing ? 'è¯Šæ–­ä¸­...' : 'ğŸ” è¯Šæ–­æ•°æ®åº“å­—æ®µ' }}</text>
        </button>
      </view>

      <!-- æ‰‹åŠ¨é…ç½®æ¨¡å¼ -->
      <view class="manual-config-section" wx:if="{{ configMode === 'manual' && !notionConfigured }}">
        <view class="input-group">
          <view class="input-label">Notion API Key</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥API Key"
            value="{{ notionConfig.apiKey }}"
            bindinput="onNotionApiKeyInput"
          />
        </view>

        <view class="section-title">ğŸ¯ å…«æ•°æ®åº“é…ç½®ï¼ˆæ¨èï¼‰</view>

        <view class="input-group">
          <view class="input-label">ğŸ¯ ç›®æ ‡åº“ID (Goals)</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥ç›®æ ‡åº“æ•°æ®åº“ID"
            value="{{ notionConfig.goalsDatabaseId }}"
            bindinput="onGoalsDatabaseIdInput"
          />
        </view>

        <view class="input-group">
          <view class="input-label">âœ… å¾…åŠåº“ID (Todos)</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥å¾…åŠåº“æ•°æ®åº“ID"
            value="{{ notionConfig.todosDatabaseId }}"
            bindinput="onTodosDatabaseIdInput"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ ä¸»è®°å½•è¡¨ID (Main Records)</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥ä¸»è®°å½•è¡¨æ•°æ®åº“ID"
            value="{{ notionConfig.mainDatabaseId }}"
            bindinput="onMainDatabaseIdInput"
          />
        </view>

        <view class="input-group">
          <view class="input-label">â±ï¸ æ´»åŠ¨æ˜ç»†è¡¨ID (Activities)</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥æ´»åŠ¨æ˜ç»†è¡¨æ•°æ®åº“ID"
            value="{{ notionConfig.activityDatabaseId }}"
            bindinput="onActivityDatabaseIdInput"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“Š æ¯æ—¥çŠ¶æ€åº“ID (Daily Status) <text class="required-mark">*å¿…å¡«</text></view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥æ¯æ—¥çŠ¶æ€åº“æ•°æ®åº“ID"
            value="{{ notionConfig.dailyStatusDatabaseId }}"
            bindinput="onDailyStatusDatabaseIdInput"
          />
          <view class="input-hint">ğŸ’¡ å¦‚æœè¦ä½¿ç”¨æ¯æ—¥çŠ¶æ€åŠŸèƒ½ï¼Œæ­¤é¡¹å¿…å¡«</view>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ˜Š å¼€å¿ƒåº“ID (Happy Things) <text class="required-mark">*å¿…å¡«</text></view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥å¼€å¿ƒåº“æ•°æ®åº“ID"
            value="{{ notionConfig.happyThingsDatabaseId }}"
            bindinput="onHappyThingsDatabaseIdInput"
          />
          <view class="input-hint">ğŸ’¡ å¦‚æœè¦ä½¿ç”¨å¼€å¿ƒäº‹ç®¡ç†åŠŸèƒ½ï¼Œæ­¤é¡¹å¿…å¡«</view>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ’¬ ç®´è¨€åº“ID (Quotes) <text class="required-mark">*å¿…å¡«</text></view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥ç®´è¨€åº“æ•°æ®åº“ID"
            value="{{ notionConfig.databases.quotes }}"
            bindinput="onQuotesDatabaseIdInput"
          />
          <view class="input-hint">ğŸ’¡ å¦‚æœè¦ä½¿ç”¨æ¯æ—¥ç®´è¨€åŠŸèƒ½ï¼Œæ­¤é¡¹å¿…å¡«</view>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“š çŸ¥è¯†åº“ID (Knowledge) <text class="required-mark">*å¿…å¡«</text></view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥çŸ¥è¯†åº“æ•°æ®åº“ID"
            value="{{ notionConfig.databases.knowledge }}"
            bindinput="onKnowledgeDatabaseIdInput"
          />
          <view class="input-hint">ğŸ’¡ å¦‚æœè¦ä½¿ç”¨çŸ¥è¯†åº“åŠŸèƒ½ï¼Œæ­¤é¡¹å¿…å¡«</view>
        </view>

        <button class="btn btn-primary" bindtap="saveManualConfig">
          <text>ğŸ’¾ ä¿å­˜é…ç½®</text>
        </button>
      </view>

      <!-- å·²é…ç½®çŠ¶æ€æ˜¾ç¤º -->
      <view class="notion-info" wx:if="{{ notionConfigured }}">
        <view class="info-row">
          <text class="info-label">åŒæ­¥çŠ¶æ€:</text>
          <text class="info-value {{ notionConfig.enabled ? 'enabled' : 'disabled' }}">
            {{ notionConfig.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨' }}
          </text>
        </view>
        <view class="info-row" wx:if="{{ notionConfig.initialized !== undefined }}">
          <text class="info-label">æ•°æ®åº“åˆå§‹åŒ–:</text>
          <text class="info-value {{ notionConfig.initialized ? 'enabled' : 'disabled' }}">
            {{ notionConfig.initialized ? 'âœ… å·²å®Œæˆ' : 'âš ï¸ æœªå®Œæˆ' }}
          </text>
        </view>
        <view class="info-row" wx:if="{{ notionConfig.initialized && notionConfig.initializedFields && notionConfig.initializedFields.length > 0 }}">
          <text class="info-label">åˆå§‹åŒ–å­—æ®µ:</text>
          <text class="info-value">{{ notionConfig.initializedFields.length }}ä¸ª</text>
        </view>
        <view class="info-row" wx:if="{{ notionConfig.enabled && lastSyncTime }}">
          <text class="info-label">ä¸Šæ¬¡åŒæ­¥:</text>
          <text class="info-value">{{ lastSyncTime }}</text>
        </view>
        <view class="info-row" wx:if="{{ notionConfig.enabled }}">
          <text class="info-label">å¾…åŒæ­¥:</text>
          <text class="info-value">{{ pendingMemos }}æ¡è®°å½•</text>
        </view>
      </view>

      <view class="notion-actions" wx:if="{{ notionConfigured }}">
        <button class="btn btn-primary" bindtap="configureNotion">
          <text>{{ notionConfigured ? 'âš™ï¸ é‡æ–°é…ç½®' : 'ğŸ”— é…ç½®Notion' }}</text>
        </button>
        <button class="btn btn-secondary" bindtap="diagnoseDatabases"
                wx:if="{{ notionConfig.enabled }}"
                loading="{{ diagnosing }}">
          <text>{{ diagnosing ? 'è¯Šæ–­ä¸­...' : 'ğŸ” è¯Šæ–­æ•°æ®åº“' }}</text>
        </button>
        <button class="btn btn-warning" bindtap="fixMainRecords"
                wx:if="{{ notionConfig.enabled }}">
          <text>ğŸ”§ ä¿®å¤ä¸»è®°å½•è¡¨</text>
        </button>
      </view>
    </view>
  </view>

  <!-- HUMAN3.0å‘å±•è¯„ä¼° -->
  <view class="card">
    <view class="card-content">
      <view class="section-header">
        <view class="title">ğŸ§  HUMAN3.0å‘å±•è¯„ä¼°</view>
        <view wx:if="{{ latestAssessment }}" class="assessment-badge">
          <text class="badge-text">å·²æµ‹{{ assessmentHistory.length }}æ¬¡</text>
        </view>
      </view>

      <!-- æœ€æ–°è¯„ä¼°æ‘˜è¦ -->
      <view wx:if="{{ latestAssessment }}" class="latest-assessment-summary">
        <view class="summary-header">
          <text class="summary-title">ğŸ“Š æœ€è¿‘è¯„ä¼°</text>
          <text class="summary-date">{{ latestAssessment.dateStr }}</text>
        </view>
        <view class="summary-score">
          <view class="score-item">
            <text class="score-label">æ€»åˆ†</text>
            <text class="score-value">{{ latestAssessment.totalScore }}</text>
          </view>
          <view class="score-item">
            <text class="score-label">ç»´åº¦</text>
            <text class="score-value">{{ latestAssessment.dimensionCount }}ä¸ª</text>
          </view>
          <view class="score-item">
            <text class="score-label">ç­‰çº§</text>
            <text class="score-value level-{{ latestAssessment.level }}">{{ latestAssessment.levelText }}</text>
          </view>
        </view>
      </view>

      <!-- æ— è¯„ä¼°æç¤º -->
      <view wx:else class="no-assessment-hint">
        <text class="hint-icon">ğŸŒŸ</text>
        <text class="hint-text">è¿˜æ²¡æœ‰è¿›è¡Œè¿‡è¯„ä¼°ï¼Œå¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡HUMAN3.0å‘å±•è¯„ä¼°å§ï¼</text>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="assessment-actions">
        <button class="btn btn-primary" bindtap="startAssessment">
          <text>{{ latestAssessment ? 'ğŸ”„ é‡æ–°è¯„ä¼°' : 'ğŸš€ å¼€å§‹è¯„ä¼°' }}</text>
        </button>
        <button
          wx:if="{{ assessmentHistory.length > 0 }}"
          class="btn btn-secondary"
          bindtap="viewAssessmentHistory"
        >
          <text>ğŸ“ˆ æŸ¥çœ‹å†å² ({{ assessmentHistory.length }})</text>
        </button>
      </view>
    </view>
  </view>

  <!-- ç®´è¨€è®¾ç½® -->
  <view class="card">
    <view class="card-content">
      <view class="title">ğŸ’« ç®´è¨€è®¾ç½®</view>

      <view class="setting-item">
        <view class="setting-info">
          <view class="setting-name">åªæ˜¾ç¤ºæˆ‘çš„ç®´è¨€</view>
          <view class="setting-desc">é¦–é¡µç®´è¨€åªä»æˆ‘æ·»åŠ çš„ç®´è¨€ä¸­éšæœºæ˜¾ç¤º</view>
        </view>
        <switch
          checked="{{ quoteSettings.onlyMyQuotes }}"
          bindchange="toggleOnlyMyQuotes"
          color="#6366f1"
        />
      </view>
    </view>
  </view>

  <!-- å…³äº -->
  <view class="card">
    <view class="card-content">
      <view class="title">â„¹ï¸ å…³äº</view>
      <view class="about-info">
        <view class="about-item">
          <text class="about-label">ç‰ˆæœ¬å·:</text>
          <text class="about-value">v1.0.0</text>
        </view>
        <view class="about-item">
          <text class="about-label">å¼€å‘è€…:</text>
          <text class="about-value">Claude Code</text>
        </view>
        <view class="about-item">
          <text class="about-label">æ›´æ–°æ—¶é—´:</text>
          <text class="about-value">2025å¹´1æœˆ</text>
        </view>
      </view>
    </view>
  </view>
</view>