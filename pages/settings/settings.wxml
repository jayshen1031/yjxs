<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="card user-card">
    <view class="card-content">
      <view class="user-info">
        <view class="avatar-section">
          <view wx:if="{{ currentUser.avatar }}" class="user-avatar">
            <image src="{{ currentUser.avatar }}" />
          </view>
          <view wx:else class="user-avatar default-avatar">
            <text>ğŸ‘¤</text>
          </view>
          <button class="avatar-edit-btn" bindtap="changeAvatar">
            <text>ğŸ“·</text>
          </button>
        </view>
        <view class="user-details">
          <view class="user-name">{{ currentUser.displayName || currentUser.name || 'æœªå‘½åç”¨æˆ·' }}</view>
          <view class="user-email">{{ currentUser.email }}</view>
          <view class="user-stats">
            <text class="stat-item">ğŸ“ {{ userStats.totalMemos }}æ¡è®°å½•</text>
            <text class="stat-item">ğŸ“‹ {{ userStats.planningMemos }}æ¡è§„åˆ’</text>
            <text class="stat-item">ğŸ—“ï¸ æ³¨å†Œ{{ userStats.daysSinceCreated }}å¤©</text>
          </view>
        </view>
      </view>
      <view class="user-actions">
        <button class="btn btn-secondary" bindtap="editProfile">ç¼–è¾‘èµ„æ–™</button>
        <button class="btn btn-logout" bindtap="logout">é€€å‡ºç™»å½•</button>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·åˆ‡æ¢ -->
  <view class="card" wx:if="{{ users.length > 1 }}">
    <view class="card-content">
      <view class="title">ğŸ‘¥ ç”¨æˆ·åˆ‡æ¢</view>
      <view class="user-list">
        <view 
          class="user-item {{ item.id === currentUser.id ? 'active' : '' }}"
          wx:for="{{ users }}" 
          wx:key="id"
          bindtap="switchUser"
          data-user-id="{{ item.id }}"
        >
          <view wx:if="{{ item.avatar }}" class="user-item-avatar">
            <image src="{{ item.avatar }}" />
          </view>
          <view wx:else class="user-item-avatar default-avatar">
            <text>ğŸ‘¤</text>
          </view>
          <view class="user-item-info">
            <view class="user-item-name">{{ item.displayName || item.name }}</view>
            <view class="user-item-email">{{ item.email }}</view>
            <view class="user-item-stats">{{ item.memoCount }}æ¡è®°å½•</view>
          </view>
          <view wx:if="{{ item.id === currentUser.id }}" class="current-indicator">
            <text>âœ“</text>
          </view>
        </view>
      </view>
      <button class="btn btn-primary" bindtap="addNewUser">+ æ·»åŠ æ–°ç”¨æˆ·</button>
    </view>
  </view>

  <!-- Notioné›†æˆ -->
  <view class="card">
    <view class="card-content">
      <view class="section-header">
        <view class="title">ğŸ”— Notioné›†æˆ</view>
        <view class="notion-status-indicator">
          <text class="status-text {{ notionConfigured ? 'connected' : 'disconnected' }}">
            {{ notionConfigured ? 'å·²é…ç½®' : 'æœªé…ç½®' }}
          </text>
        </view>
      </view>

      <!-- é…ç½®æ–¹å¼é€‰æ‹© -->
      <view class="config-mode-selector" wx:if="{{ !notionConfigured }}">
        <view class="mode-title">é…ç½®æ–¹å¼</view>
        <radio-group bindchange="onConfigModeChange" class="radio-group">
          <label class="radio-item">
            <radio value="auto" checked="{{ configMode === 'auto' }}" color="#6366f1"/>
            <text>ğŸš€ è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ï¼ˆæ¨èï¼‰</text>
          </label>
          <label class="radio-item">
            <radio value="manual" checked="{{ configMode === 'manual' }}" color="#6366f1"/>
            <text>âš™ï¸ ä½¿ç”¨å·²æœ‰æ•°æ®åº“</text>
          </label>
        </radio-group>
      </view>

      <!-- è‡ªåŠ¨åˆ›å»ºæ¨¡å¼ -->
      <view class="auto-create-section" wx:if="{{ configMode === 'auto' && !notionConfigured }}">
        <view class="input-group">
          <view class="input-label">Notion API Key</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥API Key"
            value="{{ notionConfig.apiKey }}"
            bindinput="onNotionApiKeyInput"
          />
        </view>
        <view class="input-group">
          <view class="input-label">çˆ¶é¡µé¢ID</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥Notionçˆ¶é¡µé¢ID"
            value="{{ notionConfig.parentPageId }}"
            bindinput="onParentPageIdInput"
          />
          <view class="input-hint">ğŸ’¡ åœ¨Notionä¸­åˆ›å»ºä¸€ä¸ªé¡µé¢ï¼Œä»URLä¸­å¤åˆ¶é¡µé¢ID</view>
        </view>
        <button
          class="btn btn-primary btn-create"
          bindtap="autoCreateDatabases"
          loading="{{ creating }}"
          disabled="{{ creating || !notionConfig.apiKey || !notionConfig.parentPageId }}"
        >
          <text>{{ creating ? 'åˆ›å»ºä¸­...' : 'ğŸš€ è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“' }}</text>
        </button>
      </view>

      <!-- æ‰‹åŠ¨é…ç½®æ¨¡å¼ -->
      <view class="manual-config-section" wx:if="{{ configMode === 'manual' && !notionConfigured }}">
        <view class="input-group">
          <view class="input-label">Notion API Key</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥API Key"
            value="{{ notionConfig.apiKey }}"
            bindinput="onNotionApiKeyInput"
          />
        </view>

        <view class="section-title">ğŸ¯ å…­æ•°æ®åº“é…ç½®ï¼ˆæ¨èï¼‰</view>

        <view class="input-group">
          <view class="input-label">ğŸ¯ ç›®æ ‡åº“ID (Goals)</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥ç›®æ ‡åº“æ•°æ®åº“ID"
            value="{{ notionConfig.goalsDatabaseId }}"
            bindinput="onGoalsDatabaseIdInput"
          />
        </view>

        <view class="input-group">
          <view class="input-label">âœ… å¾…åŠåº“ID (Todos)</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥å¾…åŠåº“æ•°æ®åº“ID"
            value="{{ notionConfig.todosDatabaseId }}"
            bindinput="onTodosDatabaseIdInput"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ ä¸»è®°å½•è¡¨ID (Main Records)</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥ä¸»è®°å½•è¡¨æ•°æ®åº“ID"
            value="{{ notionConfig.mainDatabaseId }}"
            bindinput="onMainDatabaseIdInput"
          />
        </view>

        <view class="input-group">
          <view class="input-label">â±ï¸ æ´»åŠ¨æ˜ç»†è¡¨ID (Activities)</view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥æ´»åŠ¨æ˜ç»†è¡¨æ•°æ®åº“ID"
            value="{{ notionConfig.activityDatabaseId }}"
            bindinput="onActivityDatabaseIdInput"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“Š æ¯æ—¥çŠ¶æ€åº“ID (Daily Status) <text class="required-mark">*å¿…å¡«</text></view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥æ¯æ—¥çŠ¶æ€åº“æ•°æ®åº“ID"
            value="{{ notionConfig.dailyStatusDatabaseId }}"
            bindinput="onDailyStatusDatabaseIdInput"
          />
          <view class="input-hint">ğŸ’¡ å¦‚æœè¦ä½¿ç”¨æ¯æ—¥çŠ¶æ€åŠŸèƒ½ï¼Œæ­¤é¡¹å¿…å¡«</view>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ˜Š å¼€å¿ƒåº“ID (Happy Things) <text class="required-mark">*å¿…å¡«</text></view>
          <input
            class="notion-input"
            placeholder="è¯·è¾“å…¥å¼€å¿ƒåº“æ•°æ®åº“ID"
            value="{{ notionConfig.happyThingsDatabaseId }}"
            bindinput="onHappyThingsDatabaseIdInput"
          />
          <view class="input-hint">ğŸ’¡ å¦‚æœè¦ä½¿ç”¨å¼€å¿ƒäº‹ç®¡ç†åŠŸèƒ½ï¼Œæ­¤é¡¹å¿…å¡«</view>
        </view>

        <button class="btn btn-primary" bindtap="saveManualConfig">
          <text>ğŸ’¾ ä¿å­˜é…ç½®</text>
        </button>
      </view>

      <!-- å·²é…ç½®çŠ¶æ€æ˜¾ç¤º -->
      <view class="notion-info" wx:if="{{ notionConfigured }}">
        <view class="info-row">
          <text class="info-label">åŒæ­¥çŠ¶æ€:</text>
          <text class="info-value {{ notionConfig.enabled ? 'enabled' : 'disabled' }}">
            {{ notionConfig.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨' }}
          </text>
        </view>
        <view class="info-row" wx:if="{{ notionConfig.initialized !== undefined }}">
          <text class="info-label">æ•°æ®åº“åˆå§‹åŒ–:</text>
          <text class="info-value {{ notionConfig.initialized ? 'enabled' : 'disabled' }}">
            {{ notionConfig.initialized ? 'âœ… å·²å®Œæˆ' : 'âš ï¸ æœªå®Œæˆ' }}
          </text>
        </view>
        <view class="info-row" wx:if="{{ notionConfig.initialized && notionConfig.initializedFields && notionConfig.initializedFields.length > 0 }}">
          <text class="info-label">åˆå§‹åŒ–å­—æ®µ:</text>
          <text class="info-value">{{ notionConfig.initializedFields.length }}ä¸ª</text>
        </view>
        <view class="info-row" wx:if="{{ notionConfig.enabled && lastSyncTime }}">
          <text class="info-label">ä¸Šæ¬¡åŒæ­¥:</text>
          <text class="info-value">{{ lastSyncTime }}</text>
        </view>
        <view class="info-row" wx:if="{{ notionConfig.enabled }}">
          <text class="info-label">å¾…åŒæ­¥:</text>
          <text class="info-value">{{ pendingMemos }}æ¡è®°å½•</text>
        </view>
      </view>

      <view class="notion-actions" wx:if="{{ notionConfigured }}">
        <button class="btn btn-primary" bindtap="configureNotion">
          <text>{{ notionConfigured ? 'âš™ï¸ é‡æ–°é…ç½®' : 'ğŸ”— é…ç½®Notion' }}</text>
        </button>
        <button class="btn btn-secondary" bindtap="diagnoseDatabases"
                wx:if="{{ notionConfig.enabled }}"
                loading="{{ diagnosing }}">
          <text>{{ diagnosing ? 'è¯Šæ–­ä¸­...' : 'ğŸ” è¯Šæ–­æ•°æ®åº“' }}</text>
        </button>
      </view>
    </view>
  </view>

  <!-- åå¥½è®¾ç½® -->
  <view class="card">
    <view class="card-content">
      <view class="title">âš™ï¸ åå¥½è®¾ç½®</view>
      
      <view class="setting-item">
        <view class="setting-info">
          <view class="setting-name">è‡ªåŠ¨åŒæ­¥</view>
          <view class="setting-desc">ä¿å­˜è®°å½•æ—¶è‡ªåŠ¨åŒæ­¥åˆ°Notion</view>
        </view>
        <switch 
          checked="{{ preferences.autoSync }}" 
          bindchange="toggleAutoSync" 
          color="#6366f1"
          disabled="{{ !notionConfig.enabled }}"
        />
      </view>
      
      <view class="setting-item">
        <view class="setting-info">
          <view class="setting-name">æé†’é€šçŸ¥</view>
          <view class="setting-desc">å¼€å¯å®šæ—¶è®°å½•æé†’</view>
        </view>
        <switch 
          checked="{{ preferences.reminderEnabled }}" 
          bindchange="toggleReminder" 
          color="#6366f1"
        />
      </view>
      
      <view class="setting-item">
        <view class="setting-info">
          <view class="setting-name">æé†’é—´éš”</view>
          <view class="setting-desc">{{ preferences.reminderInterval }}åˆ†é’Ÿ</view>
        </view>
        <slider 
          value="{{ preferences.reminderInterval }}" 
          min="30" 
          max="480" 
          step="30"
          bindchange="onReminderIntervalChange"
          activeColor="#6366f1"
          backgroundColor="#e5e7eb"
          disabled="{{ !preferences.reminderEnabled }}"
        />
      </view>
    </view>
  </view>

  <!-- ç®´è¨€åŠ›é‡åº“ -->
  <view class="card">
    <view class="card-content">
      <view class="title">ğŸ’« ç®´è¨€åŠ›é‡åº“</view>
      
      <view class="quote-summary">
        <view class="quote-stats">
          <view class="stat-item">
            <text class="stat-number">{{ quoteStats.total }}</text>
            <text class="stat-label">æ€»ç®´è¨€</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{ quoteStats.favorites }}</text>
            <text class="stat-label">å·²æ”¶è—</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{ quoteStats.user }}</text>
            <text class="stat-label">è‡ªå®šä¹‰</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{ quoteStats.categories }}</text>
            <text class="stat-label">åˆ†ç±»</text>
          </view>
        </view>
        
        <view class="current-quote-preview" wx:if="{{ currentQuotePreview }}">
          <view class="quote-text">{{ currentQuotePreview.content }}</view>
          <view class="quote-category">{{ currentQuotePreview.category }}</view>
        </view>
      </view>
      
      <view class="quote-actions">
        <button class="btn btn-primary" bindtap="goToQuoteManager">
          <text>âš™ï¸ ç®¡ç†ç®´è¨€åº“</text>
        </button>
        <button class="btn btn-secondary" bindtap="refreshQuote">
          <text>ğŸ² éšæœºç®´è¨€</text>
        </button>
      </view>
    </view>
  </view>

  <!-- æ•°æ®ç®¡ç† -->
  <view class="card">
    <view class="card-content">
      <view class="title">ğŸ“Š æ•°æ®ç®¡ç†</view>
      
      <view class="data-actions">
        <button class="btn btn-secondary" bindtap="exportData">
          <text>ğŸ“¤ å¯¼å‡ºæ•°æ®</text>
        </button>
        <button class="btn btn-secondary" bindtap="importData">
          <text>ğŸ“¥ å¯¼å…¥æ•°æ®</text>
        </button>
      </view>
      
      <view class="danger-zone">
        <view class="danger-title">âš ï¸ å±é™©æ“ä½œ</view>
        <button class="btn btn-danger" bindtap="clearAllData">
          <text>ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®</text>
        </button>
        <button class="btn btn-danger" bindtap="deleteCurrentUser">
          <text>ğŸ‘¤ åˆ é™¤å½“å‰ç”¨æˆ·</text>
        </button>
      </view>
    </view>
  </view>

  <!-- å…³äº -->
  <view class="card">
    <view class="card-content">
      <view class="title">â„¹ï¸ å…³äº</view>
      <view class="about-info">
        <view class="about-item">
          <text class="about-label">ç‰ˆæœ¬å·:</text>
          <text class="about-value">v1.0.0</text>
        </view>
        <view class="about-item">
          <text class="about-label">å¼€å‘è€…:</text>
          <text class="about-value">Claude Code</text>
        </view>
        <view class="about-item">
          <text class="about-label">æ›´æ–°æ—¶é—´:</text>
          <text class="about-value">2025å¹´1æœˆ</text>
        </view>
      </view>
    </view>
  </view>
</view>