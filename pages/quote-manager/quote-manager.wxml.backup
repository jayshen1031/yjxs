<wxs module="utils">
function getCategoryClass(category) {
  var categoryMap = {
    'åŠ±å¿—': 'inspire',
    'ç”Ÿæ´»': 'life', 
    'æˆé•¿': 'growth',
    'å“²ç†': 'philosophy',
    'è®°å½•': 'record',
    'æ—¶é—´': 'time',
    'è‡ªä¿¡': 'confidence',
    'å¿ƒç†': 'psychology',
    'å†³ç­–': 'decision',
    'è‡ªå®šä¹‰': 'custom'
  }
  return categoryMap[category] || 'custom'
}

module.exports = {
  getCategoryClass: getCategoryClass
}
</wxs>

<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œåŒº -->
  <view class="header-section">
    <view class="stats-card">
      <view class="stats-row">
        <view class="stat-item">
          <view class="stat-number">{{totalQuotes}}</view>
          <view class="stat-label">æ€»ç®´è¨€</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{favoriteQuotes}}</view>
          <view class="stat-label">å·²æ”¶è—</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{userQuotes}}</view>
          <view class="stat-label">è‡ªå®šä¹‰</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{categoriesCount}}</view>
          <view class="stat-label">åˆ†ç±»</view>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿæ“ä½œ -->
    <view class="quick-actions">
      <button class="action-btn primary" bindtap="addQuote">
        <text class="icon">âœï¸</text>
        <text>æ·»åŠ ç®´è¨€</text>
      </button>
      <button class="action-btn secondary" bindtap="refreshCurrentQuote">
        <text class="icon">ğŸ²</text>
        <text>éšæœºåˆ·æ–°</text>
      </button>
      <button class="action-btn secondary" bindtap="showSettings">
        <text class="icon">âš™ï¸</text>
        <text>è®¾ç½®</text>
      </button>
    </view>
  </view>

  <!-- å½“å‰æ˜¾ç¤ºçš„ç®´è¨€ -->
  <view class="current-quote-section">
    <view class="section-title">
      <text class="icon">ğŸ’«</text>
      <text>å½“å‰ç®´è¨€</text>
    </view>
    <view class="current-quote-card">
      <view class="quote-content">{{currentQuote.content}}</view>
      <view class="quote-meta">
        <view class="category-tag category-{{utils.getCategoryClass(currentQuote.category)}}">{{currentQuote.category}}</view>
        <view class="usage-count">å·²æ¿€åŠ± {{currentQuote.usageCount}} æ¬¡</view>
        <view class="favorite-btn" bindtap="toggleCurrentFavorite">
          <text class="heart {{currentQuote.isFavorite ? 'favorite' : ''}}">â¤ï¸</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæœç´¢ -->
  <view class="filter-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢ç®´è¨€å†…å®¹æˆ–æ ‡ç­¾..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-icon">ğŸ”</text>
    </view>
    
    <scroll-view class="category-filter" scroll-x="true">
      <view class="filter-item {{selectedCategory === '' ? 'active' : ''}}" bindtap="filterByCategory" data-category="">
        å…¨éƒ¨ ({{totalQuotes}})
      </view>
      <view 
        class="filter-item-wrapper" 
        wx:for="{{categories}}" 
        wx:key="category"
        wx:for-item="category"
        wx:for-index="index"
      >
        <view 
          class="filter-item {{selectedCategory === category ? 'active' : ''}}"
          bindtap="filterByCategory" 
          data-category="{{category}}"
        >
          {{category}} ({{categoriesData[category]}})
        </view>
        <view 
          class="filter-action" 
          bindtap="getRandomQuoteFromCategory"
          data-category="{{category}}"
        >
          âš¡
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ç®´è¨€åˆ—è¡¨ -->
  <view class="quotes-section">
    <view class="section-header">
      <view class="section-title">
        <text class="icon">ğŸ“š</text>
        <text>ç®´è¨€åº“ ({{filteredQuotes.length}})</text>
      </view>
      <view class="sort-options">
        <picker bindchange="onSortChange" value="{{sortIndex}}" range="{{sortOptions}}" range-key="label">
          <view class="sort-btn">
            <text>{{sortOptions[sortIndex].label}}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <scroll-view class="quotes-list" scroll-y="true">
      <view 
        class="quote-item {{quote.isFavorite ? 'favorite' : ''}}" 
        wx:for="{{filteredQuotes}}" 
        wx:key="id"
        wx:for-item="quote"
      >
        <view class="quote-content-wrapper">
          <view class="quote-text">{{quote.content}}</view>
          <view class="quote-tags" wx:if="{{quote.tags.length > 0}}">
            <text class="tag" wx:for="{{quote.tags}}" wx:key="*this">{{item}}</text>
          </view>
        </view>
        
        <view class="quote-meta-row">
          <view class="quote-info">
            <view class="category-tag category-{{utils.getCategoryClass(quote.category)}}">{{quote.category}}</view>
            <view class="source-info">{{quote.source}}</view>
            <view class="usage-info">ä½¿ç”¨ {{quote.usageCount}} æ¬¡</view>
          </view>
          
          <view class="quote-actions">
            <view class="action-icon" bindtap="toggleFavorite" data-id="{{quote.id}}">
              <text class="heart {{quote.isFavorite ? 'favorite' : ''}}">â¤ï¸</text>
            </view>
            <view class="action-icon" bindtap="editQuote" data-id="{{quote.id}}" wx:if="{{quote.source === 'ç”¨æˆ·æ·»åŠ '}}">
              <text>âœï¸</text>
            </view>
            <view class="action-icon" bindtap="deleteQuote" data-id="{{quote.id}}" wx:if="{{quote.source === 'ç”¨æˆ·æ·»åŠ '}}">
              <text>ğŸ—‘ï¸</text>
            </view>
            <view class="action-icon" bindtap="useThisQuote" data-id="{{quote.id}}">
              <text>âš¡</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredQuotes.length === 0}}">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æš‚æ— ç¬¦åˆæ¡ä»¶çš„ç®´è¨€</text>
        <button class="empty-action" bindtap="addQuote">æ·»åŠ æ–°ç®´è¨€</button>
      </view>
    </scroll-view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘ç®´è¨€å¼¹çª— -->
  <view class="modal {{showAddModal ? 'show' : ''}}" wx:if="{{showAddModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{editingQuote ? 'ç¼–è¾‘ç®´è¨€' : 'æ·»åŠ ç®´è¨€'}}</text>
        <text class="close-btn" bindtap="closeAddModal">âœ•</text>
      </view>
      
      <view class="form-group">
        <label class="form-label">ç®´è¨€å†…å®¹ *</label>
        <textarea
          class="form-textarea"
          placeholder="è¾“å…¥æ¿€åŠ±äººå¿ƒçš„ç®´è¨€..."
          placeholder-class="input-placeholder"
          value="{{formData.content}}"
          bindinput="onContentInput"
          maxlength="200"
          show-confirm-bar="false"
          auto-height="{{true}}"
        ></textarea>
        <view class="char-count">{{formData.content.length}}/200</view>
      </view>

      <view class="form-group">
        <label class="form-label">åˆ†ç±»</label>
        <picker bindchange="onCategoryChange" value="{{categoryIndex}}" range="{{categoryOptions}}">
          <view class="picker-input">
            <text>{{formData.category}}</text>
            <text class="arrow">â–¼</text>
          </view>
        </picker>
      </view>

      <view class="form-group">
        <label class="form-label">æ ‡ç­¾ (ç”¨ç©ºæ ¼åˆ†éš”)</label>
        <input
          class="form-input"
          placeholder="åŠ±å¿— æˆé•¿ åšæŒ"
          placeholder-class="input-placeholder"
          value="{{tagsInput}}"
          bindinput="onTagsInput"
        />
      </view>

      <view class="form-group">
        <label class="form-label">æ¥æº</label>
        <input
          class="form-input"
          placeholder="æŸæŸä¹¦ç±ã€æŸæŸåäºº"
          placeholder-class="input-placeholder"
          value="{{formData.source}}"
          bindinput="onSourceInput"
        />
      </view>
      
      <view class="form-actions">
        <button class="btn-cancel" bindtap="closeAddModal">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmAddQuote" disabled="{{!formData.content}}">
          {{editingQuote ? 'ä¿å­˜' : 'æ·»åŠ '}}
        </button>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®å¼¹çª— -->
  <view class="modal {{showSettingsModal ? 'show' : ''}}" wx:if="{{showSettingsModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ç®´è¨€è®¾ç½®</text>
        <text class="close-btn" bindtap="closeSettingsModal">âœ•</text>
      </view>
      
      <view class="settings-group">
        <view class="setting-item">
          <text class="setting-label">åªæ˜¾ç¤ºæ”¶è—çš„ç®´è¨€</text>
          <switch 
            checked="{{settings.showFavoriteOnly}}" 
            bindchange="onShowFavoriteOnlyChange"
            color="#6366f1"
          />
        </view>
        
        <view class="setting-item">
          <text class="setting-label">è‡ªåŠ¨åˆ·æ–°ç®´è¨€</text>
          <switch 
            checked="{{settings.autoRefresh}}" 
            bindchange="onAutoRefreshChange"
            color="#6366f1"
          />
        </view>
        
        <view class="setting-item">
          <text class="setting-label">åˆ·æ–°é—´éš”</text>
          <picker bindchange="onRefreshIntervalChange" value="{{refreshIntervalIndex}}" range="{{refreshIntervalOptions}}" range-key="label">
            <view class="picker-input">
              <text>{{refreshIntervalOptions[refreshIntervalIndex].label}}</text>
              <text class="arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>
      
      <view class="settings-group">
        <view class="setting-title">å¯ç”¨çš„åˆ†ç±»</view>
        <view class="category-checkboxes">
          <view 
            class="checkbox-item" 
            wx:for="{{allCategories}}" 
            wx:key="*this"
            bindtap="toggleCategoryEnabled"
            data-category="{{item}}"
          >
            <text class="checkbox {{settings.categories.includes(item) ? 'checked' : ''}}">
              {{settings.categories.includes(item) ? 'âœ“' : 'â—‹'}}
            </text>
            <text class="checkbox-label">{{item}}</text>
          </view>
        </view>
      </view>
      
      <view class="form-actions">
        <button class="btn-confirm full-width" bindtap="saveSettings">ä¿å­˜è®¾ç½®</button>
      </view>
    </view>
  </view>
</view>