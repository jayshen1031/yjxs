<view class="container">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-row">
      <view class="stat-item">
        <view class="stat-value">{{ totalCount }}</view>
        <view class="stat-label">æ€»æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{ systemDefaultCount }}</view>
        <view class="stat-label">ğŸŒŸ ç³»ç»Ÿ</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{ userCustomCount }}</view>
        <view class="stat-label">âœ¨ è‡ªå®šä¹‰</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{ notionCount }}</view>
        <view class="stat-label">â˜ï¸ Notion</view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="category-filter">
    <scroll-view scroll-x class="category-scroll">
      <view class="category-list">
        <view
          class="category-chip {{ selectedCategory === item || (item === 'å…¨éƒ¨' && !selectedCategory) ? 'active' : '' }}"
          wx:for="{{ categories }}"
          wx:key="*this"
          bindtap="filterByCategory"
          data-category="{{ item === 'å…¨éƒ¨' ? '' : item }}"
        >
          {{ item }}
          <text wx:if="{{ categoryStats[item] }}" class="count">({{ categoryStats[item] }})</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢å’Œæ’åº -->
  <view class="filter-bar">
    <view class="search-box">
      <input
        class="search-input"
        placeholder="æœç´¢å¼€å¿ƒäº‹é¡¹..."
        value="{{ searchKeyword }}"
        bindinput="onSearchInput"
      />
    </view>
    <picker class="sort-picker" bindchange="onSortChange" value="{{ sortIndex }}" range="{{ sortOptions }}" range-key="label">
      <view class="sort-btn">
        <text>{{ sortOptions[sortIndex].label }}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- å¼€å¿ƒäº‹é¡¹åˆ—è¡¨ -->
  <view class="happy-things-list">
    <view
      class="happy-thing-item"
      wx:for="{{ filteredHappyThings }}"
      wx:key="id"
    >
      <view class="item-header">
        <view class="emoji">{{ item.emoji }}</view>
        <view class="item-info">
          <view class="content">{{ item.content }}</view>
          <view class="meta">
            <view class="category-tag category-{{ item.category }}">{{ item.category }}</view>
            <view class="energy-tag energy-{{ getEnergyClass(item.energy) }}">
              {{ getEnergyText(item.energy) }}
            </view>
            <view class="duration-tag">â±ï¸ {{ item.duration }}åˆ†é’Ÿ</view>
            <view wx:if="{{ item.isSystemDefault }}" class="system-tag">ğŸŒŸ ç³»ç»Ÿé»˜è®¤</view>
            <view wx:else class="source-tag source-{{ item.source }}">
              {{ item.source === 'local' ? 'æœ¬åœ°' : 'Notion' }}
            </view>
          </view>
        </view>
      </view>

      <view class="item-actions">
        <view wx:if="{{ !item.isSystemDefault }}" class="action-btn edit" bindtap="editHappyThing" data-id="{{ item.id }}">
          <text>âœï¸ ç¼–è¾‘</text>
        </view>
        <view class="action-btn delete {{ item.isSystemDefault ? 'disabled' : '' }}" bindtap="deleteHappyThing" data-id="{{ item.id }}">
          <text>{{ item.isSystemDefault ? 'ğŸ”’ ä¸å¯åˆ é™¤' : 'ğŸ—‘ï¸ åˆ é™¤' }}</text>
        </view>
      </view>

      <view wx:if="{{ item.notes }}" class="item-notes">
        ğŸ“ {{ item.notes }}
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{ filteredHappyThings.length === 0 }}" class="empty-state">
      <text class="empty-icon">ğŸ˜Š</text>
      <text class="empty-text">è¿˜æ²¡æœ‰å¼€å¿ƒäº‹é¡¹</text>
      <text class="empty-hint">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </text>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="btn btn-secondary" bindtap="syncToNotion" wx:if="{{ hasNotionConfig && localCount > 0 }}" disabled="{{ isSyncing }}">
      <text>ğŸ“¤ åŒæ­¥åˆ°Notion ({{ localCount }})</text>
    </button>
    <button class="btn btn-primary" bindtap="addHappyThing">
      <text>â• æ·»åŠ å¼€å¿ƒäº‹é¡¹</text>
    </button>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘å¼¹çª— -->
  <view class="modal {{ showAddModal ? 'show' : '' }}" wx:if="{{ showAddModal }}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{ editingItem ? 'ç¼–è¾‘' : 'æ·»åŠ ' }}å¼€å¿ƒäº‹é¡¹</text>
        <text class="close-btn" bindtap="closeAddModal">âœ•</text>
      </view>

      <view class="form-group">
        <label class="form-label">å†…å®¹ *</label>
        <input
          class="form-input"
          placeholder="å¦‚ï¼šå‡ºé—¨æ•£æ­¥20åˆ†é’Ÿã€åšä¸€é“æ‹¿æ‰‹èœ..."
          value="{{ formData.content }}"
          bindinput="onContentInput"
          maxlength="100"
        />
      </view>

      <view class="form-group">
        <label class="form-label">è¡¨æƒ…</label>
        <input
          class="form-input"
          placeholder="å¦‚ï¼šğŸš¶ã€ğŸ³ã€ğŸ“–..."
          value="{{ formData.emoji }}"
          bindinput="onEmojiInput"
          maxlength="2"
        />
      </view>

      <view class="form-row">
        <view class="form-group half">
          <label class="form-label">åˆ†ç±»</label>
          <picker bindchange="onCategoryChange" value="{{ categoryIndex }}" range="{{ categoryOptions }}">
            <view class="picker-input">
              <text>{{ categoryOptions[categoryIndex] }}</text>
              <text class="arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <view class="form-group half">
          <label class="form-label">èƒ½é‡ç­‰çº§</label>
          <picker bindchange="onEnergyChange" value="{{ energyIndex }}" range="{{ energyOptions }}" range-key="label">
            <view class="picker-input">
              <text>{{ energyOptions[energyIndex].label }}</text>
              <text class="arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>

      <view class="form-row">
        <view class="form-group half">
          <label class="form-label">éš¾åº¦</label>
          <picker bindchange="onDifficultyChange" value="{{ difficultyIndex }}" range="{{ difficultyOptions }}" range-key="label">
            <view class="picker-input">
              <text>{{ difficultyOptions[difficultyIndex].label }}</text>
              <text class="arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <view class="form-group half">
          <label class="form-label">æˆæœ¬</label>
          <picker bindchange="onCostChange" value="{{ costIndex }}" range="{{ costOptions }}" range-key="label">
            <view class="picker-input">
              <text>{{ costOptions[costIndex].label }}</text>
              <text class="arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>

      <view class="form-group">
        <label class="form-label">å»ºè®®æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
        <input
          class="form-input"
          type="number"
          placeholder="30"
          value="{{ formData.duration }}"
          bindinput="onDurationInput"
        />
      </view>

      <view class="form-group">
        <label class="form-label">å¤‡æ³¨</label>
        <textarea
          class="form-textarea"
          placeholder="å¯é€‰ï¼Œå¦‚ç‰¹æ®Šè¯´æ˜ã€æ³¨æ„äº‹é¡¹ç­‰..."
          value="{{ formData.notes }}"
          bindinput="onNotesInput"
          maxlength="200"
        />
      </view>

      <view class="form-actions">
        <button class="btn-cancel" bindtap="closeAddModal">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmAddHappyThing" disabled="{{ !formData.content }}">
          {{ editingItem ? 'æ›´æ–°' : 'åˆ›å»º' }}
        </button>
      </view>
    </view>
  </view>
</view>
