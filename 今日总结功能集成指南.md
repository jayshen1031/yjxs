# 今日总结功能集成指南

## 📋 功能概述

今日总结功能可以自动收集用户今天的所有记录和活动明细，生成结构化的AI提示词，用于生成今日总结报告。

## 🎯 核心特性

### 1. 数据收集
- ✅ 自动获取今日所有主记录（按时间升序）
- ✅ 自动获取今日所有活动明细（按时间升序）
- ✅ 自动计算统计数据（总时长、有价值/中性/低效分布）
- ✅ 支持关联目标和待办信息

### 2. AI提示词生成
- ✅ 完整版提示词：包含时间线、统计、记录内容、结构化输出要求
- ✅ 快速版提示词：简洁的3句话总结
- ✅ 提示词可复制，用于任何AI工具

### 3. 总结保存
- ✅ 保存到Notion（作为特殊类型的记录）
- ✅ 支持复制和分享

## 📁 文件结构

```
utils/
├── dailySummaryPrompt.js    # AI提示词生成器
└── dailySummaryService.js   # 数据获取和总结生成服务

pages/daily-summary/
├── daily-summary.js          # 页面逻辑
├── daily-summary.wxml        # 页面结构
├── daily-summary.wxss        # 页面样式
└── daily-summary.json        # 页面配置
```

## 🚀 集成步骤

### 1. 在app.json中注册页面

```json
{
  "pages": [
    "pages/daily-summary/daily-summary",
    // ... 其他页面
  ]
}
```

### 2. 添加入口（可选位置）

#### 方式1：在首页添加入口
```wxml
<!-- pages/home/home.wxml -->
<view class="quick-action" bindtap="goToSummary">
  <view class="action-icon">📊</view>
  <view class="action-text">今日总结</view>
</view>
```

```javascript
// pages/home/home.js
goToSummary: function() {
  wx.navigateTo({
    url: '/pages/daily-summary/daily-summary'
  })
}
```

#### 方式2：在历史记录页添加按钮
```wxml
<!-- pages/history/history.wxml -->
<view class="header-actions">
  <button class="btn-summary" bindtap="generateDailySummary">
    📊 今日总结
  </button>
</view>
```

```javascript
// pages/history/history.js
generateDailySummary: function() {
  wx.navigateTo({
    url: '/pages/daily-summary/daily-summary'
  })
}
```

#### 方式3：在TabBar中添加（如果需要）
```json
{
  "tabBar": {
    "list": [
      {
        "pagePath": "pages/home/home",
        "text": "首页",
        "iconPath": "images/home.png",
        "selectedIconPath": "images/home-active.png"
      },
      {
        "pagePath": "pages/daily-summary/daily-summary",
        "text": "总结",
        "iconPath": "images/summary.png",
        "selectedIconPath": "images/summary-active.png"
      }
    ]
  }
}
```

### 3. 集成AI服务（重要）

当前代码已经生成了提示词，但还需要集成实际的AI服务。可选方案：

#### 方案A：调用云端AI服务（推荐）

```javascript
// utils/aiService.js
async function callAI(prompt) {
  // 示例：调用豆包API
  const response = await wx.request({
    url: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
    method: 'POST',
    header: {
      'Authorization': 'Bearer YOUR_API_KEY',
      'Content-Type': 'application/json'
    },
    data: {
      model: 'doubao-1-5-pro-32k-250115',
      messages: [
        {
          role: 'user',
          content: prompt
        }
      ]
    }
  })

  return response.data.choices[0].message.content
}

module.exports = { callAI }
```

然后在dailySummaryService.js中集成：

```javascript
// 3. 调用AI生成总结
const aiService = require('./aiService.js')
const aiSummary = await aiService.callAI(prompt)

return {
  success: true,
  summary: aiSummary,
  prompt: prompt,
  data: todayData
}
```

#### 方案B：使用云函数调用AI

```javascript
// cloudfunctions/ai-summary/index.js
const cloud = require('wx-server-sdk')
cloud.init()

exports.main = async (event, context) => {
  const { prompt } = event

  // 调用AI服务
  const response = await fetch('AI服务地址', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer API_KEY',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      prompt: prompt
    })
  })

  const result = await response.json()

  return {
    summary: result.content
  }
}
```

前端调用：

```javascript
const result = await wx.cloud.callFunction({
  name: 'ai-summary',
  data: {
    prompt: prompt
  }
})

const summary = result.result.summary
```

#### 方案C：用户手动复制提示词

如果暂时不集成AI服务，用户可以：
1. 点击"查看提示词"
2. 复制提示词
3. 粘贴到豆包、通义千问、ChatGPT等AI工具
4. 手动将AI生成的总结复制回来

## 📊 数据流程

```
用户访问今日总结页面
        ↓
loadTodayData()
        ↓
getTodayFullData() - 从Notion获取今日数据
        ↓
    显示统计概览
        ↓
用户点击"生成总结"
        ↓
generateDailySummary()
        ↓
generateDailySummaryPrompt() - 生成提示词
        ↓
callAI(prompt) - 调用AI服务
        ↓
    显示AI总结
        ↓
用户可以：保存到Notion | 复制 | 分享
```

## 🎨 UI展示

### 数据概览卡片
```
┌─────────────────────────────┐
│    今日数据                  │
│                             │
│  [15]     [8.0]     [3]     │
│  活动数    总时长(h)  记录数  │
│                             │
│  ✅ 有价值  ████████░░ 300分 │
│  ⚪ 中性    ███░░░░░░░ 100分 │
│  ❌ 低效    ██░░░░░░░░  80分 │
└─────────────────────────────┘
```

### 总结结果
```
┌─────────────────────────────┐
│  AI总结              📋💾📤  │
│                             │
│  📊 今日概览                │
│  今天投入8小时，完成了...   │
│                             │
│  ⭐ 今日亮点                │
│  1. 完成了重要项目里程碑     │
│  2. 保持了高效的工作状态     │
│                             │
│  💡 改进建议                │
│  建议减少低效活动...        │
│                             │
│  ▶ 查看提示词               │
└─────────────────────────────┘
```

## 🔧 自定义配置

### 修改提示词模板

编辑 `utils/dailySummaryPrompt.js`：

```javascript
const prompt = `
自定义你的提示词格式...

要求：
1. 你的要求1
2. 你的要求2
`
```

### 修改总结保存格式

编辑 `utils/dailySummaryService.js` 的 `saveSummaryToNotion` 函数：

```javascript
properties: {
  'Name': { title: [{ text: { content: '自定义标题' } }] },
  'Record Type': { select: { name: '自定义类型' } }
  // 添加更多字段
}
```

### 修改统计计算逻辑

编辑 `calculateDailyStats` 函数：

```javascript
function calculateDailyStats(activities) {
  // 添加你的自定义统计逻辑
  return {
    customStat1: ...,
    customStat2: ...
  }
}
```

## 💡 使用建议

1. **每日定时总结**：建议在晚上睡前使用，回顾一天的时间投入
2. **复盘改进**：关注"改进建议"部分，持续优化时间管理
3. **保存记录**：定期保存总结到Notion，形成个人成长档案
4. **分享激励**：可以分享给朋友或导师，获得外部反馈

## 🐛 常见问题

### Q1: 提示"今日暂无记录"
**A**: 确保今天已经记录了时间投入和活动明细。

### Q2: AI总结生成失败
**A**:
- 检查是否已集成AI服务
- 检查API密钥是否正确
- 查看控制台错误日志

### Q3: 保存到Notion失败
**A**:
- 确认Notion数据库配置正确
- 检查数据库是否有"Record Type"字段
- 查看是否有网络问题

### Q4: 提示词太长
**A**:
- 使用"快速总结"功能
- 或自定义提示词模板，精简内容

## 📝 未来扩展

- [ ] 支持周总结、月总结
- [ ] 支持总结对比（本周 vs 上周）
- [ ] 支持总结模板自定义
- [ ] 支持多种AI服务切换
- [ ] 支持语音播报总结
- [ ] 支持总结评分和趋势分析

## 🎓 技术亮点

1. **数据驱动**：基于真实的时间记录数据生成总结
2. **结构化提示词**：清晰的数据组织和输出要求
3. **灵活扩展**：可轻松集成任何AI服务
4. **用户友好**：支持复制提示词手动使用
5. **完整闭环**：从数据收集到总结保存的完整流程

---

**开发者**: Claude Code
**创建日期**: 2025-01-10
**版本**: v1.0
