# 语寄心声独立云环境配置清单

## 📋 配置完成情况

✅ **已完成**
- [x] 创建新云环境 `yjxs` (ID: yjxs-4gwhgsbze700f1f9)
- [x] 更新 `envList.js` 配置
- [x] 更新 `project.config.json` 配置
- [x] 完整项目备份到 `/Users/jay/Documents/baidu/projects/yjxs_backup_20251009_011439`

## 🔧 待完成配置步骤

### 1. 重新上传并部署云函数 ⚠️ 重要

需要在微信开发者工具中操作：

#### 云函数列表
1. **memo-notion-sync** - Notion同步云函数
   - 路径: `cloudfunctions/memo-notion-sync/`
   - 作用: 处理备忘录与Notion数据库的同步
   - 操作: 右键 → 上传并部署：云端安装依赖

2. **speechRecognition** - 语音识别云函数
   - 路径: `cloudfunctions/speechRecognition/`
   - 作用: 处理语音转文字功能
   - 操作: 右键 → 上传并部署：云端安装依赖

#### 部署步骤
```
1. 打开微信开发者工具
2. 点击左侧"云开发"图标
3. 进入"云函数"标签
4. 找到每个云函数文件夹
5. 右键 → "上传并部署：云端安装依赖"
6. 等待部署完成（显示绿色勾号）
```

### 2. 初始化云数据库（如果使用）

如果你的应用使用了云数据库存储数据，需要：

#### 创建数据库集合
```
1. 云开发 → 数据库
2. 创建以下集合（如果需要）：
   - users (用户表)
   - memos (备忘录表，如果云端存储)
   - goals (目标表，如果云端存储)
   - todos (待办表，如果云端存储)
```

#### 配置权限
```
每个集合设置权限：
- 开发阶段：所有用户可读写（仅限拥有者可读写）
- 生产环境：根据实际需求调整
```

### 3. 配置云存储（如果使用）

如果使用了云存储功能：
```
1. 云开发 → 存储
2. 创建文件夹（如果需要）：
   - audio/ (语音文件)
   - images/ (图片文件)
3. 设置存储权限
```

### 4. 验证云环境

#### 在微信开发者工具中测试

**测试1: 基础功能**
- [ ] 小程序能正常启动
- [ ] 首页箴言正常显示
- [ ] 可以创建新的备忘录
- [ ] 时间线页面正常显示记录

**测试2: 云函数调用**
- [ ] 语音识别功能正常（如果使用）
- [ ] Notion同步功能正常（如果启用）

**测试3: 用户登录**
- [ ] 用户登录功能正常
- [ ] 多用户切换正常

#### 查看控制台日志
确认以下日志输出：
```
App Launch
正在初始化云开发环境: yjxs-4gwhgsbze700f1f9
语寄心声云开发初始化成功, 环境ID: yjxs-4gwhgsbze700f1f9
```

### 5. 数据迁移（可选）

⚠️ **本地存储数据无需迁移**
- 备忘录、目标、待办等数据存储在用户手机本地
- 切换云环境不影响这些数据
- 用户首次使用时数据会自动加载

⚠️ **云数据库数据需要迁移**（如果有）
如果旧环境中有云数据库数据：
```
1. 在旧环境中导出数据
   - 云开发 → 数据库 → 导出
2. 在新环境中导入数据
   - 云开发 → 数据库 → 导入
```

## 🔍 验证清单

### 功能验证
- [ ] ✅ 首页加载正常
- [ ] ✅ 箴言系统正常（刷新、分类、心情推荐）
- [ ] ✅ 备忘录创建和查看正常
- [ ] ✅ 时间线功能正常
- [ ] ✅ 历史记录功能正常
- [ ] ✅ 目标管理功能正常
- [ ] ✅ 待办事项功能正常
- [ ] ✅ 语音录制功能正常
- [ ] ✅ 用户登录和切换正常
- [ ] ✅ 提醒功能正常

### 云环境验证
- [ ] ✅ 云函数部署成功
- [ ] ✅ 云函数调用正常
- [ ] ✅ 云数据库配置正常（如果使用）
- [ ] ✅ 云存储配置正常（如果使用）

### Notion集成验证（如果使用）
- [ ] ✅ Notion API Token配置正常
- [ ] ✅ 自动同步功能正常
- [ ] ✅ 手动同步功能正常

## 📝 配置变更记录

### 变更前配置
- 云环境ID: `cloud1-2g49srond2b01891`
- 云环境类型: 共享环境
- AppID: `wx637643f6c8d4be1c`

### 变更后配置
- 云环境ID: `yjxs-4gwhgsbze700f1f9`
- 云环境类型: 独立环境
- 环境名称: `yjxs`
- AppID: `wx637643f6c8d4be1c` (保持不变)
- 变更时间: 2025-10-09 01:14

## ⚠️ 常见问题

### Q1: 云函数调用失败
**症状**: 调用云函数时报错
**解决**:
1. 检查云函数是否已部署
2. 查看云函数日志
3. 确认环境ID配置正确

### Q2: 数据无法加载
**症状**: 首页或其他页面数据显示为空
**解决**:
1. 本地数据存储在手机本地，切换环境不影响
2. 如果仍有问题，检查控制台错误日志
3. 尝试清除缓存重新编译

### Q3: Notion同步失败
**症状**: Notion同步报错
**解决**:
1. 检查云函数 `memo-notion-sync` 是否已部署
2. 查看云函数日志
3. 确认用户的Notion API Token配置正确

## 🔗 相关资源

- 项目备份: `/Users/jay/Documents/baidu/projects/yjxs_backup_20251009_011439`
- 备份说明: `BACKUP_INFO.md`
- 云开发文档: https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html

## ✅ 完成确认

配置完成后，请在以下签名确认：

- 配置人: ___________
- 配置日期: 2025-10-09
- 测试结果: ⬜ 通过 / ⬜ 失败
- 备注: ___________

---
*创建时间: 2025-10-09 01:23*
*创建者: Claude Code*
