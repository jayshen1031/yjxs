# ç³»ç»Ÿç®¡ç†åŠŸèƒ½ - å®æ–½æŒ‡å—

## ğŸ“‹ æ€»ä½“å®æ–½è®¡åˆ’

### ä¸‰å¤§æ ¸å¿ƒä»»åŠ¡

1. **æ›´æ–°æ•°æ®åº“Schemaå®šä¹‰** - åˆå§‹åŒ–è„šæœ¬
2. **åˆ›å»ºæ•°æ®åº“å‡çº§è„šæœ¬** - ä¸ºç°æœ‰ç”¨æˆ·æä¾›è¿ç§»
3. **é‡æ„è¶³è¿¹é¡µé¢** - å…¨æ–°çš„ç»Ÿä¸€è¡¨æ ¼è®¾è®¡

---

## ğŸ—„ï¸ ä»»åŠ¡1ï¼šæ›´æ–°æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

### ä¿®æ”¹æ–‡ä»¶ï¼š`utils/notionDatabaseSetup.js`

#### 1.1 Goals æ•°æ®åº“ - å¢åŠ å­—æ®µ

```javascript
// åœ¨ Goals æ•°æ®åº“å®šä¹‰ä¸­å¢åŠ 
const goalsSchema = {
  'Goal Name': { title: {} },
  // ... ç°æœ‰å­—æ®µ ...

  // â­ æ–°å¢å­—æ®µ
  'Is System Managed': {
    checkbox: {}
  },
  'Daily Target Hours': {
    number: {
      format: 'number'
    }
  }
}
```

#### 1.2 Todos æ•°æ®åº“ - ä¿æŒç°çŠ¶

**ä¸éœ€è¦ä¿®æ”¹**ï¼Œå¾…åŠä¸åŠ å…¥ç³»ç»Ÿç®¡ç†ï¼Œåªéœ€è¦çŠ¶æ€ç®¡ç†

#### 1.3 Activity Details æ•°æ®åº“ - å¢åŠ å­—æ®µ

```javascript
const activityDetailsSchema = {
  'Activity Name': { title: {} },
  'Date': { date: {} },
  'Start Time': { rich_text: {} },
  'End Time': { rich_text: {} },
  'Duration': { number: {} },

  // â­ æ–°å¢å­—æ®µ
  'Activity Type': {
    select: {
      options: [
        { name: 'ç³»ç»Ÿç›®æ ‡', color: 'blue' },
        { name: 'æ¯æ—¥äº‹é¡¹', color: 'yellow' },
        { name: 'æµæ°´è´¦', color: 'gray' }
      ]
    }
  },

  'Related Goal': {
    relation: {
      database_id: '{{GOALS_DB_ID}}', // å…³è”ç›®æ ‡åº“
      type: 'dual_property',
      dual_property: {
        synced_property_name: 'Related Activities'
      }
    }
  },

  'Related Todo': {
    relation: {
      database_id: '{{TODOS_DB_ID}}', // å…³è”å¾…åŠåº“
      type: 'dual_property',
      dual_property: {
        synced_property_name: 'Related Activities'
      }
    }
  },

  'Related Knowledge': {
    relation: {
      database_id: '{{KNOWLEDGE_DB_ID}}', // å…³è”çŸ¥è¯†åº“
      type: 'dual_property',
      dual_property: {
        synced_property_name: 'Related Activities'
      }
    }
  },

  'Todo Status After': {
    select: {
      options: [
        { name: 'è¿›è¡Œä¸­', color: 'blue' },
        { name: 'å·²å®Œæˆ', color: 'green' }
      ]
    }
  },

  'Notes': { rich_text: {} },
  'User ID': { rich_text: {} }
}
```

#### 1.4 åˆ é™¤ Main Records æ•°æ®åº“å®šä¹‰

```javascript
// å®Œå…¨åˆ é™¤ Main Records ç›¸å…³ä»£ç 
// åŒ…æ‹¬ï¼š
// - getMainRecordsSchema()
// - æ‰€æœ‰å¼•ç”¨ Main Records çš„åœ°æ–¹
```

---

## ğŸ”„ ä»»åŠ¡2ï¼šåˆ›å»ºæ•°æ®åº“å‡çº§è„šæœ¬

### æ–°å»ºæ–‡ä»¶ï¼š`scripts/upgradeToSystemManagement.js`

```javascript
/**
 * æ•°æ®åº“Schemaå‡çº§è„šæœ¬
 * ä»æ—§ç‰ˆå…«æ•°æ®åº“æ¶æ„å‡çº§åˆ°ç³»ç»Ÿç®¡ç†ç‰ˆæœ¬
 *
 * å‡çº§å†…å®¹ï¼š
 * 1. Goals å¢åŠ ï¼šIs System Managed, Daily Target Hours
 * 2. Activity Details å¢åŠ ï¼šActivity Type, Related Goal, Related Todo,
 *    Related Knowledge, Todo Status After
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * node scripts/upgradeToSystemManagement.js
 */

const { Client } = require('@notionhq/client')
const readline = require('readline')

// åˆ›å»ºå‘½ä»¤è¡Œæ¥å£
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
})

// æç¤ºè¾“å…¥
function question(prompt) {
  return new Promise((resolve) => {
    rl.question(prompt, resolve)
  })
}

async function main() {
  console.log('ğŸš€ æ•°æ®åº“Schemaå‡çº§è„šæœ¬')
  console.log('=''.repeat(50))

  // 1. è¾“å…¥Notion API Key
  const apiKey = await question('\nè¯·è¾“å…¥Notion API Key: ')
  const notion = new Client({ auth: apiKey })

  // 2. è¾“å…¥æ•°æ®åº“ID
  console.log('\nè¯·è¾“å…¥å„æ•°æ®åº“IDï¼ˆä»Notioné…ç½®ä¸­è·å–ï¼‰ï¼š')
  const goalsDatabaseId = await question('Goalsæ•°æ®åº“ID: ')
  const activityDetailsDatabaseId = await question('Activity Detailsæ•°æ®åº“ID: ')
  const todosDatabaseId = await question('Todosæ•°æ®åº“ID: ')
  const knowledgeDatabaseId = await question('Knowledgeæ•°æ®åº“ID: ')

  // 3. ç¡®è®¤å‡çº§
  console.log('\nå³å°†æ‰§è¡Œä»¥ä¸‹å‡çº§æ“ä½œï¼š')
  console.log('1. Goals å¢åŠ å­—æ®µï¼šIs System Managed, Daily Target Hours')
  console.log('2. Activity Details å¢åŠ å­—æ®µï¼šActivity Type, Related Goal, Related Todo, Related Knowledge, Todo Status After')

  const confirm = await question('\nç¡®è®¤æ‰§è¡Œå‡çº§ï¼Ÿ(yes/no): ')
  if (confirm.toLowerCase() !== 'yes') {
    console.log('âŒ å‡çº§å·²å–æ¶ˆ')
    rl.close()
    return
  }

  console.log('\nå¼€å§‹å‡çº§...\n')

  // 4. å‡çº§ Goals æ•°æ®åº“
  console.log('ğŸ“š [1/2] å‡çº§Goalsæ•°æ®åº“...')
  try {
    await notion.databases.update({
      database_id: goalsDatabaseId,
      properties: {
        'Is System Managed': {
          checkbox: {}
        },
        'Daily Target Hours': {
          number: {
            format: 'number'
          }
        }
      }
    })
    console.log('âœ… Goalsæ•°æ®åº“å‡çº§æˆåŠŸ')
  } catch (error) {
    console.error('âŒ Goalsæ•°æ®åº“å‡çº§å¤±è´¥:', error.message)
    rl.close()
    return
  }

  // 5. å‡çº§ Activity Details æ•°æ®åº“
  console.log('\nâ±ï¸ [2/2] å‡çº§Activity Detailsæ•°æ®åº“...')
  try {
    // 5.1 æ·»åŠ  Activity Type
    await notion.databases.update({
      database_id: activityDetailsDatabaseId,
      properties: {
        'Activity Type': {
          select: {
            options: [
              { name: 'ç³»ç»Ÿç›®æ ‡', color: 'blue' },
              { name: 'æ¯æ—¥äº‹é¡¹', color: 'yellow' },
              { name: 'æµæ°´è´¦', color: 'gray' }
            ]
          }
        }
      }
    })
    console.log('  âœ“ Activity Type å­—æ®µå·²æ·»åŠ ')

    // 5.2 æ·»åŠ  Related Goal
    await notion.databases.update({
      database_id: activityDetailsDatabaseId,
      properties: {
        'Related Goal': {
          relation: {
            database_id: goalsDatabaseId,
            type: 'dual_property',
            dual_property: {
              synced_property_name: 'Related Activities'
            }
          }
        }
      }
    })
    console.log('  âœ“ Related Goal å…³è”å·²æ·»åŠ ')

    // 5.3 æ·»åŠ  Related Todo
    await notion.databases.update({
      database_id: activityDetailsDatabaseId,
      properties: {
        'Related Todo': {
          relation: {
            database_id: todosDatabaseId,
            type: 'dual_property',
            dual_property: {
              synced_property_name: 'Related Activities'
            }
          }
        }
      }
    })
    console.log('  âœ“ Related Todo å…³è”å·²æ·»åŠ ')

    // 5.4 æ·»åŠ  Related Knowledge
    await notion.databases.update({
      database_id: activityDetailsDatabaseId,
      properties: {
        'Related Knowledge': {
          relation: {
            database_id: knowledgeDatabaseId,
            type: 'dual_property',
            dual_property: {
              synced_property_name: 'Related Activities'
            }
          }
        }
      }
    })
    console.log('  âœ“ Related Knowledge å…³è”å·²æ·»åŠ ')

    // 5.5 æ·»åŠ  Todo Status After
    await notion.databases.update({
      database_id: activityDetailsDatabaseId,
      properties: {
        'Todo Status After': {
          select: {
            options: [
              { name: 'è¿›è¡Œä¸­', color: 'blue' },
              { name: 'å·²å®Œæˆ', color: 'green' }
            ]
          }
        }
      }
    })
    console.log('  âœ“ Todo Status After å­—æ®µå·²æ·»åŠ ')

    console.log('\nâœ… Activity Detailsæ•°æ®åº“å‡çº§æˆåŠŸ')
  } catch (error) {
    console.error('âŒ Activity Detailsæ•°æ®åº“å‡çº§å¤±è´¥:', error.message)
    rl.close()
    return
  }

  // 6. å®Œæˆ
  console.log('\n' + '='.repeat(50))
  console.log('ğŸ‰ æ•°æ®åº“å‡çº§å®Œæˆï¼')
  console.log('\nåç»­æ­¥éª¤ï¼š')
  console.log('1. åœ¨Goalsä¸­å‹¾é€‰"Is System Managed"å¹¶è®¾ç½®"Daily Target Hours"')
  console.log('2. ä½¿ç”¨æ–°ç‰ˆè¶³è¿¹é¡µé¢è®°å½•æ´»åŠ¨')
  console.log('3. Main Recordsæ•°æ®åº“å¯ä»¥ä¿ç•™ï¼ˆä¸å†ä½¿ç”¨ï¼Œä½†ä¸å½±å“ï¼‰')

  rl.close()
}

main().catch(error => {
  console.error('ğŸ’¥ è„šæœ¬æ‰§è¡Œå¤±è´¥:', error)
  rl.close()
  process.exit(1)
})
```

### ä½¿ç”¨è¯´æ˜

```bash
# 1. å®‰è£…ä¾èµ–
npm install @notionhq/client

# 2. æ‰§è¡Œå‡çº§è„šæœ¬
node scripts/upgradeToSystemManagement.js

# 3. æŒ‰æç¤ºè¾“å…¥ï¼š
#    - Notion API Key
#    - Goalsæ•°æ®åº“ID
#    - Activity Detailsæ•°æ®åº“ID
#    - Todosæ•°æ®åº“ID
#    - Knowledgeæ•°æ®åº“ID

# 4. ç¡®è®¤æ‰§è¡Œ

# 5. ç­‰å¾…å‡çº§å®Œæˆ
```

---

## ğŸ”§ ä»»åŠ¡3ï¼šæ›´æ–°å…«æ•°æ®åº“è‡ªåŠ¨åˆ›å»ºè„šæœ¬

### ä¿®æ”¹æ–‡ä»¶ï¼š`utils/notionQuadDatabaseCreator.js`

#### 3.1 æ›´æ–° Goals Schema

```javascript
async createGoalsDatabase(parentPageId) {
  // ... ç°æœ‰ä»£ç  ...

  const schema = {
    // ... ç°æœ‰å­—æ®µ ...

    // â­ æ–°å¢
    'Is System Managed': { checkbox: {} },
    'Daily Target Hours': { number: { format: 'number' } }
  }

  // ... åˆ›å»ºæ•°æ®åº“ ...
}
```

#### 3.2 æ›´æ–° Activity Details Schema

```javascript
async createActivityDetailsDatabase(parentPageId, goalsDatabaseId, todosDatabaseId, mainRecordsDatabaseId) {
  // âš ï¸ æ³¨æ„ï¼šä¸å†éœ€è¦ mainRecordsDatabaseId å‚æ•°

  const schema = {
    'Activity Name': { title: {} },
    'Date': { date: {} },
    'Start Time': { rich_text: {} },
    'End Time': { rich_text: {} },
    'Duration': { number: {} },

    // â­ æ–°å¢
    'Activity Type': {
      select: {
        options: [
          { name: 'ç³»ç»Ÿç›®æ ‡', color: 'blue' },
          { name: 'æ¯æ—¥äº‹é¡¹', color: 'yellow' },
          { name: 'æµæ°´è´¦', color: 'gray' }
        ]
      }
    },

    'Related Goal': {
      relation: {
        database_id: goalsDatabaseId,
        type: 'dual_property',
        dual_property: { synced_property_name: 'Related Activities' }
      }
    },

    'Related Todo': {
      relation: {
        database_id: todosDatabaseId,
        type: 'dual_property',
        dual_property: { synced_property_name: 'Related Activities' }
      }
    },

    'Related Knowledge': {
      relation: {
        database_id: knowledgeDatabaseId,
        type: 'dual_property',
        dual_property: { synced_property_name: 'Related Activities' }
      }
    },

    'Todo Status After': {
      select: {
        options: [
          { name: 'è¿›è¡Œä¸­', color: 'blue' },
          { name: 'å·²å®Œæˆ', color: 'green' }
        ]
      }
    }
  }
}
```

#### 3.3 åˆ é™¤ Main Records åˆ›å»ºé€»è¾‘

```javascript
// åˆ é™¤ createMainRecordsDatabase() æ–¹æ³•
// åˆ é™¤æ‰€æœ‰è°ƒç”¨ Main Records çš„åœ°æ–¹
```

---

## ğŸ“± ä»»åŠ¡4ï¼šé‡æ„è¶³è¿¹é¡µé¢

### 4.1 ä¿®æ”¹ `pages/history/history.wxml`

**å®Œå…¨é‡å†™**ï¼Œæ–°ç»“æ„ï¼š

```xml
<view class="container">
  <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
  <view class="date-selector">
    <button bindtap="previousDay">â—€</button>
    <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
      <text>{{selectedDateDisplay}}</text>
    </picker>
    <button bindtap="nextDay">â–¶</button>
    <button bindtap="goToToday">ä»Šå¤©</button>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stat-card">
      <text class="stat-value">{{stats.totalHours}}h</text>
      <text class="stat-label">æ€»æ—¶é•¿</text>
    </view>
    <view class="stat-card">
      <text class="stat-value">{{stats.goalHours}}h</text>
      <text class="stat-label">ç³»ç»Ÿç›®æ ‡</text>
    </view>
    <view class="stat-card">
      <text class="stat-value">{{stats.taskHours}}h</text>
      <text class="stat-label">æ¯æ—¥äº‹é¡¹</text>
    </view>
    <view class="stat-card">
      <text class="stat-value">{{stats.journalHours}}h</text>
      <text class="stat-label">æµæ°´è´¦</text>
    </view>
  </view>

  <!-- æ´»åŠ¨æ˜ç»†è¡¨æ ¼ -->
  <view class="activities-table">
    <view class="table-header">
      <text class="col-time">å¼€å§‹</text>
      <text class="col-time">ç»“æŸ</text>
      <text class="col-name">æ´»åŠ¨</text>
      <text class="col-relation">å…³è”</text>
      <text class="col-status">çŠ¶æ€</text>
      <text class="col-duration">æ—¶é•¿</text>
      <text class="col-actions">æ“ä½œ</text>
    </view>

    <view class="table-body">
      <view
        wx:for="{{activities}}"
        wx:key="id"
        class="activity-row activity-{{item.activityTypeClass}}"
      >
        <text class="col-time">{{item.startTime}}</text>
        <text class="col-time">{{item.endTime}}</text>
        <text class="col-name">{{item.activityName}}</text>

        <view class="col-relation">
          <text wx:if="{{item.relatedGoal}}">ğŸ¯{{item.relatedGoalName}}</text>
          <text wx:if="{{item.relatedTodo}}">âœ…{{item.relatedTodoName}}</text>
          <text wx:if="{{item.relatedKnowledge}}">ğŸ“š{{item.relatedKnowledgeName}}</text>
        </view>

        <text class="col-status">{{item.statusDisplay}}</text>
        <text class="col-duration">{{item.duration}}min</text>

        <view class="col-actions">
          <text class="action-btn" bindtap="editActivity" data-id="{{item.id}}">âœï¸</text>
          <text class="action-btn" bindtap="deleteActivity" data-id="{{item.id}}">ğŸ—‘ï¸</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{activities.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“</text>
    <text class="empty-text">ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•æ´»åŠ¨</text>
  </view>

  <!-- æ·»åŠ æ´»åŠ¨æŒ‰é’® -->
  <view class="add-button-wrapper">
    <button class="add-button" bindtap="showAddActivityModal">+ æ·»åŠ æ´»åŠ¨</button>
  </view>
</view>

<!-- æ·»åŠ æ´»åŠ¨å¼¹çª— -->
<view wx:if="{{showAddModal}}" class="modal-overlay" bindtap="closeAddModal">
  <view class="modal-content" catchtap="stopPropagation">
    <!-- ... å¼¹çª—å†…å®¹ ... -->
  </view>
</view>
```

### 4.2 ä¿®æ”¹ `pages/history/history.js`

**æ ¸å¿ƒé€»è¾‘é‡å†™**ï¼š

```javascript
Page({
  data: {
    selectedDate: '',
    selectedDateDisplay: '',

    // ç»Ÿè®¡
    stats: {
      totalHours: 0,
      goalHours: 0,
      taskHours: 0,
      journalHours: 0,
      activityCount: 0
    },

    // æ´»åŠ¨åˆ—è¡¨
    activities: [],

    // å¼¹çª—
    showAddModal: false,
    activityType: 'system-goal', // system-goal / daily-task / journal

    // ç³»ç»Ÿç®¡ç†ç›®æ ‡åˆ—è¡¨
    systemGoals: [],

    // å¾…åŠåˆ—è¡¨ï¼ˆæ’é™¤å·²å®Œæˆï¼‰
    activeTodos: []
  },

  onLoad: function() {
    this.initToday()
    this.loadSystemGoals()
    this.loadActiveTodos()
    this.loadTodayActivities()
  },

  // åŠ è½½ç³»ç»Ÿç®¡ç†ç›®æ ‡
  async loadSystemGoals() {
    const currentUser = userManager.getCurrentUser()
    const notionConfig = currentUser.notionConfig

    const result = await notionApiService.queryGoals(
      notionConfig.apiKey,
      notionConfig.databases.goals,
      {
        filters: {
          property: 'Is System Managed',
          checkbox: { equals: true }
        }
      }
    )

    this.setData({
      systemGoals: result.data.results
    })
  },

  // åŠ è½½æ´»è·ƒå¾…åŠ
  async loadActiveTodos() {
    const currentUser = userManager.getCurrentUser()
    const notionConfig = currentUser.notionConfig

    const result = await notionApiService.queryTodos(
      notionConfig.apiKey,
      notionConfig.databases.todos,
      {
        filters: {
          property: 'Status',
          select: { does_not_equal: 'å·²å®Œæˆ' }
        }
      }
    )

    this.setData({
      activeTodos: result.data.results
    })
  },

  // åŠ è½½ä»Šæ—¥æ´»åŠ¨
  async loadTodayActivities() {
    const currentUser = userManager.getCurrentUser()
    const notionConfig = currentUser.notionConfig

    const result = await notionApiService.queryActivities(
      notionConfig.apiKey,
      notionConfig.databases.activityDetails,
      {
        filters: {
          and: [
            {
              property: 'Date',
              date: { equals: this.data.selectedDate }
            },
            {
              property: 'User ID',
              rich_text: { equals: currentUser.email }
            }
          ]
        },
        sorts: [
          {
            property: 'Start Time',
            direction: 'ascending'
          }
        ]
      }
    )

    // è¡¥å……çŠ¶æ€ä¿¡æ¯
    const enrichedActivities = await this.enrichActivities(result.data.results)

    // è®¡ç®—ç»Ÿè®¡
    this.calculateStats(enrichedActivities)

    this.setData({
      activities: enrichedActivities
    })
  },

  // è¡¥å……æ´»åŠ¨çŠ¶æ€ä¿¡æ¯
  async enrichActivities(activities) {
    return await Promise.all(
      activities.map(async (activity) => {
        let statusDisplay = '-'

        if (activity.activityType === 'ç³»ç»Ÿç›®æ ‡' && activity.relatedGoal) {
          const goal = await notionApiService.getGoal(
            notionConfig.apiKey,
            activity.relatedGoal
          )
          statusDisplay = `${goal.currentHours}/${goal.targetHours}h`
        }

        if (activity.activityType === 'æ¯æ—¥äº‹é¡¹' && activity.relatedTodo) {
          const todo = await notionApiService.getTodo(
            notionConfig.apiKey,
            activity.relatedTodo
          )
          const statusMap = {
            'è¿›è¡Œä¸­': 'â–¶ï¸è¿›è¡Œä¸­',
            'æš‚åœæ‰§è¡Œ': 'â¸ï¸æš‚åœ',
            'å·²å®Œæˆ': 'âœ…å·²å®Œæˆ'
          }
          statusDisplay = statusMap[todo.status] || todo.status
        }

        return {
          ...activity,
          statusDisplay
        }
      })
    )
  },

  // è®¡ç®—ç»Ÿè®¡
  calculateStats(activities) {
    const stats = {
      totalHours: 0,
      goalHours: 0,
      taskHours: 0,
      journalHours: 0,
      activityCount: activities.length
    }

    activities.forEach(activity => {
      const hours = activity.duration / 60

      stats.totalHours += hours

      if (activity.activityType === 'ç³»ç»Ÿç›®æ ‡') {
        stats.goalHours += hours
      } else if (activity.activityType === 'æ¯æ—¥äº‹é¡¹') {
        stats.taskHours += hours
      } else if (activity.activityType === 'æµæ°´è´¦') {
        stats.journalHours += hours
      }
    })

    // ä¿ç•™1ä½å°æ•°
    stats.totalHours = stats.totalHours.toFixed(1)
    stats.goalHours = stats.goalHours.toFixed(1)
    stats.taskHours = stats.taskHours.toFixed(1)
    stats.journalHours = stats.journalHours.toFixed(1)

    this.setData({ stats })
  },

  // æ˜¾ç¤ºæ·»åŠ æ´»åŠ¨å¼¹çª—
  showAddActivityModal() {
    this.setData({ showAddModal: true })
  },

  // ä¿å­˜æ´»åŠ¨
  async saveActivity() {
    // 1. åˆ›å»º Activity Details
    // 2. å¦‚æœæ˜¯ç³»ç»Ÿç›®æ ‡ï¼Œæ›´æ–° Goal.Current Hours
    // 3. å¦‚æœæ˜¯æ¯æ—¥äº‹é¡¹ä¸”å‹¾é€‰å®Œæˆï¼Œæ›´æ–° Todo.Status
    // 4. åˆ·æ–°é¡µé¢
  }
})
```

### 4.3 ä¿®æ”¹ `pages/history/history.wxss`

**æ–°æ ·å¼**ï¼š

```css
/* è¡¨æ ¼æ ·å¼ */
.activities-table {
  margin: 24rpx;
  background: white;
  border-radius: 16rpx;
  overflow: hidden;
}

.table-header {
  display: flex;
  background: #f3f4f6;
  padding: 16rpx 12rpx;
  font-size: 22rpx;
  font-weight: 600;
  color: #374151;
  border-bottom: 2rpx solid #e5e7eb;
}

.table-body {
  max-height: 60vh;
  overflow-y: auto;
}

.activity-row {
  display: flex;
  padding: 16rpx 12rpx;
  border-bottom: 1rpx solid #f3f4f6;
  align-items: center;
}

/* ä¸åŒæ´»åŠ¨ç±»å‹é¢œè‰² */
.activity-row.activity-system-goal {
  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
  border-left: 4rpx solid #3b82f6;
}

.activity-row.activity-daily-task {
  background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
  border-left: 4rpx solid #eab308;
}

.activity-row.activity-journal {
  background: #f9fafb;
  border-left: 4rpx solid #d1d5db;
}

/* åˆ—å®½åº¦ */
.col-time { flex: 0 0 80rpx; }
.col-name { flex: 1; }
.col-relation { flex: 0 0 120rpx; }
.col-status { flex: 0 0 100rpx; }
.col-duration { flex: 0 0 80rpx; }
.col-actions { flex: 0 0 100rpx; }
```

---

## âœ… å®æ–½æ­¥éª¤æ€»ç»“

### ç¬¬ä¸€æ­¥ï¼šæ›´æ–°Schemaå®šä¹‰ï¼ˆæ–°ç”¨æˆ·ï¼‰
1. ä¿®æ”¹ `utils/notionDatabaseSetup.js`
2. ä¿®æ”¹ `utils/notionQuadDatabaseCreator.js`
3. æµ‹è¯•ï¼šåˆ›å»ºæ–°çš„å…«æ•°æ®åº“ï¼ŒéªŒè¯å­—æ®µæ­£ç¡®

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå‡çº§è„šæœ¬ï¼ˆç°æœ‰ç”¨æˆ·ï¼‰
1. åˆ›å»º `scripts/upgradeToSystemManagement.js`
2. æµ‹è¯•ï¼šåœ¨æµ‹è¯•æ•°æ®åº“ä¸Šæ‰§è¡Œå‡çº§
3. éªŒè¯ï¼šæ£€æŸ¥å­—æ®µæ˜¯å¦æ­£ç¡®æ·»åŠ 

### ç¬¬ä¸‰æ­¥ï¼šé‡æ„è¶³è¿¹é¡µé¢
1. é‡å†™ `pages/history/history.wxml`
2. é‡å†™ `pages/history/history.js`
3. é‡å†™ `pages/history/history.wxss`
4. æµ‹è¯•ï¼šæ·»åŠ æ´»åŠ¨ã€æŸ¥çœ‹ç»Ÿè®¡ã€åˆ é™¤æ´»åŠ¨

### ç¬¬å››æ­¥ï¼šç”¨æˆ·å‡çº§æŒ‡å—
åˆ›å»ºç”¨æˆ·å‡çº§æ–‡æ¡£ï¼Œè¯´æ˜ï¼š
1. å¦‚ä½•è¿è¡Œå‡çº§è„šæœ¬
2. å¦‚ä½•é…ç½®ç³»ç»Ÿç®¡ç†ç›®æ ‡
3. å¦‚ä½•ä½¿ç”¨æ–°ç‰ˆè¶³è¿¹é¡µé¢

---

## âš ï¸ é£é™©æç¤º

1. **æ•°æ®åº“å‡çº§ä¸å¯é€†**
   - å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œ
   - å‡çº§å‰å¯¼å‡ºé‡è¦æ•°æ®

2. **Main Records æ•°æ®ä¿ç•™**
   - ä¸åˆ é™¤ Main Records æ•°æ®åº“
   - ä¿ç•™å†å²æ•°æ®ï¼Œä½†ä¸å†ä½¿ç”¨

3. **ç”¨æˆ·éœ€è¦æ‰‹åŠ¨é…ç½®**
   - å‡çº§åéœ€è¦å‹¾é€‰"ç³»ç»Ÿç®¡ç†"
   - éœ€è¦è®¾ç½®"æ¯æ—¥ç›®æ ‡"

---

*å®æ–½æŒ‡å—åˆ›å»ºæ—¥æœŸï¼š2025å¹´11æœˆ16æ—¥*
